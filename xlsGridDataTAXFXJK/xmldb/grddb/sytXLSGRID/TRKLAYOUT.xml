<?xml version='1.0' encoding='GBK'?><mdroot><grdds>
<ROWSET>
<ROW num="0" ><MWTYP >M</MWTYP><MWID >TRKLAYOUT</MWID><NAME >布局管理</NAME><NOTE ></NOTE><NOACCNAME ></NOACCNAME><FILE >TRKLAYOUT.zxg</FILE><SCENE ></SCENE><FIXED ></FIXED><CATTYP ></CATTYP><DTLRNG ></DTLRNG><BATINP ></BATINP><MANUNIT ></MANUNIT><USESMLUNT ></USESMLUNT><ITEMTABLE ></ITEMTABLE><BILHDRTABLE ></BILHDRTABLE><BILDTLTABLE ></BILDTLTABLE><COLLIST ></COLLIST><WHERE ></WHERE><ORDER ></ORDER><DBNAME ></DBNAME><LISTSUM ></LISTSUM><LOADDATA ></LOADDATA><CHECKTITLE ></CHECKTITLE><IFBILL ></IFBILL><EXTJS ></EXTJS><JAVACLS ></JAVACLS><POST2MWID ></POST2MWID><LMS ></LMS><syt >XLSGRID</syt></ROW>
</ROWSET>
</grdds><grdjsds>
<ROWSET>
<ROW num="0" ><GRDJSDS_VALUE ></GRDJSDS_VALUE></ROW>
</ROWSET>
</grdjsds><grdosds>
<ROWSET>
<ROW num="0" ><GRDOSDS_VALUE >var pubpack = new JavaPackage ( &amp;quot;com.xlsgrid.net.pub&amp;quot; );
var webpack = new JavaPackage ( &amp;quot;com.xlsgrid.net.web&amp;quot; );


// 插入日志
// logtyp: 日志分类，比如TRKHDR
// logtypnam: 日志分类,如已读
// guid: 参考编号
// name: 事务的说明，比如新建的事务的标题
// note: 事务的详细内容，删除一个事务的时候，这里保存事务的明细
// prj 项目
function OALOG( db,loginorgid ,loginusrid,logtyp,logtypnam,guid,name,note ,prj ) 
{
	var sql = &amp;quot;insert into OALOG(org,usrid,usrnam,mwtyp,action,bilid,name,note,prj)&amp;quot;+
	       &amp;quot;select a.org,a.id,a.name,&amp;apos;&amp;quot;+logtyp+&amp;quot;&amp;apos;,&amp;apos;&amp;quot;+logtypnam+&amp;quot;&amp;apos; ,&amp;apos;&amp;quot;+guid+&amp;quot;&amp;apos;, &amp;apos;&amp;quot;+name+&amp;quot;&amp;apos;,&amp;apos;&amp;quot;+note+&amp;quot;&amp;apos;,&amp;apos;&amp;quot;+prj+&amp;quot;&amp;apos; from usr a where a.id=&amp;apos;&amp;quot;+loginusrid +&amp;quot;&amp;apos; and a.org=&amp;apos;&amp;quot;+loginorgid +&amp;quot;&amp;apos; &amp;quot;;
	//throw new Exception(&amp;quot;log错误:&amp;quot;+sql );
	db.ExcecutSQL(sql);
}

function test()
{
	return txt ;

}




// 得到某个trk的主界面
// 客户端: trkguid 对应trkhdr的guid
function trkquery()
{
	var db = null;
	var msg= &amp;quot;&amp;quot;;
	var usrinfo = webpack.EASession.GetLoginInfo(request);
	var loginusrid = usrinfo.getUsrid();
	var loginorgid = usrinfo.getusrOrg();	
	try {
		db = new pubpack.EADatabase();	// 如果连接到其他数据库, new pubpack.EADatabase(“dbname”)
		var sql = &amp;quot;select a.noteblob,a.guid,a.id,a.title,a.note,a.prio,to_char(a.crtdat,&amp;apos;YYYY-MM-DD HH24:MI:SS&amp;apos;) crttim,b.name crtusr,b.id crtusrid,a.stat,a.dtlusr,a.project,a.filepath,a.filenote,a.imagepath,a.imagenote,a.show,a.selforg from trkhdr a,usr b where a.crtusr=b.id and a.SELFORG=b.org and  a.guid=&amp;apos;&amp;quot;+trkguid +&amp;quot;&amp;apos;&amp;quot;;
		var ds = db.QuerySQL(sql);
		
		if ( ds.getRowCount() &amp;gt; 0 ) {
			var id = ds.getStringAt(0,&amp;quot;id&amp;quot;);
			msg += &amp;quot;&amp;lt;p align=center &amp;gt;&amp;lt;font size=3&amp;gt;&amp;quot;+ds.getStringAt(0,&amp;quot;title&amp;quot;)+&amp;quot;&amp;lt;/font&amp;gt;&amp;lt;/p&amp;gt;&amp;quot;;
			msg += &amp;quot;&amp;lt;p align=center&amp;gt;&amp;lt;font color=#808080&amp;gt;&amp;quot;+ds.getStringAt(0,&amp;quot;crtusr&amp;quot;)+&amp;quot; &amp;quot;+ds.getStringAt(0,&amp;quot;crttim&amp;quot;)+&amp;quot;&amp;lt;/font&amp;gt;&amp;lt;/p&amp;gt;&amp;quot;;
			
			var note = ds.getStringAt(0,&amp;quot;note&amp;quot;); 
			if(note==&amp;quot;&amp;quot;) note += db.getBlob2String(sql,&amp;quot;noteblob&amp;quot;);
			note = pubpack.EAFunc.Replace(note,&amp;quot;\n&amp;quot;,&amp;quot;&amp;lt;br&amp;gt;&amp;quot;);//替换换行键
			note = pubpack.EAFunc.Replace(note,&amp;quot;\r&amp;quot;,&amp;quot;&amp;lt;br&amp;gt;&amp;quot;);//替换换行键
			note = pubpack.EAFunc.Replace(note,&amp;quot;\u0009&amp;quot;,&amp;quot;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;quot;);//替换tab键
			msg += &amp;quot;&amp;lt;font size=2 &amp;gt;&amp;quot;+note+&amp;quot;&amp;lt;/font&amp;gt;&amp;quot;;
			var filenote = ds.getStringAt(0,&amp;quot;filenote&amp;quot;);
//			var filenotes = filenote.split(&amp;quot;\&amp;quot;);
//			if (filenotes.length&amp;gt;0 )
//				 filenote = filenotes[filenotes.length-1];
			var imagenote = ds.getStringAt(0,&amp;quot;imagenote&amp;quot;);
//			var imagenotes = imagenote.split(&amp;quot;\\&amp;quot;);
//			if ( imagenotes.length&amp;gt;0 ) 
//				imagenote = imagenotes[imagenotes.length-1];
			
			
			var filepath = ds.getStringAt(0,&amp;quot;filepath&amp;quot;);
			if ( filepath !=&amp;quot;&amp;quot; ) {
				var idx = filenote.indexOf(&amp;quot;\\&amp;quot;);
				while(idx&amp;gt;=0 ) {
					var idx1 = filenote.indexOf(&amp;quot;\\&amp;quot;,idx+1);
					if ( idx1&amp;gt;= 0 ) idx = idx1;
					else break;
				}
				if ( idx&amp;gt;=0 ) 
					filenote = filenote.substring(idx+1);
				msg += &amp;quot;&amp;lt;p&amp;gt;&amp;lt;font color=#FF0000 &amp;gt;下载附件：&amp;lt;a href=\&amp;quot;downloadFile.sp?unzip=1&amp;filename=&amp;quot;+filepath+&amp;quot;\&amp;quot;&amp;gt;&amp;quot;+filenote+&amp;quot;&amp;lt;/a&amp;gt;&amp;nbsp;&amp;lt;a href=\&amp;quot;downloadFile.sp?format=zip&amp;filename=&amp;quot;+filepath+&amp;quot;\&amp;quot;&amp;gt;压缩下载&amp;lt;/a&amp;gt;&amp;lt;/font&amp;gt;&amp;lt;/p&amp;gt;&amp;quot;;
			}
			if ( ds.getStringAt(0,&amp;quot;imagepath&amp;quot;)!=&amp;quot;&amp;quot; ) 
				msg += &amp;quot;&amp;lt;p&amp;gt;&amp;lt;font color=#FF0000 &amp;gt;屏幕截图：&amp;lt;a href=\&amp;quot;downloadFile.sp?format=zip&amp;filename=&amp;quot;+ds.getStringAt(0,&amp;quot;imagepath&amp;quot;)+&amp;quot;\&amp;quot;&amp;gt;压缩下载&amp;lt;/a&amp;gt;&amp;nbsp;&amp;lt;a href=\&amp;quot;downloadFile.sp?unzip=1&amp;format=rtf&amp;filename=&amp;quot;+ds.getStringAt(0,&amp;quot;imagepath&amp;quot;)+&amp;quot;\&amp;quot;&amp;gt;原始下载&amp;lt;/a&amp;gt;&amp;lt;/font&amp;gt;&amp;lt;/p&amp;gt;&amp;quot;;
				
//			if ( loginusrid ==ds.getStringAt(0,&amp;quot;crtusrid&amp;quot;)&amp;&amp; ds.getStringAt(0,&amp;quot;selforg&amp;quot;)== loginorgid  )
//				msg+=&amp;quot;&amp;nbsp;&amp;nbsp;&amp;lt;a href=\&amp;quot;show.sp?grdid=TRK_TRKDTL&amp;datacc=XLSGRID&amp;guid=&amp;quot;+ds.getStringAt(row,&amp;quot;guid&amp;quot;)+&amp;quot;\&amp;quot;  target=_blank &amp;gt;编辑&amp;lt;/a&amp;gt;&amp;quot;;
		
			if ( loginusrid ==ds.getStringAt(0,&amp;quot;crtusrid&amp;quot;)&amp;&amp; ds.getStringAt(0,&amp;quot;selforg&amp;quot;)== loginorgid  )
				msg+=&amp;quot;&amp;lt;p align=&amp;apos;right&amp;apos;&amp;gt;&amp;lt;a href=\&amp;quot;show.sp?grdid=HDRTRK&amp;datacc=XLSGRID&amp;&amp;edit=modify&amp;id=&amp;quot;+ds.getStringAt(0,&amp;quot;id&amp;quot;)+&amp;quot;&amp;style=2&amp;dd=0\&amp;quot;  target=_blank &amp;gt;编辑&amp;lt;/a&amp;gt;&amp;nbsp;&amp;nbsp;|&amp;nbsp;&amp;nbsp;&amp;lt;a href=\&amp;quot;#\&amp;quot; onclick=\&amp;quot;javascript:if(confirm(&amp;apos;结束该事务，是否继续？&amp;apos;)==1)window.location=&amp;apos;XLSGRID.TRKLAYOUT.DelTrk.osp?trkguid=&amp;quot;+trkguid+&amp;quot;&amp;apos;;\&amp;quot; &amp;gt;删除&amp;lt;a/&amp;gt;&amp;nbsp;&amp;nbsp;&amp;quot;+&amp;quot;&amp;lt;/p&amp;gt;&amp;quot;;
			else {
				var cnt = 1* db.GetSQL( &amp;quot;select count(*) from OALOG where mwtyp=&amp;apos;READ&amp;apos; and bilid=&amp;apos;&amp;quot;+trkguid+&amp;quot;&amp;apos; and usrid=&amp;apos;&amp;quot;+loginusrid +&amp;quot;&amp;apos; and org=&amp;apos;&amp;quot;+loginorgid +&amp;quot;&amp;apos; &amp;quot;);
				if( cnt == 0 ){
					//throw new Excetpion(ds.getStringAt(0,&amp;quot;title&amp;quot;));
					OALOG( db,loginorgid ,loginusrid,&amp;quot;READ&amp;quot;,&amp;quot;已读&amp;quot;,trkguid,ds.getStringAt(0,&amp;quot;title&amp;quot;),&amp;quot;&amp;quot;,ds.getStringAt(0,&amp;quot;project&amp;quot;) ) ;
					db.Commit();
				}	                
			
			}
		}
		
	}
	catch ( ee ) {
		db.Rollback();
		throw new pubpack.EAException ( ee.toString() );
	}
	finally {
		if (db!=null) db.Close();
	}
	return msg;
}

// 处理过程
function trkquerydtl()
{
	var db = null;
	var msg= &amp;quot;&amp;quot;;
	var usrinfo = webpack.EASession.GetLoginInfo(request);
	var loginusrid = usrinfo.getUsrid();
	var loginorgid = usrinfo.getusrOrg();	
	try {
		db = new pubpack.EADatabase();	// 如果连接到其他数据库, new pubpack.EADatabase(“dbname”)
		var sql = &amp;quot;select a.title,a.pro_note,b.name tousr,to_char(a.crtdat,&amp;apos;YYYY-MM-DD HH24:MI:SS&amp;apos;) crttim,c.name crtusr,c.id crtusrid,dtltyp,a.guid ,a.selforg,a.filepath, a.filenote,a.imagepath, a.imagenote &amp;quot;+
		&amp;quot;from trkdtl a , usr b, usr c where a.trkguid=&amp;apos;&amp;quot;+trkguid +&amp;quot;&amp;apos; and a.tousr=b.id(+) and a.AIMORG=b.org(+) and a.crtusr=c.id and a.selforg=c.org and NVL(a.dtltyp,&amp;apos; &amp;apos;)&amp;lt;&amp;gt;&amp;apos;2&amp;apos; order by a.crtdat asc&amp;quot;;
		var ds = db.QuerySQL(sql);
		if ( ds.getRowCount() == 0 ) msg+=&amp;quot;没有处理记录&amp;quot; ;
		for ( var row=0;row&amp;lt;ds.getRowCount();row ++ ) {
			msg +=&amp;quot;&amp;lt;p&amp;gt;&amp;quot;+(row+1)+&amp;quot;.&amp;quot;+ds.getStringAt(row,&amp;quot;crtusr&amp;quot;)+&amp;quot;于&amp;quot;+ds.getStringAt(row,&amp;quot;crttim&amp;quot;);
			var dtltyp  = ds.getStringAt(row,&amp;quot;dtltyp&amp;quot;);
			var guid = ds.getStringAt(row,&amp;quot;guid&amp;quot;);

			if (dtltyp   == &amp;quot;2&amp;quot; ) 
				msg += &amp;quot;发表评论&amp;quot;;
			else 
				msg += &amp;quot;处理过，并转发给&amp;quot;+ds.getStringAt(row,&amp;quot;tousr&amp;quot;);
			msg +=&amp;quot;&amp;lt;br&amp;gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;标题：&amp;quot;+ds.getStringAt(row,&amp;quot;title&amp;quot;)+&amp;quot;&amp;lt;BR&amp;gt;&amp;quot;;

			var note = ds.getStringAt(row,&amp;quot;pro_note&amp;quot;);
			if ( note.length() &amp;gt; 0 ) {
				note = pubpack.EAFunc.Replace(note,&amp;quot;\n&amp;quot;,&amp;quot;&amp;lt;BR&amp;gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;quot;);
				msg +=&amp;quot;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;lt;font color=&amp;apos;#333333&amp;apos;&amp;gt;&amp;quot;+note+&amp;quot;&amp;lt;/font&amp;gt;&amp;quot;;
			}
			var filepath = ds.getStringAt(row,&amp;quot;filepath&amp;quot;);
			var filenote = ds.getStringAt(row,&amp;quot;filenote&amp;quot;);
			var imagepath = ds.getStringAt(row,&amp;quot;imagepath&amp;quot;);
			var imagenote= ds.getStringAt(row,&amp;quot;imagenote&amp;quot;);
			
			if ( filepath!=&amp;quot;&amp;quot; ) 
				msg += &amp;quot;&amp;lt;p&amp;gt;&amp;lt;font color=#FF0000 size=2&amp;gt;下载附件：&amp;lt;a href=\&amp;quot;downloadFile.sp?unzip=1&amp;filename=&amp;quot;+filepath+&amp;quot;\&amp;quot;&amp;gt;&amp;quot;+filenote+&amp;quot;&amp;lt;/a&amp;gt;&amp;nbsp;&amp;lt;a href=\&amp;quot;downloadFile.sp?format=zip&amp;filename=&amp;quot;+filepath+&amp;quot;\&amp;quot;&amp;gt;压缩下载&amp;lt;/a&amp;gt;&amp;lt;/font&amp;gt;&amp;quot;;
			if ( imagepath !=&amp;quot;&amp;quot; ) 
				msg += &amp;quot;&amp;lt;BR&amp;gt;&amp;lt;font color=#FF0000 size=2&amp;gt;屏幕截图：&amp;lt;a href=\&amp;quot;downloadFile.sp?format=zip&amp;filename=&amp;quot;+imagepath+&amp;quot;\&amp;quot;&amp;gt;压缩下载&amp;lt;/a&amp;gt;&amp;nbsp;&amp;lt;a href=\&amp;quot;downloadFile.sp?unzip=1&amp;format=rtf&amp;filename=&amp;quot;+imagepath+&amp;quot;\&amp;quot;&amp;gt;原始下载&amp;lt;/a&amp;gt;&amp;lt;/font&amp;gt;&amp;quot;;			
			
			//show.sp?grdid=TRK_TRKDTL&amp;datacc=XLSGRID&amp;guid=28518ADFEFA0FC9DE040007F01006EA8&amp;
			if ( loginusrid ==ds.getStringAt(row,&amp;quot;crtusrid&amp;quot;)&amp;&amp; ds.getStringAt(row,&amp;quot;selforg&amp;quot;)== loginorgid  )
				msg+=&amp;quot;&amp;lt;p align=&amp;apos;right&amp;apos;&amp;gt;&amp;lt;a href=\&amp;quot;show.sp?grdid=TRK_TRKDTL&amp;datacc=XLSGRID&amp;guid=&amp;quot;+guid+&amp;quot;\&amp;quot;  target=_blank &amp;gt;编辑&amp;lt;/a&amp;gt;&amp;nbsp;&amp;nbsp;|&amp;nbsp;&amp;nbsp;&amp;lt;a href=\&amp;quot;#\&amp;quot; onclick=\&amp;quot;javascript:if(confirm(&amp;apos;结束该事务，是否继续？&amp;apos;)==1)window.location=&amp;apos;XLSGRID.TRKLAYOUT.DelTrkDtl.osp?guid=&amp;quot;+guid+&amp;quot;&amp;trkguid=&amp;quot;+trkguid+&amp;quot;&amp;apos;;\&amp;quot; &amp;gt;删除&amp;lt;a/&amp;gt;&amp;nbsp;&amp;nbsp;&amp;quot;;
			msg+=&amp;quot;&amp;lt;/p&amp;gt;&amp;quot;;
		}
			
	}
	catch ( ee ) {
		db.Rollback();
		throw new pubpack.EAException ( ee.toString() );
	}
	finally {
		if (db!=null) db.Close();
	}
	return msg;
}
// 事务的评论，和处理过程类似
function trkquerydtlpl()
{
	var db = null;
	var msg= &amp;quot;&amp;quot;;
	var usrinfo = webpack.EASession.GetLoginInfo(request);
	var loginusrid = usrinfo.getUsrid();
	var loginorgid = usrinfo.getusrOrg();
	try {
		db = new pubpack.EADatabase();	// 如果连接到其他数据库, new pubpack.EADatabase(“dbname”)
		var sql = &amp;quot;select a.title,a.pro_note,b.name tousr,to_char(a.crtdat,&amp;apos;YYYY-MM-DD HH24:MI:SS&amp;apos;) crttim,c.name crtusr,c.id crtusrid,dtltyp,a.guid ,a.filepath, a.filenote,a.imagepath, a.imagenote ,a.crtusr, a.selforg &amp;quot;+
		&amp;quot;from trkdtl a , usr b, usr c where a.trkguid=&amp;apos;&amp;quot;+trkguid +&amp;quot;&amp;apos; and a.tousr=b.id(+) and a.AIMORG=b.org(+) and a.crtusr=c.id and a.selforg=c.org and a.dtltyp=&amp;apos;2&amp;apos; order by a.crtdat asc&amp;quot;;
		var ds = db.QuerySQL(sql);
		if ( ds.getRowCount() == 0 ) msg+=&amp;quot;没有处理记录&amp;quot; ;
		for ( var row=0;row&amp;lt;ds.getRowCount();row ++ ) {
			msg +=&amp;quot;&amp;lt;p align=&amp;apos;center&amp;apos;&amp;gt;&amp;lt;font size=&amp;apos;3&amp;apos;&amp;gt;&amp;quot;+ds.getStringAt(row,&amp;quot;title&amp;quot;)+&amp;quot;&amp;lt;/font&amp;gt;&amp;lt;/p&amp;gt;&amp;quot;;
			msg +=&amp;quot;&amp;lt;p align=&amp;apos;center&amp;apos;&amp;gt;&amp;quot;+ds.getStringAt(row,&amp;quot;crtusr&amp;quot;)+&amp;quot;　&amp;quot;+ds.getStringAt(row,&amp;quot;crttim&amp;quot;)+&amp;quot;&amp;lt;/p&amp;gt;&amp;quot;;
			var note = ds.getStringAt(row,&amp;quot;pro_note&amp;quot;);
			var guid = ds.getStringAt(row,&amp;quot;guid&amp;quot;);

			if ( note.length() &amp;gt; 0 ) {
				note = pubpack.EAFunc.Replace(note,&amp;quot;\n&amp;quot;,&amp;quot;&amp;lt;BR&amp;gt;&amp;quot;);
				msg +=&amp;quot;&amp;lt;font color=&amp;apos;#333333&amp;apos;&amp;gt;&amp;quot;+note+&amp;quot;&amp;lt;/font&amp;gt;&amp;quot;;
			}
			var filepath = ds.getStringAt(row,&amp;quot;filepath&amp;quot;);
			var filenote = ds.getStringAt(row,&amp;quot;filenote&amp;quot;);
			var imagepath = ds.getStringAt(row,&amp;quot;imagepath&amp;quot;);
			var imagenote= ds.getStringAt(row,&amp;quot;imagenote&amp;quot;);
			
			if ( filepath!=&amp;quot;&amp;quot; ) 
				msg += &amp;quot;&amp;lt;p&amp;gt;&amp;lt;font color=#FF0000 size=2&amp;gt;下载附件：&amp;lt;a href=\&amp;quot;downloadFile.sp?unzip=1&amp;filename=&amp;quot;+filepath+&amp;quot;\&amp;quot;&amp;gt;&amp;quot;+filenote+&amp;quot;&amp;lt;/a&amp;gt;&amp;nbsp;&amp;lt;a href=\&amp;quot;downloadFile.sp?format=zip&amp;filename=&amp;quot;+filepath+&amp;quot;\&amp;quot;&amp;gt;压缩下载&amp;lt;/a&amp;gt;&amp;lt;/font&amp;gt;&amp;quot;;
			if ( imagepath !=&amp;quot;&amp;quot; ) 
				msg += &amp;quot;&amp;lt;BR&amp;gt;&amp;lt;font color=#FF0000 size=2&amp;gt;屏幕截图：&amp;lt;a href=\&amp;quot;downloadFile.sp?format=zip&amp;filename=&amp;quot;+imagepath+&amp;quot;\&amp;quot;&amp;gt;压缩下载&amp;lt;/a&amp;gt;&amp;nbsp;&amp;lt;a href=\&amp;quot;downloadFile.sp?unzip=1&amp;format=rtf&amp;filename=&amp;quot;+imagepath+&amp;quot;\&amp;quot;&amp;gt;原始下载&amp;lt;/a&amp;gt;&amp;lt;/font&amp;gt;&amp;quot;;			

			//show.sp?grdid=TRK_TRKDTL&amp;datacc=XLSGRID&amp;guid=28518ADFEFA0FC9DE040007F01006EA8&amp;
			if ( loginusrid ==ds.getStringAt(row,&amp;quot;crtusrid&amp;quot;)&amp;&amp; ds.getStringAt(row,&amp;quot;selforg&amp;quot;)== loginorgid  )
				msg+=&amp;quot;&amp;lt;p align=&amp;apos;right&amp;apos;&amp;gt;&amp;lt;a href=\&amp;quot;show.sp?grdid=TRK_TRKDTL&amp;datacc=XLSGRID&amp;guid=&amp;quot;+ds.getStringAt(row,&amp;quot;guid&amp;quot;)+&amp;quot;\&amp;quot;  target=_blank &amp;gt;编辑&amp;lt;/a&amp;gt;&amp;nbsp;&amp;nbsp;|&amp;nbsp;&amp;nbsp;&amp;lt;a href=\&amp;quot;#\&amp;quot; onclick=\&amp;quot;javascript:if(confirm(&amp;apos;结束该事务，是否继续？&amp;apos;)==1)window.location=&amp;apos;XLSGRID.TRKLAYOUT.DelTrkDtl.osp?guid=&amp;quot;+guid+&amp;quot;&amp;trkguid=&amp;quot;+trkguid+&amp;quot;&amp;apos;;\&amp;quot; &amp;gt;删除&amp;lt;a/&amp;gt;&amp;nbsp;&amp;nbsp;&amp;lt;/p&amp;gt;&amp;quot;;
			msg+=&amp;quot;&amp;lt;HR&amp;gt;&amp;quot;;
		}
			
	}
	catch ( ee ) {
		db.Rollback();
		throw new pubpack.EAException ( ee.toString() );
	}
	finally {
		if (db!=null) db.Close();
	}
	return msg;
}

// 得到某个trk的头信息，主要列在trk主界面的左边，包括有操作按钮
// 客户端: trkguid 对应trkhdr的guid
function trkhdr()
{
	var db = null;
	var msg= &amp;quot;&amp;quot;;
	var usrinfo = webpack.EASession.GetLoginInfo(request);
	var loginusrid = usrinfo.getUsrid();
	var loginorgid = usrinfo.getusrOrg();
	
	var browser =pubpack.EAFunc.getBroswerType(request);
	

	try {
		db = new pubpack.EADatabase();	// 如果连接到其他数据库, new pubpack.EADatabase(“dbname”)
		var sql = &amp;quot;select a.id,a.title,b.id prjid,b.name prjnam,a.prio,e.name trktyp,to_char(a.crtdat,&amp;apos;YYYY-MM-DD HH24:MI:SS&amp;apos;) crttim,a.crtusr,d.name statname,a.stat,a.dtlusr,c.name dtlusrnam,a.aimorg,a.project,a.filepath,a.filenote,a.imagepath,a.imagenote,a.show,a.selforg from trkhdr a, prj b,usr c,v_trkstat d,v_trktyp e where a.show=e.id and a.stat=d.id and a.dtlusr=c.id(+) and a.aimorg=c.org(+) and a.project=b.id and a.guid=&amp;apos;&amp;quot;+trkguid +&amp;quot;&amp;apos;&amp;quot;;
		var ds = db.QuerySQL(sql);
		if ( ds.getRowCount() &amp;gt; 0 ) {
			var id = ds.getStringAt(0,&amp;quot;id&amp;quot;);
			var usrid = ds.getStringAt(0,&amp;quot;DTLUSR&amp;quot;);
			var usrorgid = ds.getStringAt(0,&amp;quot;AIMORG&amp;quot;);
			var crtid = ds.getStringAt(0,&amp;quot;CRTUSR&amp;quot;);
			var crtorgid = ds.getStringAt(0,&amp;quot;SELFORG&amp;quot;);
			var show = ds.getStringAt(0,&amp;quot;SHOW&amp;quot;);
			var prjid = ds.getStringAt(0,&amp;quot;PRJID&amp;quot;);
			var stat = ds.getStringAt(0,&amp;quot;STAT&amp;quot;);
			var trktyp = ds.getStringAt(0,&amp;quot;TRKTYP&amp;quot;);


			
			msg += &amp;quot;&amp;lt;p align=left&amp;gt;&amp;lt;font size=2 color=#808080&amp;gt;项目:&amp;quot;+ds.getStringAt(0,&amp;quot;prjnam&amp;quot;)+&amp;quot;&amp;lt;BR&amp;gt;类型：&amp;quot;+trktyp+&amp;quot;&amp;lt;BR&amp;gt;编号:&amp;quot;+ds.getStringAt(0,&amp;quot;id&amp;quot;)+&amp;quot;&amp;lt;BR&amp;gt;优先级:&amp;quot;+ds.getStringAt(0,&amp;quot;prio&amp;quot;)+&amp;quot;&amp;lt;BR&amp;gt;状态:&amp;quot;+ds.getStringAt(0,&amp;quot;statname&amp;quot;)+&amp;quot;&amp;lt;BR&amp;gt;流转到:&amp;quot;+ds.getStringAt(0,&amp;quot;dtlusrnam&amp;quot;)+&amp;quot;&amp;lt;/font&amp;gt;&amp;lt;/p&amp;gt;&amp;quot; ;
			if (stat != &amp;quot;3&amp;quot; ) {
				if ( loginusrid ==usrid &amp;&amp; usrorgid == loginorgid  ){
					if(browser==&amp;quot;4&amp;quot;){
						//msg += &amp;quot;&amp;lt;p align=center&amp;gt;您该处理该事务&amp;lt;BR&amp;gt;【&amp;lt;a href=&amp;apos;show.sp?grdid=HDRTRK&amp;hdrordtl=2&amp;hdrguid=&amp;quot;+trkguid+&amp;quot;&amp;style=&amp;quot;+show +&amp;quot;&amp;prjid=&amp;quot;+prjid +&amp;quot;&amp;edit=&amp;dd=&amp;apos; target=_blank&amp;gt;处理事务&amp;lt;/a&amp;gt;】&amp;quot; ;
						msg += &amp;quot;&amp;lt;p align=center&amp;gt;您该处理该事务&amp;lt;BR&amp;gt;【&amp;lt;a href=&amp;apos;show.sp?grdid=j2me_newtrk&amp;hdrordtl=2&amp;hdrguid=&amp;quot;+trkguid+&amp;quot;&amp;style=&amp;quot;+show +&amp;quot;&amp;prjid=&amp;quot;+prjid +&amp;quot;&amp;edit=&amp;dd=&amp;browser=4&amp;apos; target=_blank&amp;gt;处理事务&amp;lt;/a&amp;gt;】&amp;quot; ;
						msg += &amp;quot;&amp;lt;BR&amp;gt;【&amp;lt;a href=&amp;apos;show.sp?grdid=j2me_newtrk&amp;hdrordtl=2&amp;hdrguid=&amp;quot;+trkguid+&amp;quot;&amp;tousrid=&amp;quot;+ds.getStringAt(0,&amp;quot;crtusr&amp;quot;)+&amp;quot;&amp;action=reply&amp;style=&amp;quot;+show +&amp;quot;&amp;prjid=&amp;quot;+prjid +&amp;quot;&amp;edit=&amp;dd=&amp;apos; target=_blank&amp;gt;回复事务&amp;lt;/a&amp;gt;】&amp;quot; ;
					}else{
						//msg += &amp;quot;&amp;lt;p align=center&amp;gt;您该处理该事务&amp;lt;BR&amp;gt;【&amp;lt;a href=&amp;apos;show.sp?grdid=j2me_newtrk&amp;hdrordtl=2&amp;hdrguid=&amp;quot;+trkguid+&amp;quot;&amp;style=&amp;quot;+show +&amp;quot;&amp;prjid=&amp;quot;+prjid +&amp;quot;&amp;edit=&amp;dd=&amp;browser=4&amp;apos; target=_blank&amp;gt;手机处理事务&amp;lt;/a&amp;gt;】&amp;quot; ;

						msg += &amp;quot;&amp;lt;p align=center&amp;gt;您该处理该事务&amp;lt;BR&amp;gt;【&amp;lt;a href=&amp;apos;show.sp?grdid=HDRTRK&amp;hdrordtl=2&amp;hdrguid=&amp;quot;+trkguid+&amp;quot;&amp;style=&amp;quot;+show +&amp;quot;&amp;prjid=&amp;quot;+prjid +&amp;quot;&amp;edit=&amp;dd=&amp;apos; target=_blank&amp;gt;处理事务&amp;lt;/a&amp;gt;】&amp;quot; ;
						msg += &amp;quot;&amp;lt;BR&amp;gt;【&amp;lt;a href=&amp;apos;show.sp?grdid=HDRTRK&amp;hdrordtl=2&amp;hdrguid=&amp;quot;+trkguid+&amp;quot;&amp;tousrid=&amp;quot;+ds.getStringAt(0,&amp;quot;crtusr&amp;quot;)+&amp;quot;&amp;action=reply&amp;style=&amp;quot;+show +&amp;quot;&amp;prjid=&amp;quot;+prjid +&amp;quot;&amp;edit=&amp;dd=&amp;apos; target=_blank&amp;gt;回复事务&amp;lt;/a&amp;gt;】&amp;quot; ;
					}
					
					msg += &amp;quot;&amp;lt;BR&amp;gt;【&amp;lt;a href=&amp;apos;show.sp?grdid=HDRTRK&amp;hdrordtl=2&amp;hdrguid=&amp;quot;+trkguid+&amp;quot;&amp;tousrid=&amp;quot;+ds.getStringAt(0,&amp;quot;dtlusr&amp;quot;)+&amp;quot;&amp;action=waiting&amp;style=&amp;quot;+show +&amp;quot;&amp;prjid=&amp;quot;+prjid +&amp;quot;&amp;edit=&amp;dd=&amp;apos; target=_blank&amp;gt;设为处理中&amp;lt;/a&amp;gt;】&amp;quot; ;//todoing=y
					msg+&amp;quot;&amp;lt;/p&amp;gt;&amp;quot;;

				}
				
				if ( loginusrid ==crtid &amp;&amp; usrorgid == crtorgid  ){
					if(browser==&amp;quot;4&amp;quot;){
						msg += &amp;quot;&amp;lt;p align=center&amp;gt;您可以结束该事务&amp;lt;BR&amp;gt;【&amp;lt;a href=\&amp;quot;XLSGRID.TRKLAYOUT.EndTrk.osp?trkguid=&amp;quot;+trkguid+&amp;quot;\&amp;quot;  &amp;gt;结束事务&amp;lt;/a&amp;gt;】&amp;quot; ;
					}else{
						msg += &amp;quot;&amp;lt;p align=center&amp;gt;您可以结束该事务&amp;lt;BR&amp;gt;【&amp;lt;a href=\&amp;quot;#\&amp;quot; onclick=\&amp;quot;javascript:if(confirm(&amp;apos;结束该事务，是否继续？&amp;apos;)==1)window.location=&amp;apos;XLSGRID.TRKLAYOUT.EndTrk.osp?trkguid=&amp;quot;+trkguid+&amp;quot;&amp;apos;;\&amp;quot; &amp;gt;结束事务&amp;lt;/a&amp;gt;】&amp;quot; ;
					}//msg += &amp;quot;&amp;lt;BR&amp;gt;【&amp;lt;a href=&amp;apos;show.sp?grdid=HDRTRK&amp;hdrordtl=2&amp;style=&amp;quot;+show +&amp;quot;&amp;edit=&amp;dd=&amp;apos; target=_blank&amp;gt;评分&amp;lt;/a&amp;gt;】&amp;lt;/p&amp;gt;&amp;quot; ;
				}
			}
			if(browser==&amp;quot;4&amp;quot;){
				msg += &amp;quot;&amp;lt;p align=center&amp;gt;您可以发表评论&amp;lt;BR&amp;gt;【&amp;lt;a href=\&amp;quot;show.sp?grdid=j2me_newtrk&amp;hdrordtl=3&amp;hdrguid=&amp;quot;+trkguid+&amp;quot;&amp;style=&amp;quot;+show +&amp;quot;&amp;prjid=&amp;quot;+prjid +&amp;quot;&amp;edit=&amp;dd=\&amp;quot; &amp;gt;发表评论&amp;lt;/a&amp;gt;】&amp;lt;/p&amp;gt;&amp;quot; ;
				
			}else{
				msg += &amp;quot;&amp;lt;p align=center&amp;gt;您可以发表评论&amp;lt;BR&amp;gt;【&amp;lt;a href=\&amp;quot;#\&amp;quot; onclick=\&amp;quot;javascript:window.open(&amp;apos;show.sp?grdid=HDRTRK&amp;hdrordtl=3&amp;hdrguid=&amp;quot;+trkguid+&amp;quot;&amp;style=&amp;quot;+show +&amp;quot;&amp;prjid=&amp;quot;+prjid +&amp;quot;&amp;edit=&amp;dd=&amp;apos;);\&amp;quot;&amp;gt;发表评论&amp;lt;/a&amp;gt;】&amp;lt;/p&amp;gt;&amp;quot; ;
			}
		}
		sql = &amp;quot;select title,pro_note,tousr,to_char(a.crtdat,&amp;apos;YYYY-MM-DD HH24:MI:SS&amp;apos;) crttim,crtusr from trkdtl a where trkguid=&amp;apos;&amp;quot;+trkguid +&amp;quot;&amp;apos; order by crtdat asc&amp;quot;;
		
			
	}
	catch ( ee ) {
		db.Rollback();
		throw new pubpack.EAException ( ee.toString() );
	}
	finally {
		if (db!=null) db.Close();
	}
	return msg;
}

//显示当前位置
function trklocal()//按分类查询的&amp;quot;我的位置&amp;quot;显示
{
	var db = null;
	var msg= &amp;quot;&amp;quot;;
	var DATE=&amp;quot;&amp;quot;;
	try {DATE  = date ;} catch ( e ) {DATE=&amp;quot;&amp;quot;;}
	try {
		db = new pubpack.EADatabase();	// 如果连接到其他数据库, new pubpack.EADatabase(“dbname”)
		var sql = &amp;quot;&amp;quot;;
		
		// 日期
		if ( DATE!=&amp;quot;&amp;quot; ) {
			msg +=&amp;quot;创建日期:&amp;quot;+ DATE+&amp;quot;&amp;lt;BR&amp;gt;&amp;quot;;
		}
		// 查找项目
		sql = &amp;quot;select &amp;apos;项目:&amp;apos;||b.name name from prj b where b.id = &amp;apos;&amp;quot;+trkprj+&amp;quot;&amp;apos;&amp;quot; ;
		var ds = db.QuerySQL(sql);
		if ( ds.getRowCount() &amp;gt; 0 ) {
			msg += ds.getStringAt(0,&amp;quot;name&amp;quot;)+&amp;quot;&amp;lt;BR&amp;gt;&amp;quot;;
		}
		// 查找创建人
		sql = &amp;quot;select &amp;apos;创建人:&amp;apos;||b.name name  from usr b where b.id = &amp;apos;&amp;quot;+trkusr+&amp;quot;&amp;apos;&amp;quot; ;
		ds = db.QuerySQL(sql);
		if ( ds.getRowCount() &amp;gt; 0 ) {
			msg += ds.getStringAt(0,&amp;quot;name&amp;quot;)+&amp;quot;&amp;lt;BR&amp;gt;&amp;quot;;
		}
		
		// 查找事务类型
		sql = &amp;quot;select &amp;apos;类型:&amp;apos;||b.name||&amp;apos;&amp;lt;BR&amp;gt;说明:&amp;apos;||b.note||&amp;apos;&amp;lt;BR&amp;gt;&amp;apos; name from trktyp b where b.id = &amp;apos;&amp;quot;+trktyp+&amp;quot;&amp;apos;&amp;quot; ;
		ds = db.QuerySQL(sql);
		if ( ds.getRowCount() &amp;gt; 0 ) {
			msg += ds.getStringAt(0,&amp;quot;name&amp;quot;);
			msg+=&amp;quot;&amp;lt;BR&amp;gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;lt;a href=&amp;apos;show.sp?grdid=HDRTRK&amp;style=&amp;quot;+trktyp+&amp;quot;&amp;edit=save&amp;dd=0&amp;prj=&amp;quot;+trkprj+&amp;quot;&amp;apos; target=\&amp;quot;_blank\&amp;quot;&amp;gt;新增事务&amp;gt;&amp;gt;&amp;lt;/a&amp;gt;&amp;quot;;
		}
		
		
			
		
//		var sql = &amp;quot;  SELECT MAX(a.ID) ID,MAX(A.GUID) GUID,&amp;quot;+
//        	&amp;quot;a.name||&amp;apos;&amp;apos;||(case MAX(C.COU) when 1 then &amp;apos;--&amp;gt;&amp;apos;||max(c.name)||&amp;apos;&amp;apos; else &amp;apos;&amp;apos; end)||&amp;apos;&amp;lt;BR&amp;gt;&amp;apos;||note||&amp;apos;&amp;lt;BR&amp;gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;lt;a href=&amp;apos;&amp;apos;show.sp?grdid=HDRTRK&amp;style=&amp;quot;+trktyp+&amp;quot;&amp;edit=save&amp;dd=0&amp;prj=&amp;quot;+trkprj+&amp;quot;&amp;apos;&amp;apos;&amp;gt;新增事务&amp;gt;&amp;gt;&amp;lt;/a&amp;gt;&amp;apos; NAME &amp;quot;+
//        	&amp;quot;FROM (select &amp;apos;类型:&amp;apos;||b.name name,b.guid,b.id,&amp;apos;说明:&amp;apos;||b.note note from trktyp b where b.id = &amp;apos;&amp;quot;+trktyp+&amp;quot;&amp;apos;) A,&amp;quot;+
//       		&amp;quot;(select max(d.name) name,count(*) COU from prj d where d.id = &amp;apos;&amp;quot;+trkprj+&amp;quot;&amp;apos; ) C &amp;quot;+
//  		&amp;quot;group by a.name,a.note&amp;quot;;
//		var ds = db.QuerySQL(sql);
//		if ( ds.getRowCount() &amp;gt; 0 ) {
//			msg = ds.getStringAt(0,&amp;quot;name&amp;quot;);
//		}
//		
	}
	
	catch ( ee ) {
		db.Rollback();
		throw new pubpack.EAException ( ee.toString() );
	}
	finally {
		if (db!=null) db.Close();
	}
	return msg;
}
// 首页的登录信息
function LoginInfo()
{
	var ret= &amp;quot;&amp;quot;;
	var usrinfo = webpack.EASession.GetLoginInfo(request);
	var usrid = usrinfo.getUsrid();
	var usrorgid = usrinfo.getusrOrg();
	var db = null;
	ret = &amp;quot;欢迎您，&amp;quot;+usrinfo.getUsrnam()+&amp;quot;&amp;lt;BR&amp;gt;&amp;quot;;
	try {
		db = new pubpack.EADatabase();	// 如果连接到其他数据库, new pubpack.EADatabase(“dbname”)
		var sql = &amp;quot;select * from( select to_char(crtdat,&amp;apos;MM/DD HH24:MI&amp;apos;) tim from usrlog where usrid=&amp;apos;&amp;quot;+usrid +&amp;quot;&amp;apos; and org=&amp;apos;&amp;quot;+usrorgid +&amp;quot;&amp;apos; and action=&amp;apos;登录系统&amp;apos; order by crtdat desc) where rownum&amp;lt;=2 &amp;quot;;
		var ds =db.QuerySQL(sql);
		if ( ds.getRowCount() &amp;gt; 1 ) {
			ret+=&amp;quot;您最后一次登录时间是&amp;quot;+ds.getStringAt(1,&amp;quot;TIM&amp;quot;) +&amp;quot;&amp;lt;BR&amp;gt;&amp;quot;;
		}
		sql = &amp;quot; select count(*) CNT from OALOG where usrid=&amp;apos;&amp;quot;+usrid +&amp;quot;&amp;apos; and org=&amp;apos;&amp;quot;+usrorgid +&amp;quot;&amp;apos; and ( mwtyp=&amp;apos;TRKDTL1&amp;apos; or mwtyp=&amp;apos;TRKHDR&amp;apos;) and to_char(crtdat,&amp;apos;YYMM&amp;apos;)=to_char(sysdate,&amp;apos;YYMM&amp;apos;)  &amp;quot;;
		ds =db.QuerySQL(sql);
		if ( ds.getRowCount() &amp;gt; 0 ) {
			ret+=&amp;quot;本月事务处理量&amp;quot;+ds.getStringAt(0,&amp;quot;CNT&amp;quot;) +&amp;quot;条 &amp;quot;;
		}
		sql = &amp;quot; select count(*) CNT from OALOG where usrid=&amp;apos;&amp;quot;+usrid +&amp;quot;&amp;apos; and org=&amp;apos;&amp;quot;+usrorgid +&amp;quot;&amp;apos; and to_char(crtdat,&amp;apos;YYMM&amp;apos;)=to_char(sysdate,&amp;apos;YYMM&amp;apos;) &amp;quot;;
		ds =db.QuerySQL(sql);
		if ( ds.getRowCount() &amp;gt; 0 ) {
			ret+=&amp;quot;活跃度&amp;quot;+ds.getStringAt(0,&amp;quot;CNT&amp;quot;) +&amp;quot;&amp;lt;BR&amp;gt;&amp;quot;;
		}
		sql = &amp;quot; select to_char(crtdat,&amp;apos;HH24:MI&amp;apos;) TIM from SIGNIN where usrid=&amp;apos;&amp;quot;+usrid +&amp;quot;&amp;apos; and org=&amp;apos;&amp;quot;+usrorgid +&amp;quot;&amp;apos; and to_char(crtdat,&amp;apos;YYMMDD&amp;apos;)=to_char(sysdate,&amp;apos;YYMMDD&amp;apos;) order by crtdat asc&amp;quot;;
		ds =db.QuerySQL(sql);
		if ( ds.getRowCount() &amp;gt; 0 ) {
			ret+=&amp;quot;今天&amp;quot;+ds.getStringAt(0,&amp;quot;TIM&amp;quot;)+&amp;quot;已签到&amp;lt;BR&amp;gt;&amp;quot;;
		}
		else 
			ret+=&amp;quot;&amp;lt;a href=\&amp;quot;show.sp?grdid=TRK_SIGNIN\&amp;quot;  target=_blank&amp;gt;&amp;lt;font color=&amp;apos;#FF0000&amp;apos;&amp;gt;您今天没签到，点击签到&amp;lt;/font&amp;gt;&amp;lt;/a&amp;gt;&amp;quot;;
		//ret+=&amp;quot;&amp;nbsp;&amp;quot;;
		//ret+=&amp;quot;&amp;lt;form name=&amp;apos;fsearch&amp;apos; action=&amp;apos;Layout.sp&amp;apos;&amp;gt;&amp;nbsp;&amp;lt;input id=\&amp;quot;query\&amp;quot; style=&amp;apos;COLOR: #aaaaaa;border: 1px solid #0A246A; font-family:宋体; font-size:9pt&amp;apos; onfocus=\&amp;quot;if(document.all(&amp;apos;query&amp;apos;).value==&amp;apos;请输入...&amp;apos;)document.all(&amp;apos;query&amp;apos;).value=&amp;apos;&amp;apos;;\&amp;quot; size=\&amp;quot;18\&amp;quot; value=\&amp;quot;请输入...\&amp;quot; onclick=\&amp;quot; if(this.value==&amp;apos;请输入...&amp;apos;)this.value=&amp;apos;&amp;apos;\&amp;quot; name=\&amp;quot;query\&amp;quot;&amp;gt;&amp;nbsp;&amp;lt;a href=\&amp;quot;#\&amp;quot; onclick=\&amp;quot;fsearch.submit();\&amp;quot;&amp;gt;开始搜索&amp;lt;/a&amp;gt;&amp;quot;;
		//ret+=&amp;quot;&amp;lt;a href=\&amp;quot;#\&amp;quot; onclick=\&amp;quot;fsearch.submit();\&amp;quot;&amp;gt;开始搜索&amp;lt;/a&amp;gt;&amp;lt;input type=&amp;apos;hidden&amp;apos; name =&amp;apos;id&amp;apos; value=&amp;apos;SearchTrk&amp;apos;&amp;gt;&amp;quot;;
		//ret+=&amp;quot;&amp;lt;input type=&amp;apos;hidden&amp;apos; name =&amp;apos;encoding&amp;apos; value=&amp;apos;UTF-8&amp;apos;&amp;gt;&amp;lt;/form&amp;gt;&amp;quot;;
		//		ret+=&amp;quot;&amp;lt;form name=&amp;apos;fsearch&amp;apos; action=&amp;apos;Layout.sp&amp;apos;&amp;gt;&amp;nbsp;&amp;lt;input id=\&amp;quot;query\&amp;quot; style=&amp;apos;COLOR: #aaaaaa;border: 1px solid #0A246A; font-family:宋体; font-size:9pt&amp;apos; onfocus=\&amp;quot;if(document.all(&amp;apos;query&amp;apos;).value==&amp;apos;请输入...&amp;apos;)document.all(&amp;apos;query&amp;apos;).value=&amp;apos;&amp;apos;;\&amp;quot; size=\&amp;quot;18\&amp;quot; value=\&amp;quot;请输入...\&amp;quot; onclick=\&amp;quot; if(this.value==&amp;apos;请输入...&amp;apos;)this.value=&amp;apos;&amp;apos;\&amp;quot; name=\&amp;quot;query\&amp;quot;&amp;gt;&amp;nbsp;&amp;lt;a href=\&amp;quot;#\&amp;quot; onclick=\&amp;quot;fsearch.submit();\&amp;quot;&amp;gt;开始搜索&amp;lt;/a&amp;gt;&amp;lt;input type=&amp;apos;hidden&amp;apos; name =&amp;apos;id&amp;apos; value=&amp;apos;SearchTrk&amp;apos;&amp;gt;&amp;lt;input type=&amp;apos;hidden&amp;apos; name =&amp;apos;ignoreencoding&amp;apos; value=&amp;apos;1&amp;apos;&amp;gt;&amp;lt;input type=&amp;apos;hidden&amp;apos; name =&amp;apos;encoding&amp;apos; value=&amp;apos;UTF-8&amp;apos;&amp;gt;&amp;lt;/form&amp;gt;&amp;quot;;

	
	}
	catch ( ee ) {
		db.Rollback();
		throw new pubpack.EAException ( ee.toString() );
	}
	finally {
		if (db!=null) db.Close();
	}


	return ret;
}

//按项目分类列表 有全部按钮
function trkprjlist(){
	var DATE=&amp;quot;&amp;quot;;
	try {DATE  = date ;} catch ( e ) {DATE=&amp;quot;&amp;quot;;}
	var WORKTYPE=&amp;quot;1&amp;quot;;
	//当worktype=1:只显示title 2:title,note都显示
	try {WORKTYPE  = worktype ;} catch ( e ) {WORKTYPE=&amp;quot;1&amp;quot;;}

	var db = null;
	var msg= &amp;quot;&amp;quot;;//是显示的html语句
	var url=&amp;quot;Layout.sp?id=&amp;quot;+id+&amp;quot;&amp;trkusr=&amp;quot;+trkusr+&amp;quot;&amp;trktyp=&amp;quot;+trktyp+&amp;quot;&amp;worktyp=&amp;quot;+worktyp+&amp;quot;&amp;worktype=&amp;quot;+WORKTYPE+&amp;quot;&amp;date=&amp;quot;+DATE;
	//worktyp   1 待办事务 2 创建的事务 3 日志
	var where=&amp;quot;&amp;quot;;
	if (worktyp==&amp;quot;1&amp;quot;){
		where =&amp;quot; and b.stat&amp;lt;&amp;gt;&amp;apos;3&amp;apos; and e.id not in (&amp;apos;5&amp;apos;,&amp;apos;6&amp;apos;,&amp;apos;7&amp;apos;,&amp;apos;8&amp;apos;,&amp;apos;9&amp;apos;,&amp;apos;10&amp;apos;,&amp;apos;16&amp;apos;,&amp;apos;17&amp;apos;) &amp;quot;;
	}
	try {
		db = new pubpack.EADatabase();	// 如果连接到其他数据库, new pubpack.EADatabase(“dbname”)
		var sql = &amp;quot;SELECT A.ID,A.NAME||&amp;apos;(&amp;apos;||COUNT(*)||&amp;apos;)&amp;apos; NAME,A.GUID ,&amp;apos;&amp;quot;+
		url+&amp;quot;&amp;trkprj=&amp;apos;|| A.id  url &amp;quot;+
		&amp;quot;FROM PRJ A,TRKHDR B ,trktyp e,v_trkstat d &amp;quot;+
		&amp;quot;WHERE B.PROJECT=A.ID AND B.SHOW LIKE &amp;apos;&amp;quot;+trktyp+&amp;quot;%&amp;apos; &amp;quot;+
		&amp;quot;and b.crtusr like &amp;apos;&amp;quot;+trkusr+&amp;quot;%&amp;apos;&amp;quot;+
		&amp;quot;and b.dtlusr like &amp;apos;&amp;quot;+trkusr+&amp;quot;%&amp;apos;&amp;quot;+
		&amp;quot;and b.show=e.id &amp;quot;+
		&amp;quot;and  b.stat=d.id  &amp;quot;+
		where +
		&amp;quot;and to_char(b.crtdat,&amp;apos;YYYY-MM-DD HH24:MI:SS&amp;apos;) like &amp;apos;%&amp;quot;+DATE+&amp;quot;%&amp;apos;&amp;quot;+
		&amp;quot;GROUP BY A.ID,A.NAME,A.GUID &amp;quot;+
		&amp;quot;ORDER BY A.ID&amp;quot;;
		msg=msg+&amp;quot;&amp;lt;td valign=\&amp;quot;top\&amp;quot;&amp;gt;&amp;quot;+
		&amp;quot;&amp;lt;font color=\&amp;quot;#014E82\&amp;quot;&amp;gt;&amp;quot;+
		&amp;quot;&amp;lt;table width=\&amp;quot;100%\&amp;quot; align=\&amp;quot;left\&amp;quot; border=\&amp;quot;0\&amp;quot; cellpadding=\&amp;quot;1\&amp;quot;&amp;gt;&amp;quot;+
		&amp;quot;&amp;lt;tbody&amp;gt;&amp;quot;;//
		var ds = db.QuerySQL(sql);
		for( var i=0 ;i&amp;lt;ds.getRowCount(); i++ ) {
			msg = msg+&amp;quot;&amp;lt;tr&amp;gt; &amp;lt;td width=100%  &amp;gt;&amp;lt;a href=&amp;apos;#&amp;apos; onclick=\&amp;quot;javascript:window.location=&amp;apos;&amp;quot;+ds.getStringAt(i,&amp;quot;url&amp;quot;)+&amp;quot;&amp;apos;;\&amp;quot;&amp;gt;&amp;quot;+ds.getStringAt(i,&amp;quot;name&amp;quot;)+&amp;quot;&amp;lt;/a&amp;gt;&amp;lt;/td&amp;gt;&amp;lt;/tr&amp;gt;&amp;quot;;
		}
		msg = msg+&amp;quot;&amp;lt;tr&amp;gt; &amp;lt;td width=100%  &amp;gt;&amp;lt;a href=&amp;apos;#&amp;apos; onclick=\&amp;quot;javascript:window.location=&amp;apos;&amp;quot;+url+&amp;quot;&amp;trkprj=&amp;quot;+&amp;quot;&amp;apos;;\&amp;quot;&amp;gt;&amp;quot;+&amp;quot;全部&amp;quot;+&amp;quot;&amp;lt;/a&amp;gt;&amp;lt;/td&amp;gt;&amp;lt;/tr&amp;gt;&amp;quot;;//添加全部按钮
		msg=msg+&amp;quot;&amp;lt;/tbody&amp;gt;&amp;quot;+&amp;quot;&amp;lt;/table&amp;gt;&amp;quot;+&amp;quot;&amp;lt;/font&amp;gt;&amp;quot;+&amp;quot;&amp;lt;/td&amp;gt;&amp;quot;;
		
	}
	catch ( ee ) {
		db.Rollback();
		throw new pubpack.EAException ( ee.toString() );
	}
	finally {
		if (db!=null) db.Close();
	}
	return msg;//直接返回html语句

}
//按类型分类列表 有全部按钮
function trktyplist(){
	var DATE=&amp;quot;&amp;quot;;
	try {DATE  = date ;} catch ( e ) {DATE=&amp;quot;&amp;quot;;}
	var WORKTYPE=&amp;quot;1&amp;quot;;
	//当worktype=1:只显示title 2:title,note都显示
	try {WORKTYPE  = worktype ;} catch ( e ) {WORKTYPE=&amp;quot;1&amp;quot;;}

	var db = null;
	var msg= &amp;quot;&amp;quot;;//是显示的html语句
	
	var url=&amp;quot;Layout.sp?id=&amp;quot;+id+&amp;quot;&amp;trkusr=&amp;quot;+trkusr+&amp;quot;&amp;trkprj=&amp;quot;+trkprj+&amp;quot;&amp;worktyp=&amp;quot;+worktyp+&amp;quot;&amp;worktype=&amp;quot;+WORKTYPE+&amp;quot;&amp;date=&amp;quot;+DATE;
	//worktyp   1 待办事务 2 创建的事务 3 日志
	var where=&amp;quot;&amp;quot;;
	if (worktyp==&amp;quot;1&amp;quot;){
		where =&amp;quot; and b.stat&amp;lt;&amp;gt;&amp;apos;3&amp;apos; and e.id not in (&amp;apos;5&amp;apos;,&amp;apos;6&amp;apos;,&amp;apos;7&amp;apos;,&amp;apos;8&amp;apos;,&amp;apos;9&amp;apos;,&amp;apos;10&amp;apos;,&amp;apos;16&amp;apos;,&amp;apos;17&amp;apos;) &amp;quot;;
	}
	try {
		db = new pubpack.EADatabase();	// 如果连接到其他数据库, new pubpack.EADatabase(“dbname”)
		var sql = &amp;quot;SELECT a.id,&amp;apos; &amp;apos;||A.NAME||&amp;apos;(&amp;apos;||COUNT(*)||&amp;apos;)&amp;apos; NAME,A.GUID ,&amp;apos;&amp;quot;+
		url+&amp;quot;&amp;trktyp=&amp;apos;|| A.id  url &amp;quot;+
		&amp;quot;FROM trktyp A,TRKHDR B,trktyp e,v_trkstat d  &amp;quot;+
		&amp;quot;WHERE B.SHOW=A.ID and b.project like &amp;apos;&amp;quot;+trkprj+&amp;quot;%&amp;apos; &amp;quot;+
		&amp;quot;and b.crtusr like &amp;apos;&amp;quot;+trkusr+&amp;quot;%&amp;apos; &amp;quot;+
		&amp;quot;and b.show=e.id &amp;quot;+
		&amp;quot;and  b.stat=d.id  &amp;quot;+
		where+
		&amp;quot;and to_char(b.crtdat,&amp;apos;YYYY-MM-DD HH24:MI:SS&amp;apos;) like &amp;apos;%&amp;quot;+DATE+&amp;quot;%&amp;apos;&amp;quot;+
		&amp;quot;GROUP BY A.ID,A.NAME,A.GUID &amp;quot;+
		&amp;quot;ORDER BY A.ID&amp;quot;;
		msg=msg+&amp;quot;&amp;lt;td valign=\&amp;quot;top\&amp;quot;&amp;gt;&amp;quot;+
		&amp;quot;&amp;lt;font color=\&amp;quot;#014E82\&amp;quot;&amp;gt;&amp;quot;+
		&amp;quot;&amp;lt;table width=\&amp;quot;100%\&amp;quot; align=\&amp;quot;left\&amp;quot; border=\&amp;quot;0\&amp;quot; cellpadding=\&amp;quot;1\&amp;quot;&amp;gt;&amp;quot;+
		&amp;quot;&amp;lt;tbody&amp;gt;&amp;quot;;//编写格式,对齐方式为左对齐,置顶
		var ds = db.QuerySQL(sql);
		for( var i=0 ;i&amp;lt;ds.getRowCount(); i++ ) {
			msg = msg+&amp;quot;&amp;lt;tr&amp;gt; &amp;lt;td width=100%  &amp;gt;&amp;lt;a href=&amp;apos;#&amp;apos; onclick=\&amp;quot;javascript:window.location=&amp;apos;&amp;quot;+ds.getStringAt(i,&amp;quot;url&amp;quot;)+&amp;quot;&amp;apos;;\&amp;quot;&amp;gt;&amp;quot;+ds.getStringAt(i,&amp;quot;name&amp;quot;)+&amp;quot;&amp;lt;/a&amp;gt;&amp;lt;/td&amp;gt;&amp;lt;/tr&amp;gt;&amp;quot;;
		}
		msg = msg+&amp;quot;&amp;lt;tr&amp;gt; &amp;lt;td width=100%  &amp;gt;&amp;lt;a href=&amp;apos;#&amp;apos; onclick=\&amp;quot;javascript:window.location=&amp;apos;&amp;quot;+url+&amp;quot;&amp;trktyp=&amp;apos;;\&amp;quot;&amp;gt;&amp;quot;+&amp;quot;全部&amp;quot;+&amp;quot;&amp;lt;/a&amp;gt;&amp;lt;/td&amp;gt;&amp;lt;/tr&amp;gt;&amp;quot;;//添加全部按钮
		msg=msg+&amp;quot;&amp;lt;/tbody&amp;gt;&amp;quot;+&amp;quot;&amp;lt;/table&amp;gt;&amp;quot;+&amp;quot;&amp;lt;/font&amp;gt;&amp;quot;+&amp;quot;&amp;lt;/td&amp;gt;&amp;quot;;
		
	}
	catch ( ee ) {
		db.Rollback();
		throw new pubpack.EAException ( ee.toString() );
	}
	finally {
		if (db!=null) db.Close();
	}
	return msg;//直接返回html语句

}
//按创建人分类列表 有全部按钮
function trkusrlist(){
	var DATE=&amp;quot;&amp;quot;;
	try {DATE  = date ;} catch ( e ) {DATE=&amp;quot;&amp;quot;;}
	var WORKTYPE=&amp;quot;1&amp;quot;;
	//当worktype=1:只显示title 2:title,note都显示
	try {WORKTYPE  = worktype ;} catch ( e ) {WORKTYPE=&amp;quot;1&amp;quot;;}
	
	
	var db = null;
	var msg= &amp;quot;&amp;quot;;//是显示的html语句
	var url=&amp;quot;Layout.sp?id=&amp;quot;+id+&amp;quot;&amp;trktyp=&amp;quot;+trktyp+&amp;quot;&amp;trkprj=&amp;quot;+trkprj+&amp;quot;&amp;worktyp=&amp;quot;+worktyp+&amp;quot;&amp;worktype=&amp;quot;+WORKTYPE+&amp;quot;&amp;date=&amp;quot;+DATE;
	var where=&amp;quot;&amp;quot;;
	//worktyp   1 待办事务 2 创建的事务 3 日志
	if (worktyp==&amp;quot;1&amp;quot;){
		where =&amp;quot; and b.stat&amp;lt;&amp;gt;&amp;apos;3&amp;apos; and e.id not in (&amp;apos;5&amp;apos;,&amp;apos;6&amp;apos;,&amp;apos;7&amp;apos;,&amp;apos;8&amp;apos;,&amp;apos;9&amp;apos;,&amp;apos;10&amp;apos;,&amp;apos;16&amp;apos;,&amp;apos;17&amp;apos;) &amp;quot;;
	}
	try {
		db = new pubpack.EADatabase();	// 如果连接到其他数据库, new pubpack.EADatabase(“dbname”)
		var sql = &amp;quot;SELECT distinct max(a.id) id,&amp;apos; &amp;apos;||A.NAME||&amp;apos;(&amp;apos;||COUNT(*)||&amp;apos;)&amp;apos; NAME,max(A.GUID) guid ,&amp;apos;&amp;quot;+
		url+&amp;quot;&amp;trkusr=&amp;apos;|| max(A.id)  url &amp;quot;+
		&amp;quot;FROM v_usr9 A,TRKHDR B ,trktyp e,v_usr9 cc ,v_trkstat d &amp;quot;+
		&amp;quot;WHERE B.crtusr=A.ID and b.project like &amp;apos;&amp;quot;+trkprj+&amp;quot;%&amp;apos; &amp;quot;+
		&amp;quot;and b.show like &amp;apos;&amp;quot;+trktyp+&amp;quot;%&amp;apos;&amp;quot;+
		&amp;quot;and b.show=e.id &amp;quot;+
		&amp;quot;and b.crtusr=cc.id  &amp;quot;+
		&amp;quot;and  b.stat=d.id  &amp;quot;+
		where+
		&amp;quot;and to_char(b.crtdat,&amp;apos;YYYY-MM-DD HH24:MI:SS&amp;apos;) like &amp;apos;%&amp;quot;+DATE+&amp;quot;%&amp;apos;&amp;quot;+
		&amp;quot;GROUP BY A.NAME &amp;quot;;
//		&amp;quot;ORDER BY A.ID&amp;quot;;
		msg=msg+&amp;quot;&amp;lt;td valign=\&amp;quot;top\&amp;quot;&amp;gt;&amp;quot;+
		&amp;quot;&amp;lt;font color=\&amp;quot;#014E82\&amp;quot;&amp;gt;&amp;quot;+
		&amp;quot;&amp;lt;table width=\&amp;quot;100%\&amp;quot; align=\&amp;quot;left\&amp;quot; border=\&amp;quot;0\&amp;quot; cellpadding=\&amp;quot;1\&amp;quot;&amp;gt;&amp;quot;+
		&amp;quot;&amp;lt;tbody&amp;gt;&amp;quot;;//编写格式,对齐方式为左对齐,置顶
		var ds = db.QuerySQL(sql);
		for( var i=0 ;i&amp;lt;ds.getRowCount(); i++ ) {
			msg = msg+&amp;quot;&amp;lt;tr&amp;gt; &amp;lt;td width=100%  &amp;gt;&amp;lt;a href=&amp;apos;#&amp;apos; onclick=\&amp;quot;javascript:window.location=&amp;apos;&amp;quot;+ds.getStringAt(i,&amp;quot;url&amp;quot;)+&amp;quot;&amp;apos;;\&amp;quot;&amp;gt;&amp;quot;+ds.getStringAt(i,&amp;quot;name&amp;quot;)+&amp;quot;&amp;lt;/a&amp;gt;&amp;lt;/td&amp;gt;&amp;lt;/tr&amp;gt;&amp;quot;;
		}
		msg = msg+&amp;quot;&amp;lt;tr&amp;gt; &amp;lt;td width=100%  &amp;gt;&amp;lt;a href=&amp;apos;#&amp;apos; onclick=\&amp;quot;javascript:window.location=&amp;apos;&amp;quot;+url+&amp;quot;&amp;trkusr=&amp;apos;;\&amp;quot;&amp;gt;&amp;quot;+&amp;quot;全部&amp;quot;+&amp;quot;&amp;lt;/a&amp;gt;&amp;lt;/td&amp;gt;&amp;lt;/tr&amp;gt;&amp;quot;;//添加全部按钮
		msg=msg+&amp;quot;&amp;lt;/tbody&amp;gt;&amp;quot;+&amp;quot;&amp;lt;/table&amp;gt;&amp;quot;+&amp;quot;&amp;lt;/font&amp;gt;&amp;quot;+&amp;quot;&amp;lt;/td&amp;gt;&amp;quot;;
		
	}
	catch ( ee ) {
		db.Rollback();
		throw new pubpack.EAException ( ee.toString() );
	}
	finally {
		if (db!=null) db.Close();
	}
	return msg;//直接返回html语句

}
//按日期查询
function trkdate(){
	//获取当前日期
	var DATE=&amp;quot;&amp;quot;;
	try {DATE  = date ;
		if (DATE==&amp;quot;&amp;quot;){//当DATE为空时,同时也要设定为默认值
			throw new Exception();//抛出错误执行catch
		}
	} catch ( e ) {
		var db=null;
		var sqldate=&amp;quot;select sysdate from dual&amp;quot;;
		db = new pubpack.EADatabase();
		var ds = db.QuerySQL(sqldate);
		var dat=&amp;quot;&amp;quot;;
		if ( ds.getRowCount() &amp;gt; 0 ) 
		dat =  ds.getStringAt(0,&amp;quot;sysdate&amp;quot;);
		DATE=dat;
	}
	var url=&amp;quot;Layout.sp?id=&amp;quot;+id+&amp;quot;&amp;trkusr=&amp;quot;+trkusr+&amp;quot;&amp;trktyp=&amp;quot;+trktyp+&amp;quot;&amp;trkprj=&amp;quot;+trkprj+&amp;quot;&amp;worktyp=&amp;quot;+worktyp;
	//throw new Exception(DATE);
	var msg=&amp;quot;日期&amp;quot;; 
	msg+=&amp;quot;&amp;lt;script language=\&amp;quot;javascript\&amp;quot;&amp;gt;
	function dateSubmit(form){
	var DATE=document.getElementsByName(\&amp;quot;date\&amp;quot;)[0].value;
	var url=\&amp;quot;&amp;quot;+url+&amp;quot;&amp;worktype=2&amp;date=\&amp;quot;+DATE+\&amp;quot;\&amp;quot;;
	window.location = url;
	}&amp;lt;/script&amp;gt;&amp;quot;;
	msg+=&amp;quot;&amp;lt;input name=\&amp;quot;date\&amp;quot; type=\&amp;quot;\&amp;quot; value=\&amp;quot;&amp;quot;+DATE+&amp;quot;\&amp;quot;&amp;gt; &amp;lt;a href=\&amp;quot;#\&amp;quot; onclick=\&amp;quot;dateSubmit()\&amp;quot;&amp;gt;查找&amp;lt;/a&amp;gt; &amp;quot;;
	
	
	
	
	//显示最近7天的记录
	var DATE=&amp;quot;&amp;quot;;
	try {DATE  = date ;} catch ( e ) {DATE=&amp;quot;&amp;quot;;}
	var WORKTYPE=&amp;quot;1&amp;quot;;
	//当worktype=1:只显示title 2:title,note都显示
	try {WORKTYPE  = worktype ;} catch ( e ) {WORKTYPE=&amp;quot;1&amp;quot;;}

	var db = null;
	//var msg= &amp;quot;&amp;quot;;//是显示的html语句
	//worktyp=区分用来只显示当前用户的事务
	//worktype 是否显示事务的内容
	var url=&amp;quot;Layout.sp?id=&amp;quot;+id+&amp;quot;&amp;trkusr=&amp;quot;+trkusr+&amp;quot;&amp;trkprj=&amp;quot;+trkprj+&amp;quot;&amp;worktyp=&amp;quot;+worktyp+&amp;quot;&amp;worktype=2&amp;trktyp=&amp;quot;+trktyp;
	var where=&amp;quot;&amp;quot;;
	if (worktyp==&amp;quot;1&amp;quot;){
		where =&amp;quot; and b.stat&amp;lt;&amp;gt;&amp;apos;3&amp;apos; and e.id not in (&amp;apos;5&amp;apos;,&amp;apos;6&amp;apos;,&amp;apos;7&amp;apos;,&amp;apos;8&amp;apos;,&amp;apos;9&amp;apos;,&amp;apos;10&amp;apos;,&amp;apos;16&amp;apos;,&amp;apos;17&amp;apos;) &amp;quot;;
	}
	try {
		db = new pubpack.EADatabase();	// 如果连接到其他数据库, new pubpack.EADatabase(“dbname”)
		var sql = &amp;quot;SELECT &amp;apos;&amp;apos; id,&amp;apos; &amp;apos;||to_char(b.crtdat, &amp;apos;YYYY-MM-DD&amp;apos;)||&amp;apos;(&amp;apos;||COUNT(*)||&amp;apos;)&amp;apos; NAME,&amp;apos;&amp;apos; guid ,&amp;apos;&amp;quot;+
		url+&amp;quot;&amp;date=&amp;apos;|| to_char(b.crtdat, &amp;apos;YYYY-MM-DD&amp;apos;)  url &amp;quot;+
		&amp;quot;FROM trktyp A,TRKHDR B,trktyp e,v_trkstat d  &amp;quot;+
		&amp;quot;WHERE B.SHOW=A.ID and b.project like &amp;apos;&amp;quot;+trkprj+&amp;quot;%&amp;apos; &amp;quot;+
		&amp;quot;and b.crtusr like &amp;apos;&amp;quot;+trkusr+&amp;quot;%&amp;apos; &amp;quot;+
		&amp;quot;and b.show like &amp;apos;&amp;quot;+trktyp+&amp;quot;%&amp;apos;&amp;quot;+
		&amp;quot;and b.show=e.id &amp;quot;+
		&amp;quot;and  b.stat=d.id  &amp;quot;+
		where+
		&amp;quot;and to_char(b.crtdat, &amp;apos;YYYY-MM-DD HH24:MI:SS&amp;apos;) &amp;gt; to_char(sysdate-7,&amp;apos;YYYY-MM-DD&amp;apos;)&amp;quot;+
		&amp;quot;GROUP BY to_char(b.crtdat, &amp;apos;YYYY-MM-DD&amp;apos;)&amp;quot;+
		&amp;quot;ORDER BY to_char(b.crtdat, &amp;apos;YYYY-MM-DD&amp;apos;) desc&amp;quot;;
		//throw new Exception(sql);
		var ds = db.QuerySQL(sql);
		for( var i=0 ;i&amp;lt;ds.getRowCount(); i++ ) {
			msg = msg+&amp;quot;&amp;lt;tr&amp;gt; &amp;lt;td width=100%  &amp;gt;&amp;lt;a href=&amp;apos;#&amp;apos; onclick=\&amp;quot;javascript:window.location=&amp;apos;&amp;quot;+ds.getStringAt(i,&amp;quot;url&amp;quot;)+&amp;quot;&amp;apos;;\&amp;quot;&amp;gt;&amp;quot;+ds.getStringAt(i,&amp;quot;name&amp;quot;)+&amp;quot;&amp;lt;/a&amp;gt;&amp;lt;/td&amp;gt;&amp;lt;/tr&amp;gt;&amp;quot;;
		}

		
	}
	catch ( ee ) {
		db.Rollback();
		throw new pubpack.EAException ( ee.toString() );
	}
	finally {
		if (db!=null) db.Close();
	}


	
	
	return msg;
}
//显示事务的列表,包含有显示title,not,或者只显示title的列表, 当worktype=1:只显示title 2:title,note,处理过程等都显示
function trkall(){ 

	var usrinfo = webpack.EASession.GetLoginInfo(request);
	var loginusrid = usrinfo.getUsrid();
	var loginorgid = usrinfo.getusrOrg();
	var DATE=&amp;quot;&amp;quot;;
	try {DATE  = date ;} catch ( e ) {DATE=&amp;quot;&amp;quot;;}
	var WORKTYPE=&amp;quot;1&amp;quot;;
	//当worktype=1:只显示title 2:title,note都显示
	try {WORKTYPE  = worktype ;} catch ( e ) {WORKTYPE=&amp;quot;1&amp;quot;;}
	var db = null;
	var msg= &amp;quot;&amp;quot;;//是显示的html语句
	//	listtyp:  1 为我的待办事务 2 为我创建的事务 3为 日志
	var sql = &amp;quot;&amp;quot;;
	
	sql+=&amp;quot;select distinct &amp;apos;●&amp;apos; || a.title || &amp;apos; &amp;apos; || to_char(a.crtdat, &amp;apos;YY/MM/DD&amp;apos;) ||
	&amp;apos;    &amp;apos; || b.name name,
	a.id,
	a.guid,
	&amp;apos;Layout.sp?id=trkquery&amp;trkguid=&amp;apos; || a.guid url,
	a.crtdat,a.note,a.title,b.name crtusr,to_char(a.crtdat,&amp;apos;YYYY-MM-DD HH24:MI:SS&amp;apos;) crttim,a.filenote,a.imagenote,a.filepath,
	a.imagepath,a.crtusr crtusrid
	from trkhdr a, usr b&amp;quot;;
	
	var where= &amp;quot; where b.id(+) = a.crtusr
	and a.show like &amp;apos;&amp;quot;+trktyp+&amp;quot;%&amp;apos;
	and NVL(a.PROJECT, &amp;apos; &amp;apos;) like &amp;apos;&amp;quot;+trkprj+&amp;quot;%&amp;apos;
	and NVL(a.crtusr, &amp;apos; &amp;apos;) like &amp;apos;&amp;quot;+trkusr+&amp;quot;%&amp;apos;
	and to_char(a.crtdat,&amp;apos;YYYY-MM-DD HH24:MI:SS&amp;apos;) like &amp;apos;%&amp;quot;+DATE+&amp;quot;%&amp;apos;
	order by a.crtdat desc &amp;quot;;
	sql += where;
	//throw new Exception(sql);
	
//	msg= this.list(sql);
	var url=&amp;quot;Layout.sp?id=trkquery&amp;quot;;
	try {
		db = new pubpack.EADatabase();	// 如果连接到其他数据库, new pubpack.EADatabase(“dbname”)
		var ds = db.QuerySQL(sql);
		
		if(WORKTYPE==&amp;quot;1&amp;quot;){
			msg=msg+&amp;quot;&amp;lt;td valign=\&amp;quot;top\&amp;quot;&amp;gt;&amp;quot;+
			&amp;quot;&amp;lt;font color=\&amp;quot;#014E82\&amp;quot;&amp;gt;&amp;quot;+
			&amp;quot;&amp;lt;table width=\&amp;quot;100%\&amp;quot; align=\&amp;quot;left\&amp;quot; border=\&amp;quot;0\&amp;quot; cellpadding=\&amp;quot;1\&amp;quot;&amp;gt;&amp;quot;+
			&amp;quot;&amp;lt;tbody&amp;gt;&amp;quot;;//编写格式,对齐方式为左对齐,置顶
			
			//
			for( var i=0 ;i&amp;lt;ds.getRowCount()&amp;&amp;i&amp;lt;=500; i++ ) {
				msg = msg+&amp;quot;&amp;lt;tr&amp;gt; &amp;lt;td width=100%  &amp;gt;&amp;lt;a href=&amp;apos;#&amp;apos; onclick=\&amp;quot;javascript:window.location=&amp;apos;&amp;quot;+ds.getStringAt(i,&amp;quot;url&amp;quot;)+&amp;quot;&amp;apos;;\&amp;quot;&amp;gt;&amp;quot;+ds.getStringAt(i,&amp;quot;name&amp;quot;)+&amp;quot;&amp;lt;/a&amp;gt;&amp;lt;/td&amp;gt;&amp;lt;/tr&amp;gt;&amp;quot;;
			}
	//		//msg = msg+&amp;quot;&amp;lt;tr&amp;gt; &amp;lt;td width=100%  &amp;gt;&amp;lt;a href=&amp;apos;#&amp;apos; onclick=\&amp;quot;javascript:window.location=&amp;apos;&amp;quot;+url+&amp;quot;&amp;guid=&amp;apos;;\&amp;quot;&amp;gt;&amp;quot;+&amp;quot;全部&amp;quot;+&amp;quot;&amp;lt;/a&amp;gt;&amp;lt;/td&amp;gt;&amp;lt;/tr&amp;gt;&amp;quot;;//添加全部按钮
			msg=msg+&amp;quot;&amp;lt;/tbody&amp;gt;&amp;quot;+&amp;quot;&amp;lt;/table&amp;gt;&amp;quot;+&amp;quot;&amp;lt;/font&amp;gt;&amp;quot;+&amp;quot;&amp;lt;/td&amp;gt;&amp;quot;;
		}else if(WORKTYPE==&amp;quot;2&amp;quot;){//显示内容和处理过程
			
			for( var i=0 ;i&amp;lt;ds.getRowCount()&amp;&amp;i&amp;lt;=500; i++ ) {
				if ( ds.getRowCount() &amp;gt; 0 ) {
					var id = ds.getStringAt(i,&amp;quot;id&amp;quot;);
					msg += &amp;quot;&amp;lt;p align=center&amp;gt;&amp;lt;font size=3 &amp;gt;&amp;quot;+ds.getStringAt(i,&amp;quot;title&amp;quot;)+&amp;quot;&amp;lt;font&amp;gt;&amp;lt;/p&amp;gt;&amp;quot;;//标题
					msg += &amp;quot;&amp;lt;p align=center&amp;gt;&amp;lt;font size=2 color=#808080&amp;gt;&amp;quot;+ds.getStringAt(i,&amp;quot;crtusr&amp;quot;)+&amp;quot; &amp;quot;+ds.getStringAt(i,&amp;quot;crttim&amp;quot;)+&amp;quot;&amp;lt;/font&amp;gt;&amp;lt;/p&amp;gt;&amp;quot;;
					
					var note = ds.getStringAt(i,&amp;quot;note&amp;quot;);//内容
					note = pubpack.EAFunc.Replace(note,&amp;quot;\n&amp;quot;,&amp;quot;&amp;lt;BR&amp;gt;&amp;quot;);
					msg += &amp;quot;&amp;lt;font size=2 &amp;gt;&amp;quot;+note+&amp;quot;&amp;lt;/font&amp;gt;&amp;quot;;
					var filenote = ds.getStringAt(i,&amp;quot;filenote&amp;quot;);
					var imagenote = ds.getStringAt(i,&amp;quot;imagenote&amp;quot;);
		
					//读取附件
					var filepath = ds.getStringAt(i,&amp;quot;filepath&amp;quot;);
					if ( filepath !=&amp;quot;&amp;quot; ) {
						var idx = filenote.indexOf(&amp;quot;\\&amp;quot;);
						while(idx&amp;gt;=0 ) {
							var idx1 = filenote.indexOf(&amp;quot;\\&amp;quot;,idx+1);
							if ( idx1&amp;gt;= 0 ) idx = idx1;
							else break;
						}
						if ( idx&amp;gt;=0 ) 
							filenote = filenote.substring(idx+1);
						msg += &amp;quot;&amp;lt;p&amp;gt;&amp;lt;font color=#FF0000 size=2&amp;gt;下载附件：&amp;lt;a href=\&amp;quot;downloadFile.sp?unzip=1&amp;filename=&amp;quot;+filepath+&amp;quot;\&amp;quot;&amp;gt;&amp;quot;+filenote+&amp;quot;&amp;lt;/a&amp;gt;&amp;nbsp;&amp;lt;a href=\&amp;quot;downloadFile.sp?format=zip&amp;filename=&amp;quot;+filepath+&amp;quot;\&amp;quot;&amp;gt;压缩下载&amp;lt;/a&amp;gt;&amp;lt;/font&amp;gt;&amp;lt;/p&amp;gt;&amp;quot;;
					}
				}
				//下面的循环显示处理的过程
				var db2 = new pubpack.EADatabase();	// 如果连接到其他数据库, new pubpack.EADatabase(“dbname”)
				var sql2 = &amp;quot;select a.title,a.pro_note,b.name tousr,to_char(a.crtdat,&amp;apos;YYYY-MM-DD HH24:MI:SS&amp;apos;) crttim,c.name crtusr,c.id crtusrid,dtltyp,a.guid ,a.selforg,a.filepath, a.filenote,a.imagepath, a.imagenote &amp;quot;+
				&amp;quot;from trkdtl a , usr b, usr c where a.trkguid=&amp;apos;&amp;quot;+ds.getStringAt(i,&amp;quot;guid&amp;quot;) +&amp;quot;&amp;apos; and a.tousr=b.id(+) and a.AIMORG=b.org(+) and a.crtusr=c.id and a.selforg=c.org and NVL(a.dtltyp,&amp;apos; &amp;apos;)&amp;lt;&amp;gt;&amp;apos;2&amp;apos; order by a.crtdat asc&amp;quot;;
				
				var ds2 = db2.QuerySQL(sql2);
				//msg +=sql2;
				//if ( ds2.getRowCount() == 0 ) msg+=&amp;quot;没有处理记录&amp;quot; ;
				for ( var row=0;row&amp;lt;ds2.getRowCount();row ++ ) {
					
					msg +=&amp;quot;&amp;lt;p&amp;gt;&amp;quot;+(row+1)+&amp;quot;.&amp;quot;+ds2.getStringAt(row,&amp;quot;crtusr&amp;quot;)+&amp;quot;于&amp;quot;+ds2.getStringAt(row,&amp;quot;crttim&amp;quot;);
					var dtltyp  = ds2.getStringAt(row,&amp;quot;dtltyp&amp;quot;);
					var guid = ds2.getStringAt(row,&amp;quot;guid&amp;quot;);
		
					if (dtltyp   == &amp;quot;2&amp;quot; ) 
						msg += &amp;quot;发表评论&amp;quot;;
					else 
						msg += &amp;quot;处理过，并转发给&amp;quot;+ds2.getStringAt(row,&amp;quot;tousr&amp;quot;);
					msg +=&amp;quot;&amp;lt;br&amp;gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;标题：&amp;quot;+ds2.getStringAt(row,&amp;quot;title&amp;quot;)+&amp;quot;&amp;lt;BR&amp;gt;&amp;quot;;
		
					var note = ds2.getStringAt(row,&amp;quot;pro_note&amp;quot;);
					if ( note.length() &amp;gt; 0 ) {
						note = pubpack.EAFunc.Replace(note,&amp;quot;\n&amp;quot;,&amp;quot;&amp;lt;BR&amp;gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;quot;);
						msg +=&amp;quot;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;lt;font color=&amp;apos;#333333&amp;apos;&amp;gt;&amp;quot;+note+&amp;quot;&amp;lt;/font&amp;gt;&amp;quot;;
					}
					
					var filepath = ds2.getStringAt(row,&amp;quot;filepath&amp;quot;);
					var filenote = ds2.getStringAt(row,&amp;quot;filenote&amp;quot;);
					var imagepath = ds2.getStringAt(row,&amp;quot;imagepath&amp;quot;);
					var imagenote= ds2.getStringAt(row,&amp;quot;imagenote&amp;quot;);
					
					if ( filepath!=&amp;quot;&amp;quot; ) 
						msg += &amp;quot;&amp;lt;p&amp;gt;&amp;lt;font color=#FF0000 size=2&amp;gt;下载附件：&amp;lt;a href=\&amp;quot;downloadFile.sp?unzip=1&amp;filename=&amp;quot;+filepath+&amp;quot;\&amp;quot;&amp;gt;&amp;quot;+filenote+&amp;quot;&amp;lt;/a&amp;gt;&amp;nbsp;&amp;lt;a href=\&amp;quot;downloadFile.sp?format=zip&amp;filename=&amp;quot;+filepath+&amp;quot;\&amp;quot;&amp;gt;压缩下载&amp;lt;/a&amp;gt;&amp;lt;/font&amp;gt;&amp;quot;;
					if ( imagepath !=&amp;quot;&amp;quot; ) 
						msg += &amp;quot;&amp;lt;BR&amp;gt;&amp;lt;font color=#FF0000 size=2&amp;gt;屏幕截图：&amp;lt;a href=\&amp;quot;downloadFile.sp?format=zip&amp;filename=&amp;quot;+imagepath+&amp;quot;\&amp;quot;&amp;gt;压缩下载&amp;lt;/a&amp;gt;&amp;nbsp;&amp;lt;a href=\&amp;quot;downloadFile.sp?unzip=1&amp;format=rtf&amp;filename=&amp;quot;+imagepath+&amp;quot;\&amp;quot;&amp;gt;原始下载&amp;lt;/a&amp;gt;&amp;lt;/font&amp;gt;&amp;quot;;			
					//return sql2;
					//show.sp?grdid=TRK_TRKDTL&amp;datacc=XLSGRID&amp;guid=28518ADFEFA0FC9DE040007F01006EA8&amp;
//					if ( loginusrid ==ds2.getStringAt(row,&amp;quot;crtusrid&amp;quot;)&amp;&amp; ds2.getStringAt(row,&amp;quot;selforg&amp;quot;)== loginorgid  )
//						msg+=&amp;quot;&amp;lt;p align=&amp;apos;right&amp;apos;&amp;gt;&amp;lt;a href=\&amp;quot;show.sp?grdid=TRK_TRKDTL&amp;datacc=XLSGRID&amp;guid=&amp;quot;+guid+&amp;quot;\&amp;quot;  target=_blank &amp;gt;编辑&amp;lt;/a&amp;gt;&amp;nbsp;&amp;nbsp;|&amp;nbsp;&amp;nbsp;&amp;lt;a href=\&amp;quot;#\&amp;quot; onclick=\&amp;quot;javascript:if(confirm(&amp;apos;结束该事务，是否继续？&amp;apos;)==1)window.location=&amp;apos;XLSGRID.TRKLAYOUT.DelTrkDtl.osp?guid=&amp;quot;+guid+&amp;quot;&amp;trkguid=&amp;quot;+trkguid+&amp;quot;&amp;apos;;\&amp;quot; &amp;gt;删除&amp;lt;a/&amp;gt;&amp;nbsp;&amp;nbsp;&amp;quot;;
//					msg+=&amp;quot;&amp;lt;/p&amp;gt;&amp;quot;;
					
				}
			}
			

		}
	}
	catch ( ee ) {
		db.Rollback();
		throw new pubpack.EAException ( ee.toString() );
	}
	finally {
		if (db!=null) db.Close();
	}
	return msg;//直接返回html语句

}



//远程调用结束一个事务
//输入参数：trkguid
function EndTrk()
{

	var db = null;
	var msg= &amp;quot;&amp;quot;;
	var usrinfo = webpack.EASession.GetLoginInfo(request);
	var loginusrid = usrinfo.getUsrid();
	var loginorgid = usrinfo.getusrOrg();
	try {
		db = new pubpack.EADatabase();	// 如果连接到其他数据库, new pubpack.EADatabase(“dbname”)
		var ret =db.ExcecutSQL(&amp;quot;update trkhdr set stat=&amp;apos;3&amp;apos; where guid=&amp;apos;&amp;quot;+trkguid+&amp;quot;&amp;apos;&amp;quot;);
		db.ExcecutSQL(&amp;quot;update trkhdr set stat=&amp;apos;3&amp;apos; where guid=&amp;apos;&amp;quot;+trkguid+&amp;quot;&amp;apos;&amp;quot;);
		var ds = db.QuerySQL( &amp;quot;select title,project from trkhdr where guid=&amp;apos;&amp;quot;+trkguid+&amp;quot;&amp;apos;&amp;quot;);
		OALOG( db,loginorgid ,loginusrid,&amp;quot;ENDTRK&amp;quot;,&amp;quot;结束事务&amp;quot;,trkguid,ds.getStringAt(0,&amp;quot;title&amp;quot;),&amp;quot;&amp;quot; ,ds.getStringAt(0,&amp;quot;project&amp;quot;) ) ;
                  
		msg += &amp;quot;操作成功，更新了&amp;quot;+ret+&amp;quot;笔记录&amp;lt;BR&amp;gt;&amp;lt;a href=\&amp;quot;javascript:window.location=&amp;apos;Layout.sp?id=trkquery&amp;trkguid=&amp;quot;+trkguid+&amp;quot;&amp;apos;;\&amp;quot;&amp;gt;点击返回&amp;lt;/a&amp;gt;&amp;quot; ; 
		db.Commit();			
	}
	catch ( ee ) {
		db.Rollback();
		throw new pubpack.EAException ( ee.toString() );
	}
	finally {
		if (db!=null) db.Close();
	}
	return msg;
}

//远程调用删除一个事务
//输入参数：trkguid
function DelTrk()
{

	var db = null;
	var msg= &amp;quot;&amp;quot;;
	var usrinfo = webpack.EASession.GetLoginInfo(request);
	var loginusrid = usrinfo.getUsrid();
	var loginorgid = usrinfo.getusrOrg();
	try {
		db = new pubpack.EADatabase();	// 如果连接到其他数据库, new pubpack.EADatabase(“dbname”)
		var ds = db.QuerySQL( &amp;quot;select title,note,project from trkhdr where guid=&amp;apos;&amp;quot;+trkguid+&amp;quot;&amp;apos;&amp;quot; );
		if ( ds.getRowCount() &amp;gt; 0 ) {
			OALOG( db,loginorgid ,loginusrid,&amp;quot;DELTRKHDR&amp;quot;,&amp;quot;删除事务&amp;quot;,trkguid,ds.getStringAt(0,&amp;quot;title&amp;quot;),ds.getStringAt(0,&amp;quot;note&amp;quot;) ,ds.getStringAt(0,&amp;quot;project&amp;quot;)  ) ;
		}
                
                var ret =db.ExcecutSQL(&amp;quot;delete from trkhdr  where guid=&amp;apos;&amp;quot;+trkguid+&amp;quot;&amp;apos;&amp;quot;);
		
		msg += &amp;quot;操作成功，更新了&amp;quot;+ret+&amp;quot;笔记录&amp;lt;BR&amp;gt;&amp;lt;a href=\&amp;quot;javascript:window.location=&amp;apos;Layout.sp?id=trkquery&amp;trkguid=&amp;quot;+trkguid+&amp;quot;&amp;apos;;\&amp;quot;&amp;gt;点击返回&amp;lt;/a&amp;gt;&amp;quot; ; 
		db.Commit();			
	}
	catch ( ee ) {
		db.Rollback();
		throw new pubpack.EAException ( ee.toString() );
	}
	finally {
		if (db!=null) db.Close();
	}
	return msg;
}
//远程调用删除一个事务
//输入参数：trkguid
function DelTrkDtl()
{

	var db = null;
	var msg= &amp;quot;&amp;quot;;
	var usrinfo = webpack.EASession.GetLoginInfo(request);
	var loginusrid = usrinfo.getUsrid();
	var loginorgid = usrinfo.getusrOrg();
	try {
		db = new pubpack.EADatabase();	// 如果连接到其他数据库, new pubpack.EADatabase(“dbname”)
		var ds = db.QuerySQL( &amp;quot;select title,pro_note note,dtltyp,project from trkdtl where guid=&amp;apos;&amp;quot;+guid+&amp;quot;&amp;apos;&amp;quot; );
		if ( ds.getRowCount() &amp;gt; 0 ) {
			if ( ds.getStringAt(0,&amp;quot;dtltyp&amp;quot;)==&amp;quot;2&amp;quot; ) 
				OALOG( db,loginorgid ,loginusrid,&amp;quot;DELTRKDTL1&amp;quot;,&amp;quot;删除评论&amp;quot;,guid,ds.getStringAt(0,&amp;quot;title&amp;quot;),ds.getStringAt(0,&amp;quot;note&amp;quot;),ds.getStringAt(0,&amp;quot;project&amp;quot;)  ) ;
			else OALOG( db,loginorgid ,loginusrid,&amp;quot;DELTRKDTL1&amp;quot;,&amp;quot;删除处理记录&amp;quot;,guid,ds.getStringAt(0,&amp;quot;title&amp;quot;),ds.getStringAt(0,&amp;quot;note&amp;quot;),ds.getStringAt(0,&amp;quot;project&amp;quot;)  ) ;
		}

		
		var ret =db.ExcecutSQL(&amp;quot;delete from trkdtl  where guid=&amp;apos;&amp;quot;+guid+&amp;quot;&amp;apos;&amp;quot;);
		
		msg += &amp;quot;操作成功，更新了&amp;quot;+ret+&amp;quot;笔记录&amp;lt;BR&amp;gt;&amp;lt;a href=\&amp;quot;javascript:window.location=&amp;apos;Layout.sp?id=trkquery&amp;trkguid=&amp;quot;+trkguid+&amp;quot;&amp;apos;;\&amp;quot;&amp;gt;点击返回&amp;lt;/a&amp;gt;&amp;quot; ; 
		db.Commit();			
	}
	catch ( ee ) {
		db.Rollback();
		throw new pubpack.EAException ( ee.toString() );
	}
	finally {
		if (db!=null) db.Close();
	}
	return msg;
}

//我的待办事务,我创建的事务,日志的显示列表
function trkmylist(){
	
	var db = null;
	var msg= &amp;quot;&amp;quot;;//是显示的html语句
	//	listtyp:  1 为我的待办事务 2 为我创建的事务 3为 日志
	var sql = &amp;quot;&amp;quot;;
	if(trkusr==&amp;quot;curusr&amp;quot;){//只显示当前用户
		var usr=web.EASession.GetLoginInfo(request);//获取当前用户信息
		trkusr=usr.getUsrid();
	}
	
	
	if(worktyp==&amp;quot;1&amp;quot;){
		sql=&amp;quot;select a.title|| &amp;apos; &amp;apos;||cc.name ||to_char(a.crtdat,&amp;apos;mm/dd hh24:mi&amp;apos;) name,substr(a.note,1,25) note ,&amp;quot;+
		&amp;quot;a.guid ,a.id,&amp;apos;Layout.sp?id=trkquery&amp;trkguid=&amp;apos;||a.guid url&amp;quot;+
		&amp;quot; from  &amp;quot;+
		&amp;quot;trkhdr a,v_usr c ,trktyp e,v_usr cc &amp;quot;+
		&amp;quot;where &amp;quot;+
		&amp;quot;a.dtlusr=c.id  and a.AIMORG=c.orgid and a.crtusr=cc.id  and a.AIMORG=cc.orgid &amp;quot;+
//		&amp;quot;and c.id=lower(&amp;apos;&amp;quot;+usrid+&amp;quot;&amp;apos;)   &amp;quot;+
//		&amp;quot;and c.orgid=&amp;apos;&amp;quot;+orgid+&amp;quot;&amp;apos;&amp;quot;+
		&amp;quot;and a.show =e.id   &amp;quot;+
		&amp;quot;and a.stat&amp;lt;&amp;gt;&amp;apos;3&amp;apos; &amp;quot;+//-- 0：新建，1：处理中，2：已处理，3：处理完，4：未处理&amp;quot;+
		&amp;quot;and e.id not in (&amp;apos;5&amp;apos;,&amp;apos;6&amp;apos;,&amp;apos;7&amp;apos;,&amp;apos;8&amp;apos;,&amp;apos;9&amp;apos;,&amp;apos;10&amp;apos;,&amp;apos;16&amp;apos;,&amp;apos;17&amp;apos;) &amp;quot;+
		&amp;quot;and a.project like &amp;apos;&amp;quot;+trkprj+&amp;quot;%&amp;apos; &amp;quot;+
		&amp;quot;and a.show like &amp;apos;&amp;quot;+trktyp+&amp;quot;%&amp;apos; &amp;quot;+
		&amp;quot;and a.dtlusr like &amp;apos;&amp;quot;+trkusr+&amp;quot;%&amp;apos;&amp;quot;+
		&amp;quot;order by to_char(a.crtdat,&amp;apos;yyyy-mm-dd hh24:mi:ss&amp;apos;) desc &amp;quot;;

	}else if(worktyp==&amp;quot;2&amp;quot;){
		sql=&amp;quot;select a.title|| &amp;apos; &amp;apos;||to_char(a.crtdat,&amp;apos;mm/dd&amp;apos;)||&amp;apos; -》&amp;apos;||c.name||&amp;apos; 状态&amp;apos;||d.name name,substr(a.note,1,25) note ,&amp;quot;+
		&amp;quot;a.guid ,a.id,&amp;apos;Layout.sp?id=trkquery&amp;trkguid=&amp;apos;||a.guid url&amp;quot;+
		&amp;quot; from  &amp;quot;+
		&amp;quot;trkhdr a,v_usr c ,trktyp e,v_usr cc, v_trkstat d &amp;quot;+
		&amp;quot;where &amp;quot;+
		&amp;quot;a.dtlusr=c.id  and a.AIMORG=c.orgid and a.crtusr=cc.id  and a.SELFORG=cc.orgid &amp;quot;+
		&amp;quot;and a.stat=d.id &amp;quot;+
//		&amp;quot;and cc.id=lower(&amp;apos;[%SYS_USRID]&amp;apos;)   &amp;quot;+
//		&amp;quot;and cc.orgid=&amp;apos;[%SYS_ORGID]&amp;apos;&amp;quot;+
		&amp;quot;and a.show like&amp;apos;&amp;quot;+trktyp+&amp;quot;%&amp;apos;&amp;quot;+
		&amp;quot;and a.project like&amp;apos;&amp;quot;+trkprj+&amp;quot;%&amp;apos;&amp;quot;+
		&amp;quot;and a.crtusr like &amp;apos;&amp;quot;+trkusr+&amp;quot;%&amp;apos;&amp;quot;+
		&amp;quot;and a.show =e.id   &amp;quot;+
		&amp;quot;&amp;quot;+
		&amp;quot;order by to_char(a.crtdat,&amp;apos;yyyy-mm-dd hh24:mi:ss&amp;apos;) desc &amp;quot;;
	}else if(worktyp==&amp;quot;3&amp;quot;){
		sql=&amp;quot;select  distinct &amp;apos;&amp;apos;||a.usrnam ||&amp;apos;  &amp;apos;||to_char(a.crtdat,&amp;apos;mm/dd hh24:mi&amp;apos;)||&amp;apos;  &amp;apos;||a.action||substr(a.name,1,16)   name, &amp;quot;+
		&amp;quot;a.guid,a.usrid id,a.crtdat &amp;quot;+
		&amp;quot;,&amp;apos;Layout.sp?id=trkquery&amp;guid=&amp;apos;||a.bilid||&amp;apos;&amp;trkguid=&amp;apos;||a.bilid url &amp;quot;+
		&amp;quot;from OALOG a ,trkhdr b where mwtyp in( &amp;apos;TRKHDR&amp;apos;,&amp;apos;TRKDTL1&amp;apos;,&amp;apos;TRKDTL2&amp;apos;,&amp;apos;ENDTRK&amp;apos; ) &amp;quot;+
		&amp;quot; and &amp;quot;+
		&amp;quot; b.guid=a.bilid &amp;quot;+
		&amp;quot;and b.show like&amp;apos;&amp;quot;+trktyp+&amp;quot;%&amp;apos;&amp;quot;+
		&amp;quot;and b.project like&amp;apos;&amp;quot;+trkprj+&amp;quot;%&amp;apos;&amp;quot;+
		&amp;quot;and b.crtusr like &amp;apos;&amp;quot;+trkusr+&amp;quot;%&amp;apos;&amp;quot;+
		
		&amp;quot;order by crtdat desc&amp;quot;; 
	}
	
	//throw new Exception(sql);
	

	var url=&amp;quot;Layout.sp?id=trkquery&amp;quot;;
	try {
		db = new pubpack.EADatabase();	// 如果连接到其他数据库, new pubpack.EADatabase(“dbname”)
		
		msg=msg+&amp;quot;&amp;lt;td valign=\&amp;quot;top\&amp;quot;&amp;gt;&amp;quot;+
		&amp;quot;&amp;lt;font color=\&amp;quot;#014E82\&amp;quot;&amp;gt;&amp;quot;+
		&amp;quot;&amp;lt;table width=\&amp;quot;100%\&amp;quot; align=\&amp;quot;left\&amp;quot; border=\&amp;quot;0\&amp;quot; cellpadding=\&amp;quot;1\&amp;quot;&amp;gt;&amp;quot;+
		&amp;quot;&amp;lt;tbody&amp;gt;&amp;quot;;//编写格式,对齐方式为左对齐,置顶
		var ds = db.QuerySQL(sql);
		//
		for( var i=0 ;i&amp;lt;ds.getRowCount()&amp;&amp;i&amp;lt;=500; i++ ) {
			msg = msg+&amp;quot;&amp;lt;tr&amp;gt; &amp;lt;td width=100%  &amp;gt;&amp;lt;a href=&amp;apos;#&amp;apos; onclick=\&amp;quot;javascript:window.location=&amp;apos;&amp;quot;+ds.getStringAt(i,&amp;quot;url&amp;quot;)+&amp;quot;&amp;apos;;\&amp;quot;&amp;gt;&amp;quot;+ds.getStringAt(i,&amp;quot;name&amp;quot;)+&amp;quot;&amp;lt;/a&amp;gt;&amp;lt;/td&amp;gt;&amp;lt;/tr&amp;gt;&amp;quot;;
		}
//		msg = msg+&amp;quot;&amp;lt;tr&amp;gt; &amp;lt;td width=100%  &amp;gt;&amp;lt;a href=&amp;apos;#&amp;apos; onclick=\&amp;quot;javascript:window.location=&amp;apos;&amp;quot;+url+&amp;quot;&amp;guid=&amp;apos;;\&amp;quot;&amp;gt;&amp;quot;+&amp;quot;全部&amp;quot;+&amp;quot;&amp;lt;/a&amp;gt;&amp;lt;/td&amp;gt;&amp;lt;/tr&amp;gt;&amp;quot;;//添加全部按钮
		msg=msg+&amp;quot;&amp;lt;/tbody&amp;gt;&amp;quot;+&amp;quot;&amp;lt;/table&amp;gt;&amp;quot;+&amp;quot;&amp;lt;/font&amp;gt;&amp;quot;+&amp;quot;&amp;lt;/td&amp;gt;&amp;quot;;
		
	}
	catch ( ee ) {
		db.Rollback();
		throw new pubpack.EAException ( ee.toString() );
	}
	finally {
		if (db!=null) db.Close();
	}
	return msg;//直接返回html语句

}


//搜索事务结果的列表
function searchtrk(){ 
	
	var db = null;
	var msg= &amp;quot;&amp;quot;;//是显示的html语句
	//	listtyp:  1 为我的待办事务 2 为我创建的事务 3为 日志
	var sql = &amp;quot;&amp;quot;;
	var	querywhere = &amp;quot; and (&amp;quot;;
			var str=query.split(&amp;quot; &amp;quot;);
			  //throw new Exception(str);
			for(var i=0;i&amp;lt;str.length();i++)    
			{	
				if(i==0){
					querywhere+=&amp;quot;  lower( concat(UTL_RAW.CAST_TO_VARCHAR2(a.noteblob),concat(a.title,concat(a.note,to_char(a.crtdat,&amp;apos;yyyy-mm-dd&amp;apos;))))) like lower(&amp;apos;%&amp;quot;+str[i]+&amp;quot;%&amp;apos;)&amp;quot;; 
				}else{
					querywhere+=&amp;quot; and lower( concat(UTL_RAW.CAST_TO_VARCHAR2(a.noteblob),concat(a.title,concat( a.note,to_char(a.crtdat,&amp;apos;yyyy-mm-dd&amp;apos;))))) like lower(&amp;apos;%&amp;quot;+str[i]+&amp;quot;%&amp;apos;)&amp;quot;; 
				}
			} 
		querywhere+=&amp;quot;) &amp;quot;;
	
	
	sql=&amp;quot;SELECT A.id ,&amp;quot;;//查询事务的sql语句
		sql+=&amp;quot;a.title|| &amp;apos; &amp;apos;||cc.name||&amp;apos;(&amp;apos;||d.name ||&amp;apos;)&amp;apos;||to_char(a.crtdat,&amp;apos;yyyy/mm/dd hh24:mi&amp;apos;) name,&amp;quot;;
		sql+=&amp;quot;A.GUID,&amp;quot;;
		sql+=&amp;quot;&amp;apos;Layout.sp?id=trkquery&amp;trkguid=&amp;apos;||a.guid url &amp;quot;;

		sql+=&amp;quot;FROM  TRKHDR A,v_usr c ,trktyp e,v_usr cc,trktyp d &amp;quot;;
		sql+=&amp;quot;where &amp;quot;;
		sql+=&amp;quot;a.dtlusr=c.id(+)  and a.AIMORG=c.orgid(+) and a.crtusr=cc.id  and a.AIMORG=cc.orgid &amp;quot;;
		sql+=&amp;quot;and a.show =e.id &amp;quot;;
		sql+=&amp;quot;and d.id=a.show &amp;quot;;
		sql+=&amp;quot;and a.PROJECT like &amp;apos;&amp;quot;+trkprj+&amp;quot;%&amp;apos;&amp;quot;;
		sql+=&amp;quot;and a.show like &amp;apos;&amp;quot;+trktyp+&amp;quot;%&amp;apos;&amp;quot;;
		sql+=&amp;quot;and a.crtusr like &amp;apos;&amp;quot;+crtusr+&amp;quot;%&amp;apos;&amp;quot;;
		sql+=querywhere;
		sql+=&amp;quot; order by a.crtdat desc &amp;quot;;
	
	var querywhere = &amp;quot;  (&amp;quot;;//查询函数库的sql的条件语句
			var str=query.split(&amp;quot; &amp;quot;);
			  //throw new Exception(str);
			for(var i=0;i&amp;lt;str.length();i++)    
			{	
				if(i==0){
					querywhere+=&amp;quot;  lower( concat(a.name,concat(a.note,to_char(a.crtdat,&amp;apos;yyyy-mm-dd&amp;apos;)))) like lower(&amp;apos;%&amp;quot;+str[i]+&amp;quot;%&amp;apos;)&amp;quot;; 
				}else{
					querywhere+=&amp;quot; and lower( concat(a.name,concat( a.note,to_char(a.crtdat,&amp;apos;yyyy-mm-dd&amp;apos;)))) like lower(&amp;apos;%&amp;quot;+str[i]+&amp;quot;%&amp;apos;)&amp;quot;; 
				}
			} 
		querywhere+=&amp;quot;) &amp;quot;;
	
	
	var sqlapi=&amp;quot;select &amp;apos;&amp;apos; id,&amp;apos;&amp;apos; guid,a.name name,&amp;apos;Layout.sp?id=apiquery&amp;apiguid=&amp;apos;||a.guid url from FUNCLIST a where &amp;quot;+querywhere;
	
	//throw new Exception(sqlapi+&amp;quot;|&amp;quot;+sql);
	
//	msg= this.list(sql);
	var url=&amp;quot;Layout.sp?id=trkquery&amp;quot;;
	try {
		db = new pubpack.EADatabase();	// 如果连接到其他数据库, new pubpack.EADatabase(“dbname”)
		
		msg=msg+&amp;quot;&amp;lt;td valign=\&amp;quot;top\&amp;quot;&amp;gt;&amp;quot;+
		&amp;quot;&amp;lt;font color=\&amp;quot;#014E82\&amp;quot;&amp;gt;&amp;quot;+
		&amp;quot;&amp;lt;table width=\&amp;quot;100%\&amp;quot; align=\&amp;quot;left\&amp;quot; border=\&amp;quot;0\&amp;quot; cellpadding=\&amp;quot;1\&amp;quot;&amp;gt;&amp;quot;+
		&amp;quot;&amp;lt;tbody&amp;gt;&amp;quot;;//编写格式,对齐方式为左对齐,置顶
//		var ds = db.QuerySQL(sqlapi);
//		//
//		for( var i=0 ;i&amp;lt;ds.getRowCount()&amp;&amp;i&amp;lt;=100; i++ ) {
//			msg = msg+&amp;quot;&amp;lt;tr&amp;gt; &amp;lt;td width=100%  &amp;gt;&amp;lt;a href=&amp;apos;#&amp;apos; onclick=\&amp;quot;javascript:window.location=&amp;apos;&amp;quot;+ds.getStringAt(i,&amp;quot;url&amp;quot;)+&amp;quot;&amp;apos;;\&amp;quot;&amp;gt;&amp;quot;+ds.getStringAt(i,&amp;quot;name&amp;quot;)+&amp;quot;&amp;lt;/a&amp;gt;&amp;lt;/td&amp;gt;&amp;lt;/tr&amp;gt;&amp;quot;;
//		}
//		msg += &amp;quot;&amp;lt;tr&amp;gt;&amp;lt;td width=100%  &amp;gt;------------------------------&amp;lt;/td&amp;gt;&amp;lt;/tr&amp;gt;&amp;quot;;
		
		
		var ds = db.QuerySQL(sql);
		//
		for( var i=0 ;i&amp;lt;ds.getRowCount()&amp;&amp;i&amp;lt;=500; i++ ) {
			msg = msg+&amp;quot;&amp;lt;tr&amp;gt; &amp;lt;td width=100%  &amp;gt;&amp;lt;a href=&amp;apos;#&amp;apos; onclick=\&amp;quot;javascript:window.location=&amp;apos;&amp;quot;+ds.getStringAt(i,&amp;quot;url&amp;quot;)+&amp;quot;&amp;apos;;\&amp;quot;&amp;gt;&amp;quot;+ds.getStringAt(i,&amp;quot;name&amp;quot;)+&amp;quot;&amp;lt;/a&amp;gt;&amp;lt;/td&amp;gt;&amp;lt;/tr&amp;gt;&amp;quot;;
		}
//		//msg = msg+&amp;quot;&amp;lt;tr&amp;gt; &amp;lt;td width=100%  &amp;gt;&amp;lt;a href=&amp;apos;#&amp;apos; onclick=\&amp;quot;javascript:window.location=&amp;apos;&amp;quot;+url+&amp;quot;&amp;guid=&amp;apos;;\&amp;quot;&amp;gt;&amp;quot;+&amp;quot;全部&amp;quot;+&amp;quot;&amp;lt;/a&amp;gt;&amp;lt;/td&amp;gt;&amp;lt;/tr&amp;gt;&amp;quot;;//添加全部按钮
		msg=msg+&amp;quot;&amp;lt;/tbody&amp;gt;&amp;quot;+&amp;quot;&amp;lt;/table&amp;gt;&amp;quot;+&amp;quot;&amp;lt;/font&amp;gt;&amp;quot;+&amp;quot;&amp;lt;/td&amp;gt;&amp;quot;;
		
	}
	catch ( ee ) {
		db.Rollback();
		throw new pubpack.EAException ( ee.toString() );
	}
	finally {
		if (db!=null) db.Close();
	}
	return msg;//直接返回html语句

}
//显示搜索事务的条件
function searchquery(){
	var db = null;
	db = new pubpack.EADatabase();
	var msg= &amp;quot;全部结果 &amp;lt;br&amp;gt; 关键字 \&amp;quot;&amp;quot;+query+&amp;quot;\&amp;quot; &amp;lt;/br&amp;gt;&amp;quot;;//是显示的html语句
	var sql=&amp;quot;&amp;quot;; 
	// 查找项目
		sql = &amp;quot;select &amp;apos;项目:&amp;apos;||b.name name from prj b where b.id = &amp;apos;&amp;quot;+trkprj+&amp;quot;&amp;apos;&amp;quot; ;
		var ds = db.QuerySQL(sql);
		if ( ds.getRowCount() &amp;gt; 0 ) {
			msg += ds.getStringAt(0,&amp;quot;name&amp;quot;)+&amp;quot;&amp;lt;BR&amp;gt;&amp;quot;;
		}
	// 查找创建人
		sql = &amp;quot;select &amp;apos;创建人:&amp;apos;||b.name name  from usr b where b.id = &amp;apos;&amp;quot;+crtusr+&amp;quot;&amp;apos;&amp;quot; ;
		ds = db.QuerySQL(sql);
		if ( ds.getRowCount() &amp;gt; 0 ) {
			msg += ds.getStringAt(0,&amp;quot;name&amp;quot;)+&amp;quot;&amp;lt;BR&amp;gt;&amp;quot;;
		}
		
	// 查找事务类型
		sql = &amp;quot;select &amp;apos;类型:&amp;apos;||b.name||&amp;apos;&amp;lt;BR&amp;gt;说明:&amp;apos;||b.note||&amp;apos;&amp;lt;BR&amp;gt;&amp;apos; name from trktyp b where b.id = &amp;apos;&amp;quot;+trktyp+&amp;quot;&amp;apos;&amp;quot; ;
		ds = db.QuerySQL(sql);
		if ( ds.getRowCount() &amp;gt; 0 ) {
			msg += ds.getStringAt(0,&amp;quot;name&amp;quot;);
			msg+=&amp;quot;&amp;lt;BR&amp;gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;lt;a href=&amp;apos;show.sp?grdid=HDRTRK&amp;style=&amp;quot;+trktyp+&amp;quot;&amp;edit=save&amp;dd=0&amp;prj=&amp;quot;+trkprj+&amp;quot;&amp;apos; target=\&amp;quot;_blank\&amp;quot;&amp;gt;新增事务&amp;gt;&amp;gt;&amp;lt;/a&amp;gt;&amp;quot;;
		}

	return msg;
}
//搜索事务的按项目分类列表 有全部按钮
function searchprjlist(){
	var db = null;
	var msg= &amp;quot;&amp;quot;;//是显示的html语句
	var url=&amp;quot;Layout.sp?id=SearchTrk&amp;query=&amp;quot;+query+&amp;quot;&amp;quot;+&amp;quot;&amp;crtusr=&amp;quot;+crtusr+&amp;quot;&amp;trktyp=&amp;quot;+trktyp;//单击的链接
	var sql=&amp;quot;&amp;quot;;
	var querywhere=&amp;quot;&amp;quot;;
	var category=&amp;quot;&amp;quot;;//分类的查询条件
	// //添加查询条件
	querywhere = &amp;quot; and (&amp;quot;;
			var str=query.split(&amp;quot; &amp;quot;);
			  //throw new Exception(str);
			for(var i=0;i&amp;lt;str.length();i++)    
			{	
				if(i==0){
					querywhere+=&amp;quot;  lower( concat(B.title,concat(B.note,to_char(b.crtdat,&amp;apos;yyyy-mm-dd&amp;apos;)))) like lower(&amp;apos;%&amp;quot;+str[i]+&amp;quot;%&amp;apos;)&amp;quot;; 
				}else{
					querywhere+=&amp;quot; and lower( concat(B.title,concat( B.note,to_char(b.crtdat,&amp;apos;yyyy-mm-dd&amp;apos;)))) like lower(&amp;apos;%&amp;quot;+str[i]+&amp;quot;%&amp;apos;)&amp;quot;; 
				}
			} 
		querywhere+=&amp;quot;) &amp;quot;;
	category = &amp;quot;and b.crtusr like &amp;apos;&amp;quot;+crtusr+&amp;quot;%&amp;apos;&amp;quot;+
			&amp;quot;and b.show like &amp;apos;&amp;quot;+trktyp+&amp;quot;%&amp;apos;&amp;quot;;
	try {
		db = new pubpack.EADatabase();	// 如果连接到其他数据库, new pubpack.EADatabase(“dbname”)
		var sql = &amp;quot;select * from (&amp;quot;;
				sql+=&amp;quot;SELECT A.ID,A.NAME||&amp;apos;(&amp;apos;||COUNT(*)||&amp;apos;)&amp;apos; NAME,A.GUID ,&amp;apos;&amp;quot;+
					url+&amp;quot;&amp;trkprj=&amp;apos;|| A.id  url &amp;quot;+
					&amp;quot;FROM PRJ A,TRKHDR B ,v_usr c ,v_usr cc &amp;quot;+
					&amp;quot;WHERE B.PROJECT=A.ID &amp;quot;+
					&amp;quot; and c.id= b.crtusr  &amp;quot;+
					&amp;quot; and cc.id(+)= b.dtlusr &amp;quot;+
					&amp;quot; and b.AIMORG=c.orgid &amp;quot;+
					&amp;quot; and b.AIMORG=cc.orgid(+) &amp;quot;+
					category;
					
				sql+=querywhere;
				
				sql+=&amp;quot;GROUP BY A.ID,A.NAME,A.GUID &amp;quot;+
				&amp;quot;ORDER BY A.ID&amp;quot;;
		sql+=&amp;quot;) a&amp;quot;;
		
		sql+=&amp;quot; union &amp;quot;;
		sql+=&amp;quot;select &amp;apos;&amp;apos; id ,&amp;quot;+
                &amp;quot; &amp;apos;全部 &amp;apos; || &amp;apos;(&amp;apos; || COUNT(*) || &amp;apos;)&amp;apos; NAME , &amp;quot;+
                &amp;quot; &amp;apos;&amp;apos; guid, &amp;quot;+
                &amp;quot; &amp;apos;&amp;quot;+url+&amp;quot;&amp;trkprj=&amp;apos; url &amp;quot;+
		&amp;quot;from TRKHDR B, v_usr c, v_usr cc WHERE   &amp;quot;+
		&amp;quot;c.id = b.crtusr &amp;quot;+
		&amp;quot;and cc.id(+) = b.dtlusr &amp;quot;+
		&amp;quot;and b.AIMORG = c.orgid  &amp;quot;+
		&amp;quot;and b.AIMORG = cc.orgid(+) &amp;quot;+
		category;
           	sql+=querywhere;
		
		msg=msg+&amp;quot;&amp;lt;td valign=\&amp;quot;top\&amp;quot;&amp;gt;&amp;quot;+
		&amp;quot;&amp;lt;font color=\&amp;quot;#014E82\&amp;quot;&amp;gt;&amp;quot;+
		&amp;quot;&amp;lt;table width=\&amp;quot;100%\&amp;quot; align=\&amp;quot;left\&amp;quot; border=\&amp;quot;0\&amp;quot; cellpadding=\&amp;quot;1\&amp;quot;&amp;gt;&amp;quot;+
		&amp;quot;&amp;lt;tbody&amp;gt;&amp;quot;;//
		
		//throw new Exception(sql);
		var ds = db.QuerySQL(sql);
		for( var i=0 ;i&amp;lt;ds.getRowCount(); i++ ) {
			msg = msg+&amp;quot;&amp;lt;tr&amp;gt; &amp;lt;td width=100%  &amp;gt;&amp;lt;a href=&amp;apos;#&amp;apos; onclick=\&amp;quot;javascript:window.location=&amp;apos;&amp;quot;+ds.getStringAt(i,&amp;quot;url&amp;quot;)+&amp;quot;&amp;apos;;\&amp;quot;&amp;gt;&amp;quot;+ds.getStringAt(i,&amp;quot;name&amp;quot;)+&amp;quot;&amp;lt;/a&amp;gt;&amp;lt;/td&amp;gt;&amp;lt;/tr&amp;gt;&amp;quot;;
		}
		//msg = msg+&amp;quot;&amp;lt;tr&amp;gt; &amp;lt;td width=100%  &amp;gt;&amp;lt;a href=&amp;apos;#&amp;apos; onclick=\&amp;quot;javascript:window.location=&amp;apos;&amp;quot;+url+&amp;quot;&amp;trkprj=&amp;quot;+&amp;quot;&amp;apos;;\&amp;quot;&amp;gt;&amp;quot;+&amp;quot;全部&amp;quot;+&amp;quot;&amp;lt;/a&amp;gt;&amp;lt;/td&amp;gt;&amp;lt;/tr&amp;gt;&amp;quot;;//添加全部按钮
		msg=msg+&amp;quot;&amp;lt;/tbody&amp;gt;&amp;quot;+&amp;quot;&amp;lt;/table&amp;gt;&amp;quot;+&amp;quot;&amp;lt;/font&amp;gt;&amp;quot;+&amp;quot;&amp;lt;/td&amp;gt;&amp;quot;;
		
	}
	catch ( ee ) {
		db.Rollback();
		throw new pubpack.EAException ( ee.toString() );
	}
	finally {
		if (db!=null) db.Close();
	}
	return msg;//直接返回html语句

}

//搜索事务的按事务类型分类列表 有全部按钮
function searchtyplist(){
	var db = null;
	var msg= &amp;quot;&amp;quot;;//是显示的html语句
	var url=&amp;quot;Layout.sp?id=SearchTrk&amp;query=&amp;quot;+query+&amp;quot;&amp;quot;+&amp;quot;&amp;crtusr=&amp;quot;+crtusr+&amp;quot;&amp;trkprj=&amp;quot;+trkprj;//单击的链接
	var sql=&amp;quot;&amp;quot;;
	var querywhere = &amp;quot;&amp;quot;;
	var category = &amp;quot;&amp;quot;;//分类查询条件
	// //添加查询条件
	querywhere = &amp;quot; and (&amp;quot;;
			var str=query.split(&amp;quot; &amp;quot;);
			  //throw new Exception(str);
			for(var i=0;i&amp;lt;str.length();i++)    
			{	
				if(i==0){
					querywhere+=&amp;quot;  lower( concat(B.title,concat(B.note,to_char(b.crtdat,&amp;apos;yyyy-mm-dd&amp;apos;)))) like lower(&amp;apos;%&amp;quot;+str[i]+&amp;quot;%&amp;apos;)&amp;quot;; 
				}else{
					querywhere+=&amp;quot; and lower( concat(B.title,concat(B.note,to_char(b.crtdat,&amp;apos;yyyy-mm-dd&amp;apos;)))) like lower(&amp;apos;%&amp;quot;+str[i]+&amp;quot;%&amp;apos;)&amp;quot;; 
				}
			} 
		querywhere+=&amp;quot;) &amp;quot;;
	category = &amp;quot;and b.crtusr like &amp;apos;&amp;quot;+crtusr+&amp;quot;%&amp;apos;&amp;quot;+
			&amp;quot;and b.project like &amp;apos;&amp;quot;+trkprj+&amp;quot;%&amp;apos;&amp;quot;;
	try {
		db = new pubpack.EADatabase();	// 如果连接到其他数据库, new pubpack.EADatabase(“dbname”)
		var sql = &amp;quot;select * from (&amp;quot;;
				sql+=&amp;quot;SELECT A.ID,A.NAME||&amp;apos;(&amp;apos;||COUNT(*)||&amp;apos;)&amp;apos; NAME,A.GUID ,&amp;apos;&amp;quot;+
					url+&amp;quot;&amp;trktyp=&amp;apos;|| A.id  url &amp;quot;+
					&amp;quot;FROM trktyp A,TRKHDR B ,v_usr c ,v_usr cc &amp;quot;+
					&amp;quot;WHERE B.show=A.ID &amp;quot;+
					&amp;quot; and c.id= b.crtusr  &amp;quot;+
					&amp;quot; and cc.id(+)= b.dtlusr &amp;quot;+
					&amp;quot; and b.AIMORG=c.orgid &amp;quot;+
					&amp;quot; and b.AIMORG=cc.orgid(+) &amp;quot;+
					category;
				
				sql+=querywhere;
				
				sql+=&amp;quot;GROUP BY A.ID,A.NAME,A.GUID &amp;quot;+
				&amp;quot;ORDER BY A.ID&amp;quot;;
		sql+=&amp;quot;) a&amp;quot;;
		
		sql+=&amp;quot; union &amp;quot;;
		sql+=&amp;quot;select &amp;apos;&amp;apos; id ,&amp;quot;+
                &amp;quot; &amp;apos;全部 &amp;apos; || &amp;apos;(&amp;apos; || COUNT(*) || &amp;apos;)&amp;apos; NAME , &amp;quot;+
                &amp;quot; &amp;apos;&amp;apos; guid, &amp;quot;+
                &amp;quot; &amp;apos;&amp;quot;+url+&amp;quot;&amp;trktyp=&amp;apos; url &amp;quot;+
		&amp;quot;from TRKHDR B, v_usr c, v_usr cc WHERE   &amp;quot;+
		&amp;quot;c.id = b.crtusr &amp;quot;+
		&amp;quot;and cc.id(+) = b.dtlusr &amp;quot;+
		&amp;quot;and b.AIMORG = c.orgid  &amp;quot;+
		&amp;quot;and b.AIMORG = cc.orgid(+) &amp;quot;+
		category;
           	sql+=querywhere;
		
		msg=msg+&amp;quot;&amp;lt;td valign=\&amp;quot;top\&amp;quot;&amp;gt;&amp;quot;+
		&amp;quot;&amp;lt;font color=\&amp;quot;#014E82\&amp;quot;&amp;gt;&amp;quot;+
		&amp;quot;&amp;lt;table width=\&amp;quot;100%\&amp;quot; align=\&amp;quot;left\&amp;quot; border=\&amp;quot;0\&amp;quot; cellpadding=\&amp;quot;1\&amp;quot;&amp;gt;&amp;quot;+
		&amp;quot;&amp;lt;tbody&amp;gt;&amp;quot;;//
		
		//throw new Exception(sql);
		var ds = db.QuerySQL(sql);
		for( var i=0 ;i&amp;lt;ds.getRowCount(); i++ ) {
			msg = msg+&amp;quot;&amp;lt;tr&amp;gt; &amp;lt;td width=100%  &amp;gt;&amp;lt;a href=&amp;apos;#&amp;apos; onclick=\&amp;quot;javascript:window.location=&amp;apos;&amp;quot;+ds.getStringAt(i,&amp;quot;url&amp;quot;)+&amp;quot;&amp;apos;;\&amp;quot;&amp;gt;&amp;quot;+ds.getStringAt(i,&amp;quot;name&amp;quot;)+&amp;quot;&amp;lt;/a&amp;gt;&amp;lt;/td&amp;gt;&amp;lt;/tr&amp;gt;&amp;quot;;
		}
		//msg = msg+&amp;quot;&amp;lt;tr&amp;gt; &amp;lt;td width=100%  &amp;gt;&amp;lt;a href=&amp;apos;#&amp;apos; onclick=\&amp;quot;javascript:window.location=&amp;apos;&amp;quot;+url+&amp;quot;&amp;trkprj=&amp;quot;+&amp;quot;&amp;apos;;\&amp;quot;&amp;gt;&amp;quot;+&amp;quot;全部&amp;quot;+&amp;quot;&amp;lt;/a&amp;gt;&amp;lt;/td&amp;gt;&amp;lt;/tr&amp;gt;&amp;quot;;//添加全部按钮
		msg=msg+&amp;quot;&amp;lt;/tbody&amp;gt;&amp;quot;+&amp;quot;&amp;lt;/table&amp;gt;&amp;quot;+&amp;quot;&amp;lt;/font&amp;gt;&amp;quot;+&amp;quot;&amp;lt;/td&amp;gt;&amp;quot;;
		
	}
	catch ( ee ) {
		db.Rollback();
		throw new pubpack.EAException ( ee.toString() );
	}
	finally {
		if (db!=null) db.Close();
	}
	return msg;//直接返回html语句

}
//搜索事务的创建人分类列表 有全部按钮
function searchcrtusrlist(){ 
	var db = null;
	var msg= &amp;quot;&amp;quot;;//是显示的html语句
	var url=&amp;quot;Layout.sp?id=SearchTrk&amp;query=&amp;quot;+query+&amp;quot;&amp;quot;+&amp;quot;&amp;trktyp=&amp;quot;+trktyp+&amp;quot;&amp;trkprj=&amp;quot;+trkprj;//单击的链接
	var sql=&amp;quot;&amp;quot;;
	var querywhere = &amp;quot;&amp;quot;;
	var category = &amp;quot;&amp;quot;;//分类查询条件
	// //添加查询条件
	querywhere = &amp;quot; and (&amp;quot;;
			var str=query.split(&amp;quot; &amp;quot;);
			  //throw new Exception(str);
			for(var i=0;i&amp;lt;str.length();i++)    
			{	
				if(i==0){
					querywhere+=&amp;quot;  lower( concat(B.title,concat(B.note,to_char(b.crtdat,&amp;apos;yyyy-mm-dd&amp;apos;)))) like lower(&amp;apos;%&amp;quot;+str[i]+&amp;quot;%&amp;apos;)&amp;quot;; 
				}else{
					querywhere+=&amp;quot; and lower( concat(B.title,concat(B.note,to_char(b.crtdat,&amp;apos;yyyy-mm-dd&amp;apos;)))) like lower(&amp;apos;%&amp;quot;+str[i]+&amp;quot;%&amp;apos;)&amp;quot;; 
				}
			} 
		querywhere+=&amp;quot;) &amp;quot;;
	category = &amp;quot;and b.show like &amp;apos;&amp;quot;+trktyp+&amp;quot;%&amp;apos;&amp;quot;+
			&amp;quot;and b.project like &amp;apos;&amp;quot;+trkprj+&amp;quot;%&amp;apos;&amp;quot;;
	try {
		db = new pubpack.EADatabase();	// 如果连接到其他数据库, new pubpack.EADatabase(“dbname”)
		var sql = &amp;quot;select * from (&amp;quot;;
				sql+=&amp;quot;SELECT A.ID,A.NAME||&amp;apos;(&amp;apos;||COUNT(*)||&amp;apos;)&amp;apos; NAME,A.GUID ,&amp;apos;&amp;quot;+
					url+&amp;quot;&amp;crtusr=&amp;apos;|| A.id  url &amp;quot;+
					&amp;quot;FROM v_usr9 A,TRKHDR B ,v_usr c ,v_usr cc &amp;quot;+
					&amp;quot;WHERE B.crtusr=A.ID &amp;quot;+
					&amp;quot; and c.id= b.crtusr  &amp;quot;+
					&amp;quot; and cc.id(+)= b.dtlusr &amp;quot;+
					&amp;quot; and b.AIMORG=c.orgid &amp;quot;+
					&amp;quot; and b.AIMORG=cc.orgid(+) &amp;quot;+
					category;
				
				sql+=querywhere;
				
				sql+=&amp;quot;GROUP BY A.ID,A.NAME,A.GUID &amp;quot;+
				&amp;quot;ORDER BY A.ID&amp;quot;;
		sql+=&amp;quot;) a&amp;quot;;
		
		sql+=&amp;quot; union &amp;quot;;
		sql+=&amp;quot;select &amp;apos;&amp;apos; id ,&amp;quot;+
                &amp;quot; &amp;apos;全部 &amp;apos; || &amp;apos;(&amp;apos; || COUNT(*) || &amp;apos;)&amp;apos; NAME , &amp;quot;+
                &amp;quot; &amp;apos;&amp;apos; guid, &amp;quot;+
                &amp;quot; &amp;apos;&amp;quot;+url+&amp;quot;&amp;crtusr=&amp;apos; url &amp;quot;+
		&amp;quot;from TRKHDR B, v_usr c, v_usr cc WHERE   &amp;quot;+
		&amp;quot;c.id = b.crtusr &amp;quot;+
		&amp;quot;and cc.id(+) = b.dtlusr &amp;quot;+
		&amp;quot;and b.AIMORG = c.orgid  &amp;quot;+
		&amp;quot;and b.AIMORG = cc.orgid(+) &amp;quot;+
		category;
           	sql+=querywhere;
		
		msg=msg+&amp;quot;&amp;lt;td valign=\&amp;quot;top\&amp;quot;&amp;gt;&amp;quot;+
		&amp;quot;&amp;lt;font color=\&amp;quot;#014E82\&amp;quot;&amp;gt;&amp;quot;+
		&amp;quot;&amp;lt;table width=\&amp;quot;100%\&amp;quot; align=\&amp;quot;left\&amp;quot; border=\&amp;quot;0\&amp;quot; cellpadding=\&amp;quot;1\&amp;quot;&amp;gt;&amp;quot;+
		&amp;quot;&amp;lt;tbody&amp;gt;&amp;quot;;//
		
		//throw new Exception(sql);
		var ds = db.QuerySQL(sql);
		for( var i=0 ;i&amp;lt;ds.getRowCount(); i++ ) {
			msg = msg+&amp;quot;&amp;lt;tr&amp;gt; &amp;lt;td width=100%  &amp;gt;&amp;lt;a href=&amp;apos;#&amp;apos; onclick=\&amp;quot;javascript:window.location=&amp;apos;&amp;quot;+ds.getStringAt(i,&amp;quot;url&amp;quot;)+&amp;quot;&amp;apos;;\&amp;quot;&amp;gt;&amp;quot;+ds.getStringAt(i,&amp;quot;name&amp;quot;)+&amp;quot;&amp;lt;/a&amp;gt;&amp;lt;/td&amp;gt;&amp;lt;/tr&amp;gt;&amp;quot;;
		}
		//msg = msg+&amp;quot;&amp;lt;tr&amp;gt; &amp;lt;td width=100%  &amp;gt;&amp;lt;a href=&amp;apos;#&amp;apos; onclick=\&amp;quot;javascript:window.location=&amp;apos;&amp;quot;+url+&amp;quot;&amp;trkprj=&amp;quot;+&amp;quot;&amp;apos;;\&amp;quot;&amp;gt;&amp;quot;+&amp;quot;全部&amp;quot;+&amp;quot;&amp;lt;/a&amp;gt;&amp;lt;/td&amp;gt;&amp;lt;/tr&amp;gt;&amp;quot;;//添加全部按钮
		msg=msg+&amp;quot;&amp;lt;/tbody&amp;gt;&amp;quot;+&amp;quot;&amp;lt;/table&amp;gt;&amp;quot;+&amp;quot;&amp;lt;/font&amp;gt;&amp;quot;+&amp;quot;&amp;lt;/td&amp;gt;&amp;quot;;
	}
	catch ( ee ) {
		db.Rollback();
		throw new pubpack.EAException ( ee.toString() );
	}
	finally {
		if (db!=null) db.Close();
	}
	return msg;//直接返回html语句

}

// 得到某个api的主界面
// 客户端: apiguid 对应FUNCLIST的guid
function apiquery()
{
	var db = null;
	var msg= &amp;quot;&amp;quot;;
	var usrinfo = webpack.EASession.GetLoginInfo(request);
	var loginusrid = usrinfo.getUsrid();
	var loginorgid = usrinfo.getusrOrg();	
	try {
	
		//msg += &amp;quot;&amp;lt;p align=center&amp;gt;&amp;lt;B&amp;gt;&amp;lt;font size=3 &amp;gt;&amp;quot;+ds.getStringAt(0,&amp;quot;title&amp;quot;)+&amp;quot;&amp;lt;font&amp;gt;&amp;lt;/B&amp;gt;&amp;lt;/p&amp;gt;&amp;quot;;
		//msg += &amp;quot;&amp;lt;p align=center&amp;gt;&amp;lt;font size=2 color=#808080&amp;gt;&amp;quot;+ds.getStringAt(0,&amp;quot;crtusr&amp;quot;)+&amp;quot; &amp;quot;+ds.getStringAt(0,&amp;quot;crttim&amp;quot;)+&amp;quot;&amp;lt;/font&amp;gt;&amp;lt;/p&amp;gt;&amp;quot;;
		db = new pubpack.EADatabase();	// 如果连接到其他数据库, new pubpack.EADatabase(“dbname”)
		var sql = &amp;quot;select a.SAMPLE,a.PARAMETER,a.PARAMNOTE,a.FUNCTION,a.return,a.note,a.name,a.FUNCNOTE,a.CRTDAT,a.id from FUNCLIST a where a.guid=&amp;apos;&amp;quot;+apiguid+&amp;quot;&amp;apos;&amp;quot;;
		//throw new Exception(sql);
		var ds = db.QuerySQL(sql);
		
		if ( ds.getRowCount() &amp;gt; 0 ) {
			var id = ds.getStringAt(0,&amp;quot;id&amp;quot;);
			//if(ds.getStringAt(0,&amp;quot;name&amp;quot;)!=&amp;quot;&amp;quot;)
				msg += &amp;quot;&amp;lt;p align=center&amp;gt;&amp;lt;B&amp;gt;&amp;lt;font size=3 &amp;gt;&amp;quot;+ds.getStringAt(0,&amp;quot;name&amp;quot;)+&amp;quot;&amp;lt;font&amp;gt;&amp;lt;/B&amp;gt;&amp;lt;/p&amp;gt;&amp;quot;;
			//msg += &amp;quot;&amp;lt;p align=center&amp;gt;&amp;lt;font size=2 color=#808080&amp;gt;&amp;quot;+&amp;quot;创建日期 &amp;quot;+ds.getStringAt(0,&amp;quot;CRTDAT&amp;quot;)+&amp;quot;&amp;lt;/font&amp;gt;&amp;lt;/p&amp;gt;&amp;quot;;
			msg += &amp;quot;&amp;lt;font size=2 &amp;gt;&amp;lt;br&amp;gt;&amp;quot;+&amp;quot;名称:&amp;lt;font size=2 color=&amp;apos;#333333&amp;apos;&amp;gt; &amp;quot;+ds.getStringAt(0,&amp;quot;FUNCTION&amp;quot;)+&amp;quot;&amp;lt;/font&amp;gt;&amp;quot;;
			msg += &amp;quot;&amp;lt;font size=2 &amp;gt;&amp;lt;br&amp;gt;&amp;quot;+&amp;quot;&amp;lt;/font&amp;gt;方法定义:&amp;lt;font size=2 color=&amp;apos;#333333&amp;apos;&amp;gt;&amp;quot;+ds.getStringAt(0,&amp;quot;FUNCNOTE&amp;quot;)+&amp;quot;&amp;lt;/font&amp;gt;&amp;quot;;
			msg += &amp;quot;&amp;lt;br&amp;gt;&amp;quot;+&amp;quot;返回值:&amp;lt;font size=2 color=&amp;apos;#333333&amp;apos;&amp;gt;&amp;quot;+ds.getStringAt(0,&amp;quot;return&amp;quot;)+&amp;quot;&amp;lt;/font&amp;gt;&amp;quot;;
			msg += &amp;quot;&amp;lt;br&amp;gt;&amp;quot;+&amp;quot;功能说明:&amp;lt;/font&amp;gt;&amp;quot;;
			var note = ds.getStringAt(0,&amp;quot;note&amp;quot;);
			note = pubpack.EAFunc.Replace(note,&amp;quot;\n&amp;quot;,&amp;quot;&amp;lt;br&amp;gt;&amp;quot;);//替换换行键
			note = pubpack.EAFunc.Replace(note,&amp;quot;\r&amp;quot;,&amp;quot;&amp;lt;br&amp;gt;&amp;quot;);//替换换行键
			note = pubpack.EAFunc.Replace(note,&amp;quot;\u0009&amp;quot;,&amp;quot;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;quot;);//替换tab键
			msg += &amp;quot;&amp;lt;br&amp;gt;&amp;lt;font size=2 color=&amp;apos;#333333&amp;apos;&amp;gt;&amp;quot;+note+&amp;quot;&amp;lt;/font&amp;gt;&amp;quot;;
			
			
			//var id = ds.getStringAt(0,&amp;quot;id&amp;quot;);
			var note = ds.getStringAt(0,&amp;quot;PARAMETER&amp;quot;);
			note = pubpack.EAFunc.Replace(note,&amp;quot;\n&amp;quot;,&amp;quot;&amp;lt;br&amp;gt;&amp;quot;);//替换换行键
			note = pubpack.EAFunc.Replace(note,&amp;quot;\r&amp;quot;,&amp;quot;&amp;lt;br&amp;gt;&amp;quot;);//替换换行键
			note = pubpack.EAFunc.Replace(note,&amp;quot;\u0009&amp;quot;,&amp;quot;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;quot;);//替换tab键
			msg += &amp;quot;&amp;lt;br&amp;gt;&amp;lt;p align=left&amp;gt;&amp;lt;font size=2  &amp;gt;参数:&amp;lt;font size=2 color=&amp;apos;#333333&amp;apos;&amp;gt;&amp;quot;+note+&amp;quot;&amp;lt;/font&amp;gt;&amp;lt;/p&amp;gt;&amp;quot;;
			//msg += &amp;quot;&amp;lt;p align=center&amp;gt;&amp;lt;font size=1 color=#808080&amp;gt;&amp;quot;+&amp;quot; &amp;quot;+ds.getStringAt(0,&amp;quot;PARAMNOTE&amp;quot;)+&amp;quot;&amp;lt;/font&amp;gt;&amp;lt;/p&amp;gt;&amp;quot;;
			
			var PARAMNOTE = ds.getStringAt(0,&amp;quot;PARAMNOTE&amp;quot;);
			PARAMNOTE = pubpack.EAFunc.Replace(PARAMNOTE,&amp;quot;\n&amp;quot;,&amp;quot;&amp;lt;br&amp;gt;&amp;quot;);//替换换行键
			PARAMNOTE = pubpack.EAFunc.Replace(PARAMNOTE,&amp;quot;\r&amp;quot;,&amp;quot;&amp;lt;br&amp;gt;&amp;quot;);//替换换行键
			PARAMNOTE = pubpack.EAFunc.Replace(PARAMNOTE,&amp;quot;\u0009&amp;quot;,&amp;quot;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;quot;);//替换tab键
			//throw new Exception(note+&amp;quot;&amp;quot;);
			msg += &amp;quot;&amp;lt;br&amp;gt;&amp;lt;font size=2&amp;gt;参数说明:&amp;lt;/font&amp;gt;&amp;lt;br&amp;gt;&amp;lt;font size=2 color=&amp;apos;#333333&amp;apos;&amp;gt;&amp;quot;+PARAMNOTE+&amp;quot;&amp;lt;/font&amp;gt;&amp;quot;;
			
			var note = ds.getStringAt(0,&amp;quot;SAMPLE&amp;quot;);
			note = pubpack.EAFunc.Replace(note,&amp;quot;\n&amp;quot;,&amp;quot;&amp;lt;br&amp;gt;&amp;quot;);//替换换行键
			note = pubpack.EAFunc.Replace(note,&amp;quot;\r&amp;quot;,&amp;quot;&amp;lt;br&amp;gt;&amp;quot;);//替换换行键
			note = pubpack.EAFunc.Replace(note,&amp;quot;\u0009&amp;quot;,&amp;quot;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;quot;);//替换tab键
			//throw new Exception(note+&amp;quot;&amp;quot;);
			msg += &amp;quot;&amp;lt;br&amp;gt;&amp;lt;font size=2 &amp;gt;例子:&amp;lt;/font&amp;gt;&amp;lt;br&amp;gt;&amp;lt;font size=2 color=&amp;apos;#333333&amp;apos;&amp;quot;+note+&amp;quot;&amp;lt;/font&amp;gt;&amp;quot;;

		}
		
	}
	catch ( ee ) {
		db.Rollback();
		throw new pubpack.EAException ( ee.toString() );
	}
	finally {
		if (db!=null) db.Close();
	}
	return msg;
}
// 得到某个api的类别,属性
function apiqueryclass()
{
	var db = null;
	var msg= &amp;quot;&amp;quot;;
	var usrinfo = webpack.EASession.GetLoginInfo(request);
	var loginusrid = usrinfo.getUsrid();
	var loginorgid = usrinfo.getusrOrg();	
	try {

		db = new pubpack.EADatabase();	// 如果连接到其他数据库, new pubpack.EADatabase(“dbname”)
		var sql = &amp;quot;select a.guid,a.function, a.class, D.NAME flag, a.RLSNO, C.NAME lang, b.name SUBTYP, a.id
			  from FUNCLIST a ,V_FUNCSUBTYP B,V_FUNCLANG c,V_FUNCFLAG d 
			 where c.id(+)=a.lang and d.id(+)=a.flag AND B.ID(+)=A.SUBTYP and a.guid=&amp;apos;&amp;quot;+apiguid+&amp;quot;&amp;apos;&amp;quot;;
		//throw new Exception(sql);
		var ds = db.QuerySQL(sql);
		
		if ( ds.getRowCount() &amp;gt; 0 ) {
			var id = ds.getStringAt(0,&amp;quot;id&amp;quot;);
			msg +=&amp;quot;&amp;lt;font color=#014E82 size=2&amp;gt;&amp;quot;;
			msg +=&amp;quot;语言:&amp;quot;+ ds.getStringAt(0,&amp;quot;LANG&amp;quot;)+&amp;quot;&amp;lt;br&amp;gt;&amp;quot;;
			//msg +=&amp;quot;名称:&amp;quot;+ ds.getStringAt(0,&amp;quot;function&amp;quot;)+&amp;quot;&amp;lt;br&amp;gt;&amp;quot;;
			msg +=&amp;quot;类名:&amp;quot;+ ds.getStringAt(0,&amp;quot;class&amp;quot;)+&amp;quot;&amp;lt;br&amp;gt;&amp;quot;;
			msg +=&amp;quot;标志:&amp;quot;+ ds.getStringAt(0,&amp;quot;flag&amp;quot;)+&amp;quot;&amp;lt;br&amp;gt;&amp;quot;;
			msg +=&amp;quot;分类:&amp;quot;+ ds.getStringAt(0,&amp;quot;SUBTYP&amp;quot;)+&amp;quot;&amp;lt;br&amp;gt;&amp;quot;;
			msg +=&amp;quot;支持版本:&amp;quot;+ ds.getStringAt(0,&amp;quot;RLSNO&amp;quot;)+&amp;quot;&amp;lt;br&amp;gt;&amp;quot;;
			msg +=&amp;quot;&amp;lt;/font&amp;gt;&amp;lt;/p&amp;gt;&amp;quot;;

			var guid = ds.getStringAt(0,&amp;quot;guid&amp;quot;);
			msg+=&amp;quot;&amp;lt;p align=center&amp;gt;&amp;lt;a href=&amp;apos;show.sp?grdid=ACTIVEX&amp;guid=&amp;quot;+guid+&amp;quot;&amp;apos;&amp;gt;编辑&amp;lt;/a&amp;gt;&amp;lt;/p&amp;gt;&amp;quot;;

		}
		
		
	}
	catch ( ee ) {
		db.Rollback();
		throw new pubpack.EAException ( ee.toString() );
	}
	finally {
		if (db!=null) db.Close();
	}
	return msg;
}


//搜索函数库api的列表
function searchapi(){ 
	
	var db = null;
	var msg= &amp;quot;&amp;quot;;//是显示的html语句
	//	listtyp:  1 为我的待办事务 2 为我创建的事务 3为 日志
	var sql = &amp;quot;&amp;quot;;
	var querywhere = &amp;quot;  (&amp;quot;;//查询函数库的sql的条件语句
			var str=query.split(&amp;quot; &amp;quot;);
			  //throw new Exception(str);
			for(var i=0;i&amp;lt;str.length();i++)    
			{	
				if(i==0){
					querywhere+=&amp;quot;  lower( concat(a.function, concat(a.name,concat(a.note,to_char(a.crtdat,&amp;apos;yyyy-mm-dd&amp;apos;))))) like lower(&amp;apos;%&amp;quot;+str[i]+&amp;quot;%&amp;apos;)&amp;quot;; 
				}else{
					querywhere+=&amp;quot; and lower( concat(a.function, concat(a.name,concat( a.note,to_char(a.crtdat,&amp;apos;yyyy-mm-dd&amp;apos;))))) like lower(&amp;apos;%&amp;quot;+str[i]+&amp;quot;%&amp;apos;)&amp;quot;; 
				}
			} 
		querywhere+=&amp;quot;) &amp;quot;;
	var category = &amp;quot; and decode(a.lang,null,&amp;apos; &amp;apos;,a.lang) like &amp;apos;&amp;quot;+apilang+&amp;quot;%&amp;apos;&amp;quot;+
			&amp;quot;and decode(a.flag,null,&amp;apos; &amp;apos;, a.flag) like &amp;apos;&amp;quot;+apiflag+&amp;quot;%&amp;apos;&amp;quot;+
			&amp;quot;and decode(a.subtyp,null,&amp;apos; &amp;apos;, a.subtyp) like&amp;apos;&amp;quot;+apisubtyp+&amp;quot;%&amp;apos;&amp;quot;;
	
	var sqlapi=&amp;quot;select &amp;apos;&amp;apos; id,&amp;apos;&amp;apos; guid,&amp;apos;●&amp;apos;||a.function||&amp;apos;  (类名:&amp;apos;||a.CLASS||&amp;apos;)&amp;apos;||&amp;apos;(&amp;apos;||c.name||&amp;apos;)&amp;apos;||&amp;apos;&amp;lt;br&amp;gt; &amp;nbsp; &amp;apos;||a.name  name,&amp;apos;Layout.sp?id=apiquery&amp;apiguid=&amp;apos;||a.guid url from FUNCLIST a , V_FUNCSUBTYP B, V_FUNCLANG c, V_FUNCFLAG d
			 where c.id(+) = a.lang
			   and d.id(+) = a.flag
			   AND B.ID(+) = A.SUBTYP and &amp;quot;+querywhere+category;
	
	//throw new Exception(sqlapi);
	
	var url=&amp;quot;Layout.sp?id=trkquery&amp;quot;;
	try {
		db = new pubpack.EADatabase();	// 如果连接到其他数据库, new pubpack.EADatabase(“dbname”)
		
		msg=msg+&amp;quot;&amp;lt;td valign=\&amp;quot;top\&amp;quot;&amp;gt;&amp;quot;+
		&amp;quot;&amp;lt;font color=\&amp;quot;#014E82\&amp;quot;&amp;gt;&amp;quot;+
		&amp;quot;&amp;lt;table width=\&amp;quot;100%\&amp;quot; align=\&amp;quot;left\&amp;quot; border=\&amp;quot;0\&amp;quot; cellpadding=\&amp;quot;1\&amp;quot;&amp;gt;&amp;quot;+
		&amp;quot;&amp;lt;tbody&amp;gt;&amp;quot;;//编写格式,对齐方式为左对齐,置顶
		var ds = db.QuerySQL(sqlapi);
		//
		for( var i=0 ;i&amp;lt;ds.getRowCount()&amp;&amp;i&amp;lt;=500; i++ ) {
			msg = msg+&amp;quot;&amp;lt;tr&amp;gt; &amp;lt;td width=100%  &amp;gt;&amp;lt;a href=&amp;apos;#&amp;apos; onclick=\&amp;quot;javascript:window.location=&amp;apos;&amp;quot;+ds.getStringAt(i,&amp;quot;url&amp;quot;)+&amp;quot;&amp;apos;;\&amp;quot;&amp;gt;&amp;quot;+ds.getStringAt(i,&amp;quot;name&amp;quot;)+&amp;quot;&amp;lt;/a&amp;gt;&amp;lt;/td&amp;gt;&amp;lt;/tr&amp;gt;&amp;quot;;
		}
		//msg += &amp;quot;&amp;lt;tr&amp;gt;&amp;lt;td width=100%  &amp;gt;------------------------------&amp;lt;/td&amp;gt;&amp;lt;/tr&amp;gt;&amp;quot;;
		//		//msg = msg+&amp;quot;&amp;lt;tr&amp;gt; &amp;lt;td width=100%  &amp;gt;&amp;lt;a href=&amp;apos;#&amp;apos; onclick=\&amp;quot;javascript:window.location=&amp;apos;&amp;quot;+url+&amp;quot;&amp;guid=&amp;apos;;\&amp;quot;&amp;gt;&amp;quot;+&amp;quot;全部&amp;quot;+&amp;quot;&amp;lt;/a&amp;gt;&amp;lt;/td&amp;gt;&amp;lt;/tr&amp;gt;&amp;quot;;//添加全部按钮
		msg=msg+&amp;quot;&amp;lt;/tbody&amp;gt;&amp;quot;+&amp;quot;&amp;lt;/table&amp;gt;&amp;quot;+&amp;quot;&amp;lt;/font&amp;gt;&amp;quot;+&amp;quot;&amp;lt;/td&amp;gt;&amp;quot;;
		
	}
	catch ( ee ) {
		db.Rollback();
		throw new pubpack.EAException ( ee.toString() );
	}
	finally {
		if (db!=null) db.Close();
	}
	return msg;//直接返回html语句

}
//搜索api的语言分类列表 有全部按钮
function searchapilanglist(){
	var db = null;
	var msg= &amp;quot;&amp;quot;;//是显示的html语句
	var url=&amp;quot;Layout.sp?id=SearchAPI&amp;query=&amp;quot;+query+&amp;quot;&amp;quot;+&amp;quot;&amp;apiflag=&amp;quot;+apiflag+&amp;quot;&amp;apisubtyp=&amp;quot;+apisubtyp;//单击的链接
	var sql=&amp;quot;&amp;quot;;
	var querywhere = &amp;quot;&amp;quot;;
	var category = &amp;quot;&amp;quot;;//分类查询条件
	// //添加查询条件
	var querywhere = &amp;quot;  (&amp;quot;;//查询函数库的sql的条件语句
			var str=query.split(&amp;quot; &amp;quot;);
			  //throw new Exception(str);
			for(var i=0;i&amp;lt;str.length();i++)    
			{	
				if(i==0){
					querywhere+=&amp;quot;  lower( concat(a.function, concat(a.name,concat(a.note,to_char(a.crtdat,&amp;apos;yyyy-mm-dd&amp;apos;))))) like lower(&amp;apos;%&amp;quot;+str[i]+&amp;quot;%&amp;apos;)&amp;quot;; 
				}else{
					querywhere+=&amp;quot; and lower( concat(a.function, concat(a.name,concat( a.note,to_char(a.crtdat,&amp;apos;yyyy-mm-dd&amp;apos;))))) like lower(&amp;apos;%&amp;quot;+str[i]+&amp;quot;%&amp;apos;)&amp;quot;; 
				}
			} 
		querywhere+=&amp;quot;) &amp;quot;;
	category = //&amp;quot;and decode(a.lang,null,&amp;apos; &amp;apos;,a.lang) like &amp;apos;&amp;quot;+apilang+&amp;quot;%&amp;apos;&amp;quot;+
			&amp;quot;and decode(a.flag,null,&amp;apos; &amp;apos;, a.flag) like &amp;apos;&amp;quot;+apiflag+&amp;quot;%&amp;apos;&amp;quot;+
			&amp;quot;and decode(a.subtyp,null,&amp;apos; &amp;apos;, a.subtyp) like&amp;apos;&amp;quot;+apisubtyp+&amp;quot;%&amp;apos;&amp;quot;;
	try {
		db = new pubpack.EADatabase();	// 如果连接到其他数据库, new pubpack.EADatabase(“dbname”)
		var sql = &amp;quot;select * from (&amp;quot;;
				sql+=&amp;quot;SELECT c.ID,c.NAME||&amp;apos;(&amp;apos;||COUNT(*)||&amp;apos;)&amp;apos; NAME,c.GUID ,&amp;apos;&amp;quot;+
					url+&amp;quot;&amp;apilang=&amp;apos;|| c.id  url &amp;quot;+
					&amp;quot;from FUNCLIST a , V_FUNCSUBTYP B, V_FUNCLANG c, V_FUNCFLAG d
					 where c.id(+) = a.lang
					   and d.id(+) = a.flag
					   AND B.ID(+) = A.SUBTYP &amp;quot;+
					category;
				
				sql+=&amp;quot; and &amp;quot;+querywhere;
				
				sql+=&amp;quot;GROUP BY c.ID,c.NAME,c.GUID &amp;quot;+
				&amp;quot;ORDER BY c.ID&amp;quot;;
		sql+=&amp;quot;) a&amp;quot;;
		
		sql+=&amp;quot; union &amp;quot;;
		sql+=&amp;quot;select &amp;apos;&amp;apos; id ,&amp;quot;+
                &amp;quot; &amp;apos;全部 &amp;apos; || &amp;apos;(&amp;apos; || COUNT(*) || &amp;apos;)&amp;apos; NAME , &amp;quot;+
                &amp;quot; &amp;apos;&amp;apos; guid, &amp;quot;+
                &amp;quot; &amp;apos;&amp;quot;+url+&amp;quot;&amp;apilang=&amp;apos; url &amp;quot;+
		&amp;quot;from FUNCLIST a , V_FUNCSUBTYP B, V_FUNCLANG c, V_FUNCFLAG d
					 where c.id(+) = a.lang
					   and d.id(+) = a.flag
					   AND B.ID(+) = A.SUBTYP &amp;quot;+
		category;
           	sql+=&amp;quot; and &amp;quot;+querywhere;

		
		msg=msg+&amp;quot;&amp;lt;td valign=\&amp;quot;top\&amp;quot;&amp;gt;&amp;quot;+
		&amp;quot;&amp;lt;font color=\&amp;quot;#014E82\&amp;quot;&amp;gt;&amp;quot;+
		&amp;quot;&amp;lt;table width=\&amp;quot;100%\&amp;quot; align=\&amp;quot;left\&amp;quot; border=\&amp;quot;0\&amp;quot; cellpadding=\&amp;quot;1\&amp;quot;&amp;gt;&amp;quot;+
		&amp;quot;&amp;lt;tbody&amp;gt;&amp;quot;;//
		
		//throw new Exception(sql);
		var ds = db.QuerySQL(sql);
		for( var i=0 ;i&amp;lt;ds.getRowCount(); i++ ) {
			msg = msg+&amp;quot;&amp;lt;tr&amp;gt; &amp;lt;td width=100%  &amp;gt;&amp;lt;a href=&amp;apos;#&amp;apos; onclick=\&amp;quot;javascript:window.location=&amp;apos;&amp;quot;+ds.getStringAt(i,&amp;quot;url&amp;quot;)+&amp;quot;&amp;apos;;\&amp;quot;&amp;gt;&amp;quot;+ds.getStringAt(i,&amp;quot;name&amp;quot;)+&amp;quot;&amp;lt;/a&amp;gt;&amp;lt;/td&amp;gt;&amp;lt;/tr&amp;gt;&amp;quot;;
		}
		//msg = msg+&amp;quot;&amp;lt;tr&amp;gt; &amp;lt;td width=100%  &amp;gt;&amp;lt;a href=&amp;apos;#&amp;apos; onclick=\&amp;quot;javascript:window.location=&amp;apos;&amp;quot;+url+&amp;quot;&amp;trkprj=&amp;quot;+&amp;quot;&amp;apos;;\&amp;quot;&amp;gt;&amp;quot;+&amp;quot;全部&amp;quot;+&amp;quot;&amp;lt;/a&amp;gt;&amp;lt;/td&amp;gt;&amp;lt;/tr&amp;gt;&amp;quot;;//添加全部按钮
		msg=msg+&amp;quot;&amp;lt;/tbody&amp;gt;&amp;quot;+&amp;quot;&amp;lt;/table&amp;gt;&amp;quot;+&amp;quot;&amp;lt;/font&amp;gt;&amp;quot;+&amp;quot;&amp;lt;/td&amp;gt;&amp;quot;;
		
	}
	catch ( ee ) {
		db.Rollback();
		throw new pubpack.EAException ( ee.toString() );
	}
	finally {
		if (db!=null) db.Close();
	}
	return msg;//直接返回html语句

}
//搜索api的标志分类列表 有全部按钮
function searchapiflaglist(){
	var db = null;
	var msg= &amp;quot;&amp;quot;;//是显示的html语句
	var url=&amp;quot;Layout.sp?id=SearchAPI&amp;query=&amp;quot;+query+&amp;quot;&amp;quot;+&amp;quot;&amp;apilang=&amp;quot;+apilang+&amp;quot;&amp;apisubtyp=&amp;quot;+apisubtyp;//单击的链接

	var sql=&amp;quot;&amp;quot;;
	var querywhere = &amp;quot;&amp;quot;;
	var category = &amp;quot;&amp;quot;;//分类查询条件
	// //添加查询条件
	var querywhere = &amp;quot;  (&amp;quot;;//查询函数库的sql的条件语句
			var str=query.split(&amp;quot; &amp;quot;);
			  //throw new Exception(str);
			for(var i=0;i&amp;lt;str.length();i++)    
			{	
				if(i==0){
					querywhere+=&amp;quot;  lower( concat(a.function, concat(a.name,concat(a.note,to_char(a.crtdat,&amp;apos;yyyy-mm-dd&amp;apos;))))) like lower(&amp;apos;%&amp;quot;+str[i]+&amp;quot;%&amp;apos;)&amp;quot;; 
				}else{
					querywhere+=&amp;quot; and lower( concat(a.function, concat(a.name,concat( a.note,to_char(a.crtdat,&amp;apos;yyyy-mm-dd&amp;apos;))))) like lower(&amp;apos;%&amp;quot;+str[i]+&amp;quot;%&amp;apos;)&amp;quot;; 
				}
			} 
		querywhere+=&amp;quot;) &amp;quot;;
	category = &amp;quot;and decode(a.lang,null,&amp;apos; &amp;apos;,a.lang) like &amp;apos;&amp;quot;+apilang+&amp;quot;%&amp;apos;&amp;quot;+
			//&amp;quot;and decode(a.flag,null,&amp;apos; &amp;apos;, a.flag) like &amp;apos;&amp;quot;+apiflag+&amp;quot;%&amp;apos;&amp;quot;+
			&amp;quot;and decode(a.subtyp,null,&amp;apos; &amp;apos;, a.subtyp) like&amp;apos;&amp;quot;+apisubtyp+&amp;quot;%&amp;apos;&amp;quot;;
	try {
		db = new pubpack.EADatabase();	// 如果连接到其他数据库, new pubpack.EADatabase(“dbname”)
		var sql = &amp;quot;select * from (&amp;quot;;
				sql+=&amp;quot;SELECT d.ID,d.NAME||&amp;apos;(&amp;apos;||COUNT(*)||&amp;apos;)&amp;apos; NAME,d.GUID ,&amp;apos;&amp;quot;+
					url+&amp;quot;&amp;apiflag=&amp;apos;|| d.id  url &amp;quot;+
					&amp;quot;from FUNCLIST a , V_FUNCSUBTYP B, V_FUNCLANG c, V_FUNCFLAG d
					 where c.id(+) = a.lang
					   and d.id(+) = a.flag
					   AND B.ID(+) = A.SUBTYP &amp;quot;+
					category;
				
				sql+=&amp;quot; and &amp;quot;+querywhere;

				
				sql+=&amp;quot;GROUP BY d.ID,d.NAME,d.GUID &amp;quot;+
				&amp;quot;ORDER BY d.ID&amp;quot;;
		sql+=&amp;quot;) a&amp;quot;;
		
		sql+=&amp;quot; union &amp;quot;;
		sql+=&amp;quot;select &amp;apos;&amp;apos; id ,&amp;quot;+
                &amp;quot; &amp;apos;全部 &amp;apos; || &amp;apos;(&amp;apos; || COUNT(*) || &amp;apos;)&amp;apos; NAME , &amp;quot;+
                &amp;quot; &amp;apos;&amp;apos; guid, &amp;quot;+
                &amp;quot; &amp;apos;&amp;quot;+url+&amp;quot;&amp;apiflag=&amp;apos; url &amp;quot;+
		&amp;quot;from FUNCLIST a , V_FUNCSUBTYP B, V_FUNCLANG c, V_FUNCFLAG d
					 where c.id(+) = a.lang
					   and d.id(+) = a.flag
					   AND B.ID(+) = A.SUBTYP &amp;quot;+
		category;
           	sql+=&amp;quot; and &amp;quot;+querywhere;

		
		msg=msg+&amp;quot;&amp;lt;td valign=\&amp;quot;top\&amp;quot;&amp;gt;&amp;quot;+
		&amp;quot;&amp;lt;font color=\&amp;quot;#014E82\&amp;quot;&amp;gt;&amp;quot;+
		&amp;quot;&amp;lt;table width=\&amp;quot;100%\&amp;quot; align=\&amp;quot;left\&amp;quot; border=\&amp;quot;0\&amp;quot; cellpadding=\&amp;quot;1\&amp;quot;&amp;gt;&amp;quot;+
		&amp;quot;&amp;lt;tbody&amp;gt;&amp;quot;;//
		
		//throw new Exception(sql);
		var ds = db.QuerySQL(sql);
		for( var i=0 ;i&amp;lt;ds.getRowCount(); i++ ) {
			msg = msg+&amp;quot;&amp;lt;tr&amp;gt; &amp;lt;td width=100%  &amp;gt;&amp;lt;a href=&amp;apos;#&amp;apos; onclick=\&amp;quot;javascript:window.location=&amp;apos;&amp;quot;+ds.getStringAt(i,&amp;quot;url&amp;quot;)+&amp;quot;&amp;apos;;\&amp;quot;&amp;gt;&amp;quot;+ds.getStringAt(i,&amp;quot;name&amp;quot;)+&amp;quot;&amp;lt;/a&amp;gt;&amp;lt;/td&amp;gt;&amp;lt;/tr&amp;gt;&amp;quot;;
		}
		//msg = msg+&amp;quot;&amp;lt;tr&amp;gt; &amp;lt;td width=100%  &amp;gt;&amp;lt;a href=&amp;apos;#&amp;apos; onclick=\&amp;quot;javascript:window.location=&amp;apos;&amp;quot;+url+&amp;quot;&amp;trkprj=&amp;quot;+&amp;quot;&amp;apos;;\&amp;quot;&amp;gt;&amp;quot;+&amp;quot;全部&amp;quot;+&amp;quot;&amp;lt;/a&amp;gt;&amp;lt;/td&amp;gt;&amp;lt;/tr&amp;gt;&amp;quot;;//添加全部按钮
		msg=msg+&amp;quot;&amp;lt;/tbody&amp;gt;&amp;quot;+&amp;quot;&amp;lt;/table&amp;gt;&amp;quot;+&amp;quot;&amp;lt;/font&amp;gt;&amp;quot;+&amp;quot;&amp;lt;/td&amp;gt;&amp;quot;;
		
	}
	catch ( ee ) {
		db.Rollback();
		throw new pubpack.EAException ( ee.toString() );
	}
	finally {
		if (db!=null) db.Close();
	}
	return msg;//直接返回html语句

}
//搜索api按分类列表 有全部按钮
function searchAPIsubtyplist(){
	var db = null;
	var msg= &amp;quot;&amp;quot;;//是显示的html语句
	var url=&amp;quot;Layout.sp?id=SearchAPI&amp;query=&amp;quot;+query+&amp;quot;&amp;quot;+&amp;quot;&amp;apiflag=&amp;quot;+apiflag+&amp;quot;&amp;apilang=&amp;quot;+apilang;//单击的链接
	var sql=&amp;quot;&amp;quot;;
	var querywhere = &amp;quot;&amp;quot;;
	var category = &amp;quot;&amp;quot;;//分类查询条件
	// //添加查询条件
	var querywhere = &amp;quot;  (&amp;quot;;//查询函数库的sql的条件语句
			var str=query.split(&amp;quot; &amp;quot;);
			  //throw new Exception(str);
			for(var i=0;i&amp;lt;str.length();i++)    
			{	
				if(i==0){
					querywhere+=&amp;quot;  lower( concat(a.function, concat(a.name,concat(a.note,to_char(a.crtdat,&amp;apos;yyyy-mm-dd&amp;apos;))))) like lower(&amp;apos;%&amp;quot;+str[i]+&amp;quot;%&amp;apos;)&amp;quot;; 
				}else{
					querywhere+=&amp;quot; and lower( concat(a.function, concat(a.name,concat( a.note,to_char(a.crtdat,&amp;apos;yyyy-mm-dd&amp;apos;))))) like lower(&amp;apos;%&amp;quot;+str[i]+&amp;quot;%&amp;apos;)&amp;quot;; 
				}
			} 
		querywhere+=&amp;quot;) &amp;quot;;
	category = &amp;quot;and decode(a.lang,null,&amp;apos; &amp;apos;,a.lang) like &amp;apos;&amp;quot;+apilang+&amp;quot;%&amp;apos;&amp;quot;+
			&amp;quot;and decode(a.flag,null,&amp;apos; &amp;apos;, a.flag) like &amp;apos;&amp;quot;+apiflag+&amp;quot;%&amp;apos;&amp;quot;;
			//&amp;quot;and decode(a.subtyp,null,&amp;apos; &amp;apos;, a.subtyp) like&amp;apos;&amp;quot;+apisubtyp+&amp;quot;%&amp;apos;&amp;quot;;
	try {
		db = new pubpack.EADatabase();	// 如果连接到其他数据库, new pubpack.EADatabase(“dbname”)
		var sql = &amp;quot;select * from (&amp;quot;;
				sql+=&amp;quot;SELECT b.ID,b.NAME||&amp;apos;(&amp;apos;||COUNT(*)||&amp;apos;)&amp;apos; NAME,b.GUID ,&amp;apos;&amp;quot;+
					url+&amp;quot;&amp;apisubtyp=&amp;apos;|| b.id  url &amp;quot;+
					&amp;quot;from FUNCLIST a , V_FUNCSUBTYP B, V_FUNCLANG c, V_FUNCFLAG d
					 where c.id(+) = a.lang
					   and d.id(+) = a.flag
					   AND B.ID(+) = A.SUBTYP &amp;quot;+
					category;
				
				sql+=&amp;quot; and &amp;quot;+querywhere;

				
				sql+=&amp;quot;GROUP BY b.ID,b.NAME,b.GUID &amp;quot;+
				&amp;quot;ORDER BY b.ID&amp;quot;;
		sql+=&amp;quot;) a&amp;quot;;
		sql+=&amp;quot; union &amp;quot;;
		sql+=&amp;quot;select &amp;apos;&amp;apos; id ,&amp;quot;+
                &amp;quot; &amp;apos;全部 &amp;apos; || &amp;apos;(&amp;apos; || COUNT(*) || &amp;apos;)&amp;apos; NAME , &amp;quot;+
                &amp;quot; &amp;apos;&amp;apos; guid, &amp;quot;+
                &amp;quot; &amp;apos;&amp;quot;+url+&amp;quot;&amp;apisubtyp=&amp;apos; url &amp;quot;+
		&amp;quot;from FUNCLIST a , V_FUNCSUBTYP B, V_FUNCLANG c, V_FUNCFLAG d
					 where c.id(+) = a.lang
					   and d.id(+) = a.flag
					   AND B.ID(+) = A.SUBTYP &amp;quot;+
		category;
           	sql+=&amp;quot; and &amp;quot;+querywhere;

		
		msg=msg+&amp;quot;&amp;lt;td valign=\&amp;quot;top\&amp;quot;&amp;gt;&amp;quot;+
		&amp;quot;&amp;lt;font color=\&amp;quot;#014E82\&amp;quot;&amp;gt;&amp;quot;+
		&amp;quot;&amp;lt;table width=\&amp;quot;100%\&amp;quot; align=\&amp;quot;left\&amp;quot; border=\&amp;quot;0\&amp;quot; cellpadding=\&amp;quot;1\&amp;quot;&amp;gt;&amp;quot;+
		&amp;quot;&amp;lt;tbody&amp;gt;&amp;quot;;//
		
		//throw new Exception(sql);
		var ds = db.QuerySQL(sql);
		for( var i=0 ;i&amp;lt;ds.getRowCount(); i++ ) {
			msg = msg+&amp;quot;&amp;lt;tr&amp;gt; &amp;lt;td width=100%  &amp;gt;&amp;lt;a href=&amp;apos;#&amp;apos; onclick=\&amp;quot;javascript:window.location=&amp;apos;&amp;quot;+ds.getStringAt(i,&amp;quot;url&amp;quot;)+&amp;quot;&amp;apos;;\&amp;quot;&amp;gt;&amp;quot;+ds.getStringAt(i,&amp;quot;name&amp;quot;)+&amp;quot;&amp;lt;/a&amp;gt;&amp;lt;/td&amp;gt;&amp;lt;/tr&amp;gt;&amp;quot;;
		}
		//msg = msg+&amp;quot;&amp;lt;tr&amp;gt; &amp;lt;td width=100%  &amp;gt;&amp;lt;a href=&amp;apos;#&amp;apos; onclick=\&amp;quot;javascript:window.location=&amp;apos;&amp;quot;+url+&amp;quot;&amp;trkprj=&amp;quot;+&amp;quot;&amp;apos;;\&amp;quot;&amp;gt;&amp;quot;+&amp;quot;全部&amp;quot;+&amp;quot;&amp;lt;/a&amp;gt;&amp;lt;/td&amp;gt;&amp;lt;/tr&amp;gt;&amp;quot;;//添加全部按钮
		msg=msg+&amp;quot;&amp;lt;/tbody&amp;gt;&amp;quot;+&amp;quot;&amp;lt;/table&amp;gt;&amp;quot;+&amp;quot;&amp;lt;/font&amp;gt;&amp;quot;+&amp;quot;&amp;lt;/td&amp;gt;&amp;quot;;
		
	}
	catch ( ee ) {
		db.Rollback();
		throw new pubpack.EAException ( ee.toString() );
	}
	finally {
		if (db!=null) db.Close();
	}
	return msg;//直接返回html语句

}
//显示搜索api的条件
function searchapiquery(){
	var db = null;
	db = new pubpack.EADatabase();
	var msg= &amp;quot;全部结果 &amp;lt;br&amp;gt; 关键字 \&amp;quot;&amp;quot;+query+&amp;quot;\&amp;quot; &amp;lt;/br&amp;gt;&amp;quot;;//是显示的html语句
	var sql=&amp;quot;&amp;quot;; 
	// 查找项目
		sql = &amp;quot;select &amp;apos;语言:&amp;apos;||b.name name from V_FUNCLANG b where b.id = &amp;apos;&amp;quot;+apilang+&amp;quot;&amp;apos;&amp;quot; ;
		var ds = db.QuerySQL(sql);
		if ( ds.getRowCount() &amp;gt; 0 ) {
			msg += ds.getStringAt(0,&amp;quot;name&amp;quot;)+&amp;quot;&amp;lt;BR&amp;gt;&amp;quot;;
		}
	// 查找创建人
		sql = &amp;quot;select &amp;apos;标志:&amp;apos;||b.name name  from V_FUNCFLAG b where b.id = &amp;apos;&amp;quot;+apiflag+&amp;quot;&amp;apos;&amp;quot; ;
		ds = db.QuerySQL(sql);
		if ( ds.getRowCount() &amp;gt; 0 ) {
			msg += ds.getStringAt(0,&amp;quot;name&amp;quot;)+&amp;quot;&amp;lt;BR&amp;gt;&amp;quot;;
		}
		
	// 查找事务类型
		sql = &amp;quot;select &amp;apos;类型:&amp;apos;||b.name||&amp;apos;&amp;lt;BR&amp;gt;说明:&amp;apos;||b.note||&amp;apos;&amp;lt;BR&amp;gt;&amp;apos; name from V_FUNCSUBTYP b where b.id = &amp;apos;&amp;quot;+apisubtyp+&amp;quot;&amp;apos;&amp;quot; ;
		ds = db.QuerySQL(sql);
		if ( ds.getRowCount() &amp;gt; 0 ) {
			msg += ds.getStringAt(0,&amp;quot;name&amp;quot;);
			//msg+=&amp;quot;&amp;lt;BR&amp;gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;lt;a href=&amp;apos;show.sp?grdid=HDRTRK&amp;style=&amp;quot;+trktyp+&amp;quot;&amp;edit=save&amp;dd=0&amp;prj=&amp;quot;+trkprj+&amp;quot;&amp;apos; target=\&amp;quot;_blank\&amp;quot;&amp;gt;新增事务&amp;gt;&amp;gt;&amp;lt;/a&amp;gt;&amp;quot;;
		}

	return msg;
}

//手机端快捷新增事务的列表
function wapNewTrklist(){
	//return &amp;quot;&amp;quot;;
	var db = null;
	var msg= &amp;quot;&amp;quot;;//是显示的html语句
	
	//var url=&amp;quot;Layout.sp?id=SearchAPI&amp;query=&amp;quot;+query+&amp;quot;&amp;quot;+&amp;quot;&amp;apilang=&amp;quot;+apilang+&amp;quot;&amp;apisubtyp=&amp;quot;+apisubtyp;//单击的链接

	var sql=&amp;quot;select name,url,id,guid from SYSURL where refid=&amp;apos;3A事务快速新增&amp;apos; order by seqid&amp;quot;;
	
	try{ 
		msg=msg+&amp;quot;&amp;lt;td valign=\&amp;quot;top\&amp;quot;&amp;gt;&amp;quot;+
		&amp;quot;&amp;lt;font color=\&amp;quot;#014E82\&amp;quot;&amp;gt;&amp;quot;+
		&amp;quot;&amp;lt;table width=\&amp;quot;100%\&amp;quot; align=\&amp;quot;left\&amp;quot; border=\&amp;quot;0\&amp;quot; cellpadding=\&amp;quot;1\&amp;quot;&amp;gt;&amp;quot;+
		&amp;quot;&amp;lt;tbody&amp;gt;&amp;quot;;
		
		db = new pubpack.EADatabase();
		var ds = db.QuerySQL(sql);
		for( var i=0 ;i&amp;lt;ds.getRowCount(); i++ ) {
			if(i!=0&amp;&amp;(i%2==&amp;quot;0&amp;quot;)){
				msg = msg+&amp;quot;&amp;lt;br&amp;gt;&amp;quot;;
			}
			msg = msg + &amp;quot;&amp;lt;a href=&amp;apos;&amp;quot;+ds.getStringAt(i,&amp;quot;url&amp;quot;)+&amp;quot;&amp;apos;&amp;gt;&amp;quot;+ds.getStringAt(i,&amp;quot;name&amp;quot;)+&amp;quot;&amp;lt;/a&amp;gt;&amp;quot;;
			msg += &amp;quot;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;quot;;
		}
		
		//msg = msg+&amp;quot;&amp;lt;tr&amp;gt; &amp;lt;td width=100%  &amp;gt;&amp;lt;a href=&amp;apos;#&amp;apos; onclick=\&amp;quot;javascript:window.location=&amp;apos;&amp;quot;+url+&amp;quot;&amp;trkprj=&amp;quot;+&amp;quot;&amp;apos;;\&amp;quot;&amp;gt;&amp;quot;+&amp;quot;全部&amp;quot;+&amp;quot;&amp;lt;/a&amp;gt;&amp;lt;/td&amp;gt;&amp;lt;/tr&amp;gt;&amp;quot;;//添加全部按钮
		msg=msg+&amp;quot;&amp;lt;/tbody&amp;gt;&amp;quot;+&amp;quot;&amp;lt;/table&amp;gt;&amp;quot;+&amp;quot;&amp;lt;/font&amp;gt;&amp;quot;+&amp;quot;&amp;lt;/td&amp;gt;&amp;quot;;
		
	}
	catch ( ee ) {
		db.Rollback();
		throw new pubpack.EAException ( ee.toString() );
	}
	finally {
		if (db!=null) db.Close();
	}
	return msg;//直接返回html语句

}



</GRDOSDS_VALUE></ROW>
</ROWSET>
</grdosds><grddscds>
<ROWSET>
<ROW num="0" ><ID >TODOTRK</ID><NAME >我的代办事务</NAME><DATDSC >select a.title|| &amp;apos; &amp;apos;||cc.name ||to_char(a.crtdat,&amp;apos;mm/dd hh24:mi&amp;apos;) name,substr(a.note,1,25) note ,
a.guid ,a.id,&amp;apos;Layout.sp?id=trkquery&amp;trkguid=&amp;apos;||a.guid url
 from  
trkhdr a,v_usr c ,trktyp e,v_usr cc
where 
a.dtlusr=c.id  and a.AIMORG=c.orgid and a.crtusr=cc.id  and a.AIMORG=cc.orgid 
and a.show =e.id
and c.id=lower(&amp;apos;[%SYS_USRID]&amp;apos;)   
and c.orgid=&amp;apos;[%SYS_ORGID]&amp;apos;
   
and a.stat&amp;lt;&amp;gt;&amp;apos;3&amp;apos; -- 0￡oD??¨￡?1￡o′|àí?D￡?2￡oò?′|àí￡?3￡o′|àííê￡?4￡o?′′|àí
and a.show not in (&amp;apos;4&amp;apos;)
and e.id not in (&amp;apos;4&amp;apos;,&amp;apos;5&amp;apos;,&amp;apos;6&amp;apos;,&amp;apos;7&amp;apos;,&amp;apos;8&amp;apos;,&amp;apos;9&amp;apos;,&amp;apos;10&amp;apos;,&amp;apos;16&amp;apos;,&amp;apos;17&amp;apos;) 
--and a.show like &amp;apos;[%trktyp]%&amp;apos;
--and a.project like &amp;apos;[%trkprj]%&amp;apos;
order by to_char(a.crtdat,&amp;apos;yyyy-mm-dd hh24:mi:ss&amp;apos;) desc </DATDSC><C4 >TODOTRK</C4><C5 ></C5><C6 ></C6><C7 ></C7><C8 ></C8><C9 ></C9><C10 ></C10><C11 ></C11><C12 ></C12><C13 ></C13><C14 ></C14><C15 ></C15><C16 ></C16><C17 ></C17><C18 ></C18><C19 ></C19><C20 ></C20><C21 >TODOTRK</C21><C22 ></C22><C23 ></C23><C24 ></C24><C25 ></C25><C26 ></C26><C27 ></C27><C28 ></C28><C29 ></C29><C30 ></C30><C31 ></C31><C32 ></C32><C33 ></C33><C34 ></C34><C35 ></C35><C36 ></C36><C37 ></C37><C38 ></C38><C39 ></C39><C40 ></C40><C41 >TODOTRK</C41><C42 ></C42><C43 ></C43><C44 ></C44><C45 ></C45><C46 ></C46><C47 ></C47><C48 ></C48><C49 ></C49><C50 >TODOTRK</C50><C51 ></C51><C52 >TODOTRK</C52><C53 ></C53><C54 ></C54><C55 ></C55><C56 ></C56><C57 >TODOTRK</C57><C58 >TODOTRK</C58><C59 >TODOTRK</C59><C60 >TODOTRK</C60><C61 >TODOTRK</C61><C62 ></C62><C63 ></C63><C64 ></C64><C65 ></C65><C66 >TODOTRK</C66><C67 ></C67><C68 ></C68><C69 >TODOTRK</C69><C70 >TODOTRK</C70><C71 >TODOTRK</C71><C72 >TODOTRK</C72><C73 >TODOTRK</C73><C74 >TODOTRK</C74><C75 >TODOTRK</C75><C76 ></C76><C77 ></C77><C78 ></C78><C79 ></C79><C80 ></C80><C81 ></C81><C82 >TODOTRK</C82><C83 >TODOTRK</C83><C84 ></C84><C85 ></C85><C86 ></C86><C87 ></C87><C88 ></C88><C89 ></C89><C90 >TODOTRK</C90><C91 >TODOTRK</C91><C92 ></C92><C93 ></C93><C94 ></C94><C95 ></C95><C96 >TODOTRK</C96><C97 >TODOTRK</C97></ROW>
<ROW num="1" ><ID >ALLTRK</ID><NAME >全部事务列表</NAME><DATDSC >select distinct &amp;apos;●&amp;apos; || a.title || &amp;apos; &amp;apos; || to_char(a.crtdat, &amp;apos;MM/DD&amp;apos;) ||
                        &amp;apos;    &amp;apos; || b.name name,
                        a.id,
                        a.guid,
                        &amp;apos;Layout.sp?id=trkquery&amp;trkguid=&amp;apos; || a.guid url,
                        a.crtdat
          from trkhdr a, usr b
         where b.id(+) = a.crtusr
           and a.show like &amp;apos;[%trktyp]%&amp;apos;
           and NVL(a.PROJECT, &amp;apos; &amp;apos;) like &amp;apos;[%trkprj]%&amp;apos;
           and NVL(a.crtusr, &amp;apos; &amp;apos;) like &amp;apos;[%trkusr]%&amp;apos;
         order by a.crtdat desc</DATDSC><C4 ></C4><C5 >ALLTRK</C5><C6 >ALLTRK</C6><C7 >ALLTRK</C7><C8 >ALLTRK</C8><C9 ></C9><C10 >ALLTRK</C10><C11 ></C11><C12 ></C12><C13 ></C13><C14 ></C14><C15 ></C15><C16 >ALLTRK</C16><C17 ></C17><C18 ></C18><C19 ></C19><C20 ></C20><C21 ></C21><C22 ></C22><C23 >ALLTRK</C23><C24 >ALLTRK</C24><C25 ></C25><C26 >ALLTRK</C26><C27 ></C27><C28 ></C28><C29 ></C29><C30 >ALLTRK</C30><C31 >ALLTRK</C31><C32 ></C32><C33 ></C33><C34 ></C34><C35 ></C35><C36 ></C36><C37 ></C37><C38 ></C38><C39 ></C39><C40 >ALLTRK</C40><C41 ></C41><C42 >ALLTRK</C42><C43 ></C43><C44 ></C44><C45 ></C45><C46 >ALLTRK</C46><C47 ></C47><C48 ></C48><C49 >ALLTRK</C49><C50 ></C50><C51 >ALLTRK</C51><C52 ></C52><C53 ></C53><C54 ></C54><C55 >ALLTRK</C55><C56 ></C56><C57 ></C57><C58 ></C58><C59 ></C59><C60 >ALLTRK</C60><C61 ></C61><C62 ></C62><C63 ></C63><C64 ></C64><C65 ></C65><C66 ></C66><C67 ></C67><C68 ></C68><C69 ></C69><C70 ></C70><C71 ></C71><C72 ></C72><C73 ></C73><C74 ></C74><C75 >ALLTRK</C75><C76 ></C76><C77 ></C77><C78 ></C78><C79 ></C79><C80 ></C80><C81 ></C81><C82 ></C82><C83 ></C83><C84 ></C84><C85 ></C85><C86 >ALLTRK</C86><C87 ></C87><C88 ></C88><C89 >ALLTRK</C89><C90 >ALLTRK</C90><C91 >ALLTRK</C91><C92 ></C92><C93 >ALLTRK</C93><C94 ></C94><C95 >ALLTRK</C95><C96 ></C96><C97 ></C97></ROW>
<ROW num="2" ><ID >MYCRTWORK</ID><NAME >我创建的事务</NAME><DATDSC >select a.title|| &amp;apos; &amp;apos;||to_char(a.crtdat,&amp;apos;mm/dd&amp;apos;)||&amp;apos; -&amp;gt;&amp;gt;&amp;apos;||c.name||&amp;apos;  &amp;apos;||d.name name,substr(a.note,1,25) note ,
a.guid ,a.id,&amp;apos;Layout.sp?id=trkquery&amp;trkguid=&amp;apos;||a.guid url
 from  
trkhdr a,v_usr c ,trktyp e,v_usr cc, v_trkstat d
where 
a.dtlusr=c.id  and a.AIMORG=c.orgid and a.crtusr=cc.id  and a.SELFORG=cc.orgid 
and a.stat=d.id
and cc.id=lower(&amp;apos;[%SYS_USRID]&amp;apos;)   
and cc.orgid=&amp;apos;[%SYS_ORGID]&amp;apos;
--and a.show like&amp;apos;[%trktyp]%&amp;apos;
--and a.project like&amp;apos;[%trkprj]%&amp;apos;
and a.show =e.id   
--and e.id not in (&amp;apos;5&amp;apos;,&amp;apos;6&amp;apos;,&amp;apos;7&amp;apos;,&amp;apos;8&amp;apos;,&amp;apos;9&amp;apos;,&amp;apos;10&amp;apos;,&amp;apos;16&amp;apos;,&amp;apos;17&amp;apos;) 
order by to_char(a.crtdat,&amp;apos;yyyy-mm-dd hh24:mi:ss&amp;apos;) desc 
</DATDSC><C4 ></C4><C5 ></C5><C6 ></C6><C7 ></C7><C8 >MYWORK</C8><C9 ></C9><C10 ></C10><C11 >MYWORK</C11><C12 ></C12><C13 ></C13><C14 ></C14><C15 >MYWORK</C15><C16 >MYWORK</C16><C17 ></C17><C18 ></C18><C19 ></C19><C20 ></C20><C21 ></C21><C22 ></C22><C23 ></C23><C24 ></C24><C25 ></C25><C26 ></C26><C27 ></C27><C28 ></C28><C29 ></C29><C30 >MYWORK</C30><C31 ></C31><C32 ></C32><C33 ></C33><C34 ></C34><C35 ></C35><C36 ></C36><C37 ></C37><C38 ></C38><C39 ></C39><C40 ></C40><C41 >MYCRTWORK</C41><C42 ></C42><C43 ></C43><C44 >MYCRTWORK</C44><C45 ></C45><C46 ></C46><C47 ></C47><C48 ></C48><C49 ></C49><C50 ></C50><C51 ></C51><C52 ></C52><C53 ></C53><C54 ></C54><C55 ></C55><C56 >MYCRTWORK</C56><C57 >MYCRTWORK</C57><C58 >MYCRTWORK</C58><C59 ></C59><C60 >MYCRTWORK</C60><C61 ></C61><C62 >MYCRTWORK</C62><C63 ></C63><C64 ></C64><C65 ></C65><C66 ></C66><C67 ></C67><C68 ></C68><C69 >MYCRTWORK</C69><C70 ></C70><C71 ></C71><C72 ></C72><C73 ></C73><C74 ></C74><C75 ></C75><C76 ></C76><C77 ></C77><C78 ></C78><C79 ></C79><C80 ></C80><C81 ></C81><C82 ></C82><C83 ></C83><C84 ></C84><C85 ></C85><C86 ></C86><C87 ></C87><C88 ></C88><C89 ></C89><C90 >MYCRTWORK</C90><C91 >MYCRTWORK</C91><C92 ></C92><C93 ></C93><C94 ></C94><C95 ></C95><C96 ></C96><C97 ></C97></ROW>
<ROW num="3" ><ID >TRK_TYPLIST</ID><NAME >按类型查询事务</NAME><DATDSC >SELECT a.id,&amp;apos; &amp;apos;||A.NAME||&amp;apos;(&amp;apos;||COUNT(*)||&amp;apos;)&amp;apos; NAME,A.GUID 
,&amp;apos;Layout.sp?id=trklist&amp;worktyp=&amp;trkusr=[%trkusr]&amp;trkprj=[%trkprj]&amp;trktyp=&amp;apos;|| A.id  url
FROM trktyp A,TRKHDR B 
WHERE B.SHOW(+)=A.ID and b.project(+) like &amp;apos;[%trkprj]%&amp;apos;
GROUP BY A.ID,A.NAME,A.GUID,A.SORTID
ORDER BY A.SORTID,A.ID</DATDSC><C4 ></C4><C5 ></C5><C6 ></C6><C7 ></C7><C8 ></C8><C9 ></C9><C10 >TRKTYPLIST</C10><C11 >TRKTYPLIST</C11><C12 >TRKTYPLIST</C12><C13 >TRKTYPLIST</C13><C14 >TRKTYPLIST</C14><C15 ></C15><C16 >TRKTYPLIST</C16><C17 >TRKTYPLIST</C17><C18 ></C18><C19 >TRKTYPLIST</C19><C20 >TRKTYPLIST</C20><C21 ></C21><C22 >TRKTYPLIST</C22><C23 ></C23><C24 ></C24><C25 >TRKTYPLIST</C25><C26 >TRKTYPLIST</C26><C27 >TRKTYPLIST</C27><C28 >TRKTYPLIST</C28><C29 >TRKTYPLIST</C29><C30 ></C30><C31 >TRKTYPLIST</C31><C32 ></C32><C33 ></C33><C34 ></C34><C35 ></C35><C36 >TRKTYPLIST</C36><C37 ></C37><C38 ></C38><C39 ></C39><C40 >TRKTYPLIST</C40><C41 ></C41><C42 ></C42><C43 ></C43><C44 ></C44><C45 ></C45><C46 ></C46><C47 >TRKTYPLIST</C47><C48 >TRKTYPLIST</C48><C49 ></C49><C50 ></C50><C51 ></C51><C52 ></C52><C53 >TRKTYPLIST</C53><C54 >TRK_TYPLIST</C54><C55 >TRK_TYPLIST</C55><C56 ></C56><C57 >TRK_TYPLIST</C57><C58 ></C58><C59 ></C59><C60 >TRK_TYPLIST</C60><C61 >TRK_TYPLIST</C61><C62 ></C62><C63 ></C63><C64 ></C64><C65 ></C65><C66 ></C66><C67 ></C67><C68 ></C68><C69 >TRK_TYPLIST</C69><C70 ></C70><C71 ></C71><C72 ></C72><C73 ></C73><C74 ></C74><C75 >TRK_TYPLIST</C75><C76 ></C76><C77 ></C77><C78 >TRK_TYPLIST</C78><C79 ></C79><C80 ></C80><C81 ></C81><C82 ></C82><C83 ></C83><C84 ></C84><C85 ></C85><C86 ></C86><C87 ></C87><C88 ></C88><C89 ></C89><C90 >TRK_TYPLIST</C90><C91 >TRK_TYPLIST</C91><C92 ></C92><C93 ></C93><C94 ></C94><C95 ></C95><C96 ></C96><C97 ></C97></ROW>
<ROW num="4" ><ID >TRK_LOG</ID><NAME >日志</NAME><DATDSC >select  distinct &amp;apos;&amp;apos;||a.usrnam ||&amp;apos;  &amp;apos;||to_char(a.crtdat,&amp;apos;mm/dd hh24:mi&amp;apos;)||&amp;apos;  &amp;apos;||a.action||substr(a.name,1,16)   name,
a.guid,a.usrid id,a.crtdat
,&amp;apos;Layout.sp?id=trkquery&amp;guid=&amp;apos;||a.bilid||&amp;apos;&amp;trkguid=&amp;apos;||a.bilid url
from OALOG a where mwtyp in( &amp;apos;TRKHDR&amp;apos;,&amp;apos;TRKDTL1&amp;apos;,&amp;apos;TRKDTL2&amp;apos;,&amp;apos;ENDTRK&amp;apos; )
order by crtdat desc</DATDSC><C4 ></C4><C5 ></C5><C6 ></C6><C7 ></C7><C8 ></C8><C9 ></C9><C10 ></C10><C11 ></C11><C12 ></C12><C13 ></C13><C14 ></C14><C15 >TRK_BYTYP</C15><C16 >TRK_LOG</C16><C17 >TRK_LOG</C17><C18 >TRK_LOG</C18><C19 >TRK_LOG</C19><C20 ></C20><C21 ></C21><C22 ></C22><C23 ></C23><C24 ></C24><C25 ></C25><C26 ></C26><C27 ></C27><C28 ></C28><C29 ></C29><C30 >TRK_LOG</C30><C31 ></C31><C32 ></C32><C33 ></C33><C34 ></C34><C35 ></C35><C36 ></C36><C37 ></C37><C38 ></C38><C39 ></C39><C40 ></C40><C41 >TRK_LOG</C41><C42 ></C42><C43 >TRK_LOG</C43><C44 ></C44><C45 >TRK_LOG</C45><C46 ></C46><C47 ></C47><C48 ></C48><C49 ></C49><C50 ></C50><C51 ></C51><C52 ></C52><C53 ></C53><C54 ></C54><C55 ></C55><C56 ></C56><C57 ></C57><C58 ></C58><C59 ></C59><C60 >TRK_LOG</C60><C61 ></C61><C62 ></C62><C63 >TRK_LOG</C63><C64 ></C64><C65 ></C65><C66 ></C66><C67 ></C67><C68 ></C68><C69 >TRK_LOG</C69><C70 >TRK_LOG</C70><C71 ></C71><C72 ></C72><C73 ></C73><C74 ></C74><C75 ></C75><C76 ></C76><C77 ></C77><C78 ></C78><C79 ></C79><C80 ></C80><C81 ></C81><C82 ></C82><C83 ></C83><C84 ></C84><C85 ></C85><C86 ></C86><C87 ></C87><C88 ></C88><C89 ></C89><C90 >TRK_LOG</C90><C91 >TRK_LOG</C91><C92 ></C92><C93 ></C93><C94 ></C94><C95 >TRK_LOG</C95><C96 ></C96><C97 ></C97></ROW>
<ROW num="5" ><ID >TRK_PRJLIST</ID><NAME >°′????2é?ˉ</NAME><DATDSC >SELECT A.ID,A.NAME||&amp;apos;(&amp;apos;||COUNT(*)||&amp;apos;)&amp;apos; NAME,A.GUID 
,&amp;apos;Layout.sp?id=trklist&amp;worktyp=&amp;trkusr=[%trkusr]&amp;trktyp=[%trktyp]&amp;trkprj=&amp;apos;|| A.id  url
FROM PRJ A,TRKHDR B 

WHERE B.PROJECT=A.ID AND B.SHOW LIKE &amp;apos;[%trktyp]%&amp;apos;
GROUP BY A.ID,A.NAME,A.GUID
ORDER BY A.ID</DATDSC><C4 ></C4><C5 ></C5><C6 ></C6><C7 ></C7><C8 ></C8><C9 ></C9><C10 ></C10><C11 ></C11><C12 ></C12><C13 ></C13><C14 ></C14><C15 ></C15><C16 ></C16><C17 ></C17><C18 ></C18><C19 ></C19><C20 ></C20><C21 ></C21><C22 ></C22><C23 ></C23><C24 ></C24><C25 ></C25><C26 ></C26><C27 ></C27><C28 ></C28><C29 >TRK_PRJLIST1</C29><C30 ></C30><C31 ></C31><C32 ></C32><C33 ></C33><C34 ></C34><C35 ></C35><C36 >TRK_PRJLIST1</C36><C37 >TRK_PRJLIST1</C37><C38 >TRK_PRJLIST1</C38><C39 >TRK_PRJLIST1</C39><C40 ></C40><C41 ></C41><C42 ></C42><C43 ></C43><C44 ></C44><C45 ></C45><C46 ></C46><C47 ></C47><C48 ></C48><C49 ></C49><C50 ></C50><C51 ></C51><C52 ></C52><C53 >TRK_PRJLIST1</C53><C54 >TRK_PRJLIST</C54><C55 >TRK_PRJLIST</C55><C56 ></C56><C57 >TRK_PRJLIST</C57><C58 ></C58><C59 ></C59><C60 >TRK_PRJLIST</C60><C61 >TRK_PRJLIST</C61><C62 ></C62><C63 ></C63><C64 ></C64><C65 ></C65><C66 ></C66><C67 ></C67><C68 ></C68><C69 >TRK_PRJLIST</C69><C70 ></C70><C71 ></C71><C72 ></C72><C73 >TRK_PRJLIST</C73><C74 ></C74><C75 ></C75><C76 ></C76><C77 ></C77><C78 ></C78><C79 ></C79><C80 ></C80><C81 ></C81><C82 ></C82><C83 ></C83><C84 ></C84><C85 ></C85><C86 ></C86><C87 ></C87><C88 ></C88><C89 ></C89><C90 ></C90><C91 >TRK_PRJLIST</C91><C92 ></C92><C93 ></C93><C94 ></C94><C95 ></C95><C96 ></C96><C97 ></C97></ROW>
<ROW num="6" ><ID >LOGINFO</ID><NAME >登录信息</NAME><DATDSC >select * from (
select b.name||&amp;apos; &amp;apos;||max(to_char(a.crtdat,&amp;apos;MM/DD HH24:MI&amp;apos;)) name,max(to_char(a.crtdat,&amp;apos;MM/DD HH24:MI&amp;apos;)) tim,b.id id,b.guid from usrlog a,usr b 
where  a.usrid=b.id and a.org=b.org and a.org=&amp;apos;[%SYS_ORGID]&amp;apos; and a.action=&amp;apos;μ????μí3&amp;apos; 
group by b.name,b.id,b.guid
) order by tim desc
</DATDSC><C4 ></C4><C5 ></C5><C6 ></C6><C7 ></C7><C8 ></C8><C9 ></C9><C10 ></C10><C11 ></C11><C12 ></C12><C13 ></C13><C14 ></C14><C15 ></C15><C16 ></C16><C17 ></C17><C18 ></C18><C19 ></C19><C20 ></C20><C21 ></C21><C22 ></C22><C23 ></C23><C24 ></C24><C25 ></C25><C26 ></C26><C27 ></C27><C28 ></C28><C29 ></C29><C30 ></C30><C31 ></C31><C32 ></C32><C33 ></C33><C34 ></C34><C35 ></C35><C36 ></C36><C37 ></C37><C38 ></C38><C39 ></C39><C40 ></C40><C41 ></C41><C42 ></C42><C43 ></C43><C44 ></C44><C45 ></C45><C46 ></C46><C47 ></C47><C48 ></C48><C49 ></C49><C50 ></C50><C51 ></C51><C52 ></C52><C53 ></C53><C54 ></C54><C55 ></C55><C56 ></C56><C57 ></C57><C58 ></C58><C59 ></C59><C60 >LOGINFO</C60><C61 ></C61><C62 ></C62><C63 ></C63><C64 ></C64><C65 ></C65><C66 ></C66><C67 ></C67><C68 ></C68><C69 ></C69><C70 ></C70><C71 ></C71><C72 ></C72><C73 ></C73><C74 ></C74><C75 ></C75><C76 ></C76><C77 ></C77><C78 ></C78><C79 >LOGINFO</C79><C80 ></C80><C81 ></C81><C82 ></C82><C83 ></C83><C84 ></C84><C85 ></C85><C86 ></C86><C87 ></C87><C88 ></C88><C89 ></C89><C90 >LOGINFO</C90><C91 >LOGINFO</C91><C92 ></C92><C93 ></C93><C94 ></C94><C95 ></C95><C96 ></C96><C97 ></C97></ROW>
<ROW num="7" ><ID >trkhdrlog</ID><NAME ></NAME><DATDSC >select  distinct &amp;apos;&amp;apos;||a.usrnam ||&amp;apos;  &amp;apos;||to_char(a.crtdat,&amp;apos;mm/dd hh24:mi&amp;apos;)||&amp;apos;&amp;lt;BR&amp;gt;  &amp;apos;||a.action||&amp;apos;&amp;lt;BR&amp;gt;&amp;apos;   name,
a.guid,a.usrid id,a.crtdat
,&amp;apos;Layout.sp?id=trkquery&amp;guid=&amp;apos;||a.bilid||&amp;apos;&amp;trkguid=&amp;apos;||a.bilid url
from OALOG a where mwtyp in(&amp;apos;READ&amp;apos;,&amp;apos;ENDTRK&amp;apos;,&amp;apos;DELTRKHDR&amp;apos;,&amp;apos;DELTRKDTL1&amp;apos;,&amp;apos;DELTRKDTL2&amp;apos;) and bilid=&amp;apos;[%trkguid]&amp;apos;
order by crtdat desc</DATDSC><C4 ></C4><C5 ></C5><C6 ></C6><C7 ></C7><C8 ></C8><C9 ></C9><C10 ></C10><C11 ></C11><C12 ></C12><C13 ></C13><C14 ></C14><C15 ></C15><C16 ></C16><C17 ></C17><C18 ></C18><C19 ></C19><C20 ></C20><C21 ></C21><C22 ></C22><C23 ></C23><C24 ></C24><C25 ></C25><C26 ></C26><C27 ></C27><C28 ></C28><C29 ></C29><C30 ></C30><C31 ></C31><C32 ></C32><C33 ></C33><C34 ></C34><C35 ></C35><C36 ></C36><C37 ></C37><C38 ></C38><C39 ></C39><C40 ></C40><C41 ></C41><C42 ></C42><C43 ></C43><C44 ></C44><C45 ></C45><C46 ></C46><C47 ></C47><C48 ></C48><C49 ></C49><C50 ></C50><C51 ></C51><C52 ></C52><C53 ></C53><C54 ></C54><C55 ></C55><C56 ></C56><C57 ></C57><C58 ></C58><C59 ></C59><C60 >trkhdrlog</C60><C61 ></C61><C62 ></C62><C63 ></C63><C64 ></C64><C65 ></C65><C66 ></C66><C67 ></C67><C68 ></C68><C69 ></C69><C70 ></C70><C71 ></C71><C72 ></C72><C73 ></C73><C74 ></C74><C75 ></C75><C76 ></C76><C77 ></C77><C78 ></C78><C79 >trkhdrlog</C79><C80 ></C80><C81 ></C81><C82 ></C82><C83 ></C83><C84 ></C84><C85 ></C85><C86 ></C86><C87 ></C87><C88 ></C88><C89 ></C89><C90 ></C90><C91 >trkhdrlog</C91><C92 ></C92><C93 ></C93><C94 ></C94><C95 ></C95><C96 ></C96><C97 ></C97></ROW>
<ROW num="8" ><ID >TODOTRKWAP</ID><NAME >手机端我的代办事务</NAME><DATDSC >select &amp;apos;●&amp;apos;||a.title|| &amp;apos;(&amp;apos;||cc.name||&amp;apos;)&amp;apos; name,substr(a.note,1,25) note ,
a.guid ,a.id,&amp;apos;Layout.sp?id=trkquery&amp;trkguid=&amp;apos;||a.guid url
 from  
trkhdr a,v_usr c ,trktyp e,v_usr cc
where 
a.dtlusr=c.id  and a.AIMORG=c.orgid and a.crtusr=cc.id  and a.AIMORG=cc.orgid 
and c.id=lower(&amp;apos;[%SYS_USRID]&amp;apos;)   
and c.orgid=&amp;apos;[%SYS_ORGID]&amp;apos;
and a.show =e.id   
and a.stat&amp;lt;&amp;gt;&amp;apos;3&amp;apos; -- 0￡oD??¨￡?1￡o′|àí?D￡?2￡oò?′|àí￡?3￡o′|àííê￡?4￡o?′′|àí
and e.id not in (&amp;apos;4&amp;apos;,&amp;apos;5&amp;apos;,&amp;apos;6&amp;apos;,&amp;apos;7&amp;apos;,&amp;apos;8&amp;apos;,&amp;apos;9&amp;apos;,&amp;apos;10&amp;apos;,&amp;apos;16&amp;apos;,&amp;apos;17&amp;apos;) 
order by to_char(a.crtdat,&amp;apos;yyyy-mm-dd hh24:mi:ss&amp;apos;) desc </DATDSC><C4 ></C4><C5 ></C5><C6 ></C6><C7 ></C7><C8 ></C8><C9 ></C9><C10 ></C10><C11 ></C11><C12 ></C12><C13 ></C13><C14 ></C14><C15 ></C15><C16 ></C16><C17 ></C17><C18 ></C18><C19 ></C19><C20 ></C20><C21 ></C21><C22 ></C22><C23 ></C23><C24 ></C24><C25 ></C25><C26 ></C26><C27 ></C27><C28 ></C28><C29 ></C29><C30 ></C30><C31 ></C31><C32 ></C32><C33 ></C33><C34 ></C34><C35 ></C35><C36 ></C36><C37 ></C37><C38 ></C38><C39 ></C39><C40 ></C40><C41 ></C41><C42 ></C42><C43 ></C43><C44 ></C44><C45 ></C45><C46 ></C46><C47 ></C47><C48 ></C48><C49 ></C49><C50 ></C50><C51 ></C51><C52 ></C52><C53 ></C53><C54 ></C54><C55 ></C55><C56 ></C56><C57 ></C57><C58 ></C58><C59 ></C59><C60 ></C60><C61 ></C61><C62 ></C62><C63 ></C63><C64 ></C64><C65 ></C65><C66 ></C66><C67 ></C67><C68 >TODOTRKWAP</C68><C69 >TODOTRKWAP</C69><C70 ></C70><C71 ></C71><C72 ></C72><C73 ></C73><C74 >TODOTRKWAP</C74><C75 ></C75><C76 ></C76><C77 ></C77><C78 ></C78><C79 ></C79><C80 ></C80><C81 ></C81><C82 ></C82><C83 ></C83><C84 ></C84><C85 ></C85><C86 ></C86><C87 ></C87><C88 ></C88><C89 ></C89><C90 >TODOTRKWAP</C90><C91 >TODOTRKWAP</C91><C92 ></C92><C93 ></C93><C94 ></C94><C95 >TODOTRKWAP</C95><C96 ></C96><C97 >TODOTRKWAP</C97></ROW>
<ROW num="9" ><ID >TRK_USRLIST</ID><NAME >按人员分类列表</NAME><DATDSC >SELECT A.ID,A.NAME||&amp;apos;(&amp;apos;||COUNT(*)||&amp;apos;)&amp;apos; NAME,max(A.GUID ) guid
,&amp;apos;Layout.sp?id=trkLIST&amp;worktyp=&amp;trkprj=[%trkprj]&amp;trktyp=[%trktyp]&amp;trkusr=&amp;apos;|| A.id  url
FROM v_USR9 A,TRKHDR B 

WHERE B.CRTUSR=A.ID AND B.SHOW LIKE &amp;apos;[%trktyp]%&amp;apos;and b.PROJECT like &amp;apos;[%trkprj]%&amp;apos; 
GROUP BY A.ID,A.NAME/*,A.GUID*/
ORDER BY A.ID</DATDSC><C4 ></C4><C5 ></C5><C6 ></C6><C7 ></C7><C8 ></C8><C9 ></C9><C10 ></C10><C11 ></C11><C12 ></C12><C13 ></C13><C14 ></C14><C15 ></C15><C16 ></C16><C17 ></C17><C18 ></C18><C19 ></C19><C20 ></C20><C21 ></C21><C22 ></C22><C23 ></C23><C24 ></C24><C25 ></C25><C26 ></C26><C27 ></C27><C28 ></C28><C29 ></C29><C30 ></C30><C31 ></C31><C32 ></C32><C33 ></C33><C34 ></C34><C35 ></C35><C36 ></C36><C37 ></C37><C38 ></C38><C39 ></C39><C40 ></C40><C41 ></C41><C42 ></C42><C43 ></C43><C44 ></C44><C45 ></C45><C46 ></C46><C47 ></C47><C48 ></C48><C49 ></C49><C50 ></C50><C51 ></C51><C52 ></C52><C53 >TRK_USRLIST</C53><C54 >TRK_USRLIST</C54><C55 >TRK_USRLIST</C55><C56 ></C56><C57 >TRK_USRLIST</C57><C58 ></C58><C59 ></C59><C60 >TRK_USRLIST</C60><C61 >TRK_USRLIST</C61><C62 ></C62><C63 ></C63><C64 ></C64><C65 ></C65><C66 ></C66><C67 ></C67><C68 ></C68><C69 ></C69><C70 ></C70><C71 ></C71><C72 ></C72><C73 ></C73><C74 ></C74><C75 >TRK_USRLIST</C75><C76 ></C76><C77 ></C77><C78 ></C78><C79 ></C79><C80 >TRK_USRLIST</C80><C81 >TRK_USRLIST</C81><C82 ></C82><C83 ></C83><C84 ></C84><C85 ></C85><C86 ></C86><C87 ></C87><C88 ></C88><C89 ></C89><C90 >TRK_USRLIST</C90><C91 >TRK_USRLIST</C91><C92 ></C92><C93 ></C93><C94 ></C94><C95 ></C95><C96 ></C96><C97 ></C97></ROW>
<ROW num="10" ><ID >TODOTRKMORE</ID><NAME >代办事务更多</NAME><DATDSC >select a.title|| &amp;apos; &amp;apos;||cc.name ||to_char(a.crtdat,&amp;apos;mm/dd hh24:mi&amp;apos;) name,substr(a.note,1,25) note ,
a.guid ,a.id,&amp;apos;Layout.sp?id=trkquery&amp;trkguid=&amp;apos;||a.guid url
 from  
trkhdr a,v_usr c ,trktyp e,v_usr cc
where 
a.dtlusr=c.id  and a.AIMORG=c.orgid and a.crtusr=cc.id  and a.AIMORG=cc.orgid 
and a.show =e.id
and c.id=lower(&amp;apos;[%SYS_USRID]&amp;apos;)   
and c.orgid=&amp;apos;[%SYS_ORGID]&amp;apos;
   
and a.stat&amp;lt;&amp;gt;&amp;apos;3&amp;apos; -- 0￡oD??¨￡?1￡o′|àí?D￡?2￡oò?′|àí￡?3￡o′|àííê￡?4￡o?′′|àí
and e.id not in (&amp;apos;5&amp;apos;,&amp;apos;6&amp;apos;,&amp;apos;7&amp;apos;,&amp;apos;8&amp;apos;,&amp;apos;9&amp;apos;,&amp;apos;10&amp;apos;,&amp;apos;16&amp;apos;,&amp;apos;17&amp;apos;) 
and a.show like &amp;apos;[%trktyp]%&amp;apos;
and a.project like &amp;apos;[%trkprj]%&amp;apos;
order by to_char(a.crtdat,&amp;apos;yyyy-mm-dd hh24:mi:ss&amp;apos;) desc </DATDSC><C4 ></C4><C5 ></C5><C6 ></C6><C7 ></C7><C8 ></C8><C9 ></C9><C10 ></C10><C11 ></C11><C12 ></C12><C13 ></C13><C14 ></C14><C15 ></C15><C16 ></C16><C17 ></C17><C18 ></C18><C19 ></C19><C20 ></C20><C21 ></C21><C22 ></C22><C23 ></C23><C24 ></C24><C25 ></C25><C26 ></C26><C27 ></C27><C28 ></C28><C29 ></C29><C30 ></C30><C31 ></C31><C32 ></C32><C33 ></C33><C34 ></C34><C35 ></C35><C36 ></C36><C37 ></C37><C38 ></C38><C39 ></C39><C40 ></C40><C41 ></C41><C42 ></C42><C43 ></C43><C44 ></C44><C45 ></C45><C46 ></C46><C47 ></C47><C48 ></C48><C49 ></C49><C50 ></C50><C51 ></C51><C52 ></C52><C53 ></C53><C54 ></C54><C55 ></C55><C56 ></C56><C57 ></C57><C58 ></C58><C59 ></C59><C60 >TODOTRKMORE</C60><C61 ></C61><C62 ></C62><C63 ></C63><C64 >TODOTRKMORE</C64><C65 ></C65><C66 ></C66><C67 ></C67><C68 ></C68><C69 ></C69><C70 ></C70><C71 ></C71><C72 ></C72><C73 ></C73><C74 ></C74><C75 >TODOTRKMORE</C75><C76 >TODOTRKMORE</C76><C77 ></C77><C78 ></C78><C79 ></C79><C80 ></C80><C81 ></C81><C82 ></C82><C83 ></C83><C84 ></C84><C85 ></C85><C86 ></C86><C87 ></C87><C88 ></C88><C89 ></C89><C90 >TODOTRKMORE</C90><C91 >TODOTRKMORE</C91><C92 ></C92><C93 ></C93><C94 ></C94><C95 ></C95><C96 ></C96><C97 ></C97></ROW>
<ROW num="11" ><ID >CusModify</ID><NAME ></NAME><DATDSC >select a.name||&amp;apos;(&amp;apos;||case a.stat 
       when &amp;apos;1&amp;apos; then &amp;apos;D?????è?&amp;apos;
  when &amp;apos;2&amp;apos; then &amp;apos;Dè?óè・è?&amp;apos;
  when &amp;apos;3&amp;apos; then &amp;apos;éè??íê3é&amp;apos;
  when &amp;apos;4&amp;apos; then &amp;apos;?a・￠íê3é&amp;apos;
  when &amp;apos;5&amp;apos; then &amp;apos;2aê?í¨1y&amp;apos;
  when &amp;apos;6&amp;apos; then &amp;apos;2ù×÷ê?2áò?ìá??&amp;apos;
  when &amp;apos;7&amp;apos; then &amp;apos;?à?μíê±?&amp;apos;
  when &amp;apos;8&amp;apos; then &amp;apos;êμê?íê±?&amp;apos;
  when &amp;apos;9&amp;apos; then &amp;apos;????è???&amp;apos;
    end||&amp;apos;)&amp;apos; ||to_char(a.crtdat,&amp;apos;mm/dd hh24:mi&amp;apos;) name,substr(a.note,1,25) note ,
a.guid ,&amp;apos;ShowXlsGrid.sp?grdid=TRK_SAMODIFY&amp;guid=&amp;apos;||a.guid url ,
bilid id
 from  
  TRK_SAMODIFY A
where 
crtusr like&amp;apos;[%SYS_USRID]%&amp;apos;
order by a.crtdat desc</DATDSC><C4 ></C4><C5 ></C5><C6 ></C6><C7 ></C7><C8 ></C8><C9 ></C9><C10 ></C10><C11 ></C11><C12 ></C12><C13 ></C13><C14 ></C14><C15 ></C15><C16 ></C16><C17 ></C17><C18 ></C18><C19 ></C19><C20 ></C20><C21 ></C21><C22 ></C22><C23 ></C23><C24 ></C24><C25 ></C25><C26 ></C26><C27 ></C27><C28 ></C28><C29 ></C29><C30 ></C30><C31 ></C31><C32 ></C32><C33 ></C33><C34 ></C34><C35 ></C35><C36 ></C36><C37 ></C37><C38 ></C38><C39 ></C39><C40 ></C40><C41 ></C41><C42 ></C42><C43 ></C43><C44 ></C44><C45 ></C45><C46 ></C46><C47 ></C47><C48 ></C48><C49 ></C49><C50 ></C50><C51 ></C51><C52 ></C52><C53 ></C53><C54 ></C54><C55 ></C55><C56 ></C56><C57 ></C57><C58 ></C58><C59 ></C59><C60 ></C60><C61 ></C61><C62 ></C62><C63 ></C63><C64 ></C64><C65 >CusModify</C65><C66 >CusModify</C66><C67 >CusModify</C67><C68 ></C68><C69 ></C69><C70 ></C70><C71 ></C71><C72 ></C72><C73 ></C73><C74 >CusModify</C74><C75 ></C75><C76 ></C76><C77 ></C77><C78 ></C78><C79 ></C79><C80 ></C80><C81 ></C81><C82 ></C82><C83 ></C83><C84 ></C84><C85 ></C85><C86 ></C86><C87 ></C87><C88 ></C88><C89 ></C89><C90 >CusModify</C90><C91 >CusModify</C91><C92 ></C92><C93 ></C93><C94 ></C94><C95 ></C95><C96 ></C96><C97 ></C97></ROW>
<ROW num="12" ><ID >MYCRTWORKWAP</ID><NAME >手机端我创建的事务</NAME><DATDSC >select &amp;apos;●&amp;apos;||a.title|| to_char(a.crtdat,&amp;apos;mm/dd&amp;apos;)||&amp;apos;-&amp;gt;&amp;gt;&amp;apos;||c.name||&amp;apos;   &amp;apos;||d.name name,substr(a.note,1,25) note ,
a.guid ,a.id,&amp;apos;Layout.sp?id=trkquery&amp;trkguid=&amp;apos;||a.guid url
 from  
trkhdr a,v_usr c ,trktyp e,v_usr cc, v_trkstat d
where 
a.dtlusr=c.id  and a.AIMORG=c.orgid and a.crtusr=cc.id  and a.SELFORG=cc.orgid 
and a.stat=d.id
and cc.id=lower(&amp;apos;[%SYS_USRID]&amp;apos;)   
and cc.orgid=&amp;apos;[%SYS_ORGID]&amp;apos;
--and a.show like&amp;apos;[%trktyp]%&amp;apos;
--and a.project like&amp;apos;[%trkprj]%&amp;apos;
and a.show =e.id   
--and e.id not in (&amp;apos;5&amp;apos;,&amp;apos;6&amp;apos;,&amp;apos;7&amp;apos;,&amp;apos;8&amp;apos;,&amp;apos;9&amp;apos;,&amp;apos;10&amp;apos;,&amp;apos;16&amp;apos;,&amp;apos;17&amp;apos;) 
order by to_char(a.crtdat,&amp;apos;yyyy-mm-dd hh24:mi:ss&amp;apos;) desc </DATDSC><C4 ></C4><C5 ></C5><C6 ></C6><C7 ></C7><C8 ></C8><C9 ></C9><C10 ></C10><C11 ></C11><C12 ></C12><C13 ></C13><C14 ></C14><C15 ></C15><C16 ></C16><C17 ></C17><C18 ></C18><C19 ></C19><C20 ></C20><C21 ></C21><C22 ></C22><C23 ></C23><C24 ></C24><C25 ></C25><C26 ></C26><C27 ></C27><C28 ></C28><C29 ></C29><C30 ></C30><C31 ></C31><C32 ></C32><C33 ></C33><C34 ></C34><C35 ></C35><C36 ></C36><C37 ></C37><C38 ></C38><C39 ></C39><C40 ></C40><C41 ></C41><C42 ></C42><C43 ></C43><C44 ></C44><C45 ></C45><C46 ></C46><C47 ></C47><C48 ></C48><C49 ></C49><C50 ></C50><C51 ></C51><C52 ></C52><C53 ></C53><C54 ></C54><C55 ></C55><C56 ></C56><C57 ></C57><C58 ></C58><C59 ></C59><C60 ></C60><C61 ></C61><C62 ></C62><C63 ></C63><C64 ></C64><C65 ></C65><C66 ></C66><C67 ></C67><C68 ></C68><C69 >MYCRTWORKWAP</C69><C70 ></C70><C71 ></C71><C72 ></C72><C73 ></C73><C74 >MYCRTWORKWAP</C74><C75 >MYCRTWORKWAP</C75><C76 ></C76><C77 ></C77><C78 ></C78><C79 ></C79><C80 ></C80><C81 ></C81><C82 ></C82><C83 ></C83><C84 ></C84><C85 ></C85><C86 ></C86><C87 ></C87><C88 ></C88><C89 ></C89><C90 >MYCRTWORKWAP</C90><C91 ></C91><C92 ></C92><C93 ></C93><C94 >MYCRTWORKWAP</C94><C95 ></C95><C96 >MYCRTWORKWAP</C96><C97 ></C97></ROW>
<ROW num="13" ><ID >WAPshortcut</ID><NAME >WAP?ì?ùD???</NAME><DATDSC >select  distinct  NAME  name,
a.guid,&amp;apos;&amp;apos; id,a.crtdat
,&amp;apos;Layout.sp?id=hdrtrk&amp;crtusr=[%SYS_USRID]&amp;apos; url
from SYSURL a where REFID like&amp;apos;%3A事务快速新增%&amp;apos;</DATDSC><C4 ></C4><C5 ></C5><C6 ></C6><C7 ></C7><C8 ></C8><C9 ></C9><C10 ></C10><C11 ></C11><C12 ></C12><C13 ></C13><C14 ></C14><C15 ></C15><C16 ></C16><C17 ></C17><C18 ></C18><C19 ></C19><C20 ></C20><C21 ></C21><C22 ></C22><C23 ></C23><C24 ></C24><C25 ></C25><C26 ></C26><C27 ></C27><C28 ></C28><C29 ></C29><C30 ></C30><C31 ></C31><C32 ></C32><C33 ></C33><C34 ></C34><C35 ></C35><C36 ></C36><C37 ></C37><C38 ></C38><C39 ></C39><C40 ></C40><C41 ></C41><C42 ></C42><C43 ></C43><C44 ></C44><C45 ></C45><C46 ></C46><C47 ></C47><C48 ></C48><C49 ></C49><C50 ></C50><C51 ></C51><C52 ></C52><C53 ></C53><C54 ></C54><C55 ></C55><C56 ></C56><C57 ></C57><C58 ></C58><C59 ></C59><C60 ></C60><C61 ></C61><C62 ></C62><C63 ></C63><C64 ></C64><C65 ></C65><C66 ></C66><C67 ></C67><C68 ></C68><C69 ></C69><C70 >WAPshortcut</C70><C71 >WAPshortcut</C71><C72 ></C72><C73 ></C73><C74 >WAPshortcut</C74><C75 ></C75><C76 ></C76><C77 ></C77><C78 ></C78><C79 ></C79><C80 ></C80><C81 ></C81><C82 ></C82><C83 ></C83><C84 ></C84><C85 ></C85><C86 ></C86><C87 ></C87><C88 ></C88><C89 ></C89><C90 >WAPshortcut</C90><C91 >WAPshortcut</C91><C92 ></C92><C93 ></C93><C94 >WAPshortcut</C94><C95 ></C95><C96 ></C96><C97 ></C97></ROW>
<ROW num="14" ><ID >NOTICE</ID><NAME >通知</NAME><DATDSC >select &amp;apos;■&amp;apos;||a.title|| &amp;apos; &amp;apos;||cc.name ||to_char(a.crtdat,&amp;apos;mm/dd hh24:mi&amp;apos;) name,substr(a.note,1,25) note ,
a.guid ,a.id,&amp;apos;Layout.sp?id=trkquery&amp;trkguid=&amp;apos;||a.guid url
 from  
trkhdr a,v_usr c ,trktyp e,v_usr cc
where 
a.dtlusr=c.id  and a.AIMORG=c.orgid and a.crtusr=cc.id  and a.AIMORG=cc.orgid 
and a.show =e.id
and c.id=lower(&amp;apos;[%SYS_USRID]&amp;apos;)   
and c.orgid=&amp;apos;[%SYS_ORGID]&amp;apos;
   
and a.stat&amp;lt;&amp;gt;&amp;apos;3&amp;apos; -- 0￡oD??¨￡?1￡o′|àí?D￡?2￡oò?′|àí￡?3￡o′|àííê￡?4￡o?′′|àí
and e.id =&amp;apos;4&amp;apos;
--and a.show like &amp;apos;[%trktyp]%&amp;apos;
--and a.project like &amp;apos;[%trkprj]%&amp;apos;
order by to_char(a.crtdat,&amp;apos;yyyy-mm-dd hh24:mi:ss&amp;apos;) desc </DATDSC><C4 ></C4><C5 ></C5><C6 ></C6><C7 ></C7><C8 ></C8><C9 ></C9><C10 ></C10><C11 ></C11><C12 ></C12><C13 ></C13><C14 ></C14><C15 ></C15><C16 ></C16><C17 ></C17><C18 ></C18><C19 ></C19><C20 ></C20><C21 ></C21><C22 ></C22><C23 ></C23><C24 ></C24><C25 ></C25><C26 ></C26><C27 ></C27><C28 ></C28><C29 ></C29><C30 ></C30><C31 ></C31><C32 ></C32><C33 ></C33><C34 ></C34><C35 ></C35><C36 ></C36><C37 ></C37><C38 ></C38><C39 ></C39><C40 ></C40><C41 ></C41><C42 ></C42><C43 ></C43><C44 ></C44><C45 ></C45><C46 ></C46><C47 ></C47><C48 ></C48><C49 ></C49><C50 ></C50><C51 ></C51><C52 ></C52><C53 ></C53><C54 ></C54><C55 ></C55><C56 ></C56><C57 ></C57><C58 ></C58><C59 ></C59><C60 ></C60><C61 ></C61><C62 ></C62><C63 ></C63><C64 ></C64><C65 ></C65><C66 ></C66><C67 ></C67><C68 ></C68><C69 ></C69><C70 ></C70><C71 ></C71><C72 ></C72><C73 ></C73><C74 ></C74><C75 ></C75><C76 ></C76><C77 ></C77><C78 ></C78><C79 ></C79><C80 ></C80><C81 ></C81><C82 ></C82><C83 >NOTICE</C83><C84 ></C84><C85 ></C85><C86 >NOTICE</C86><C87 >NOTICE</C87><C88 ></C88><C89 ></C89><C90 >NOTICE</C90><C91 ></C91><C92 ></C92><C93 ></C93><C94 ></C94><C95 >NOTICE</C95><C96 >NOTICE</C96><C97 ></C97></ROW>
<ROW num="15" ><ID >workDally</ID><NAME >手机端日报显示</NAME><DATDSC >select distinct &amp;apos;●&amp;apos;|| b.name  || a.title || &amp;apos;(&amp;apos; ||to_char(a.crtdat,&amp;apos;mm/dd&amp;apos;)||
                        &amp;apos;)&amp;apos; name,
                        a.id,
                        a.guid,
                        &amp;apos;Layout.sp?id=trkquery&amp;trkguid=&amp;apos; || a.guid url,
                        a.crtdat
          from trkhdr a, usr b
         where b.id(+) = a.crtusr
           and a.show = &amp;apos;7&amp;apos;
         order by a.crtdat desc
</DATDSC><C4 ></C4><C5 ></C5><C6 ></C6><C7 ></C7><C8 ></C8><C9 ></C9><C10 ></C10><C11 ></C11><C12 ></C12><C13 ></C13><C14 ></C14><C15 ></C15><C16 ></C16><C17 ></C17><C18 ></C18><C19 ></C19><C20 ></C20><C21 ></C21><C22 ></C22><C23 ></C23><C24 ></C24><C25 ></C25><C26 ></C26><C27 ></C27><C28 ></C28><C29 ></C29><C30 ></C30><C31 ></C31><C32 ></C32><C33 ></C33><C34 ></C34><C35 ></C35><C36 ></C36><C37 ></C37><C38 ></C38><C39 ></C39><C40 ></C40><C41 ></C41><C42 ></C42><C43 ></C43><C44 ></C44><C45 ></C45><C46 ></C46><C47 ></C47><C48 ></C48><C49 ></C49><C50 ></C50><C51 ></C51><C52 ></C52><C53 ></C53><C54 ></C54><C55 ></C55><C56 ></C56><C57 ></C57><C58 ></C58><C59 ></C59><C60 ></C60><C61 ></C61><C62 ></C62><C63 ></C63><C64 ></C64><C65 ></C65><C66 ></C66><C67 ></C67><C68 ></C68><C69 ></C69><C70 ></C70><C71 ></C71><C72 ></C72><C73 ></C73><C74 ></C74><C75 ></C75><C76 ></C76><C77 ></C77><C78 ></C78><C79 ></C79><C80 ></C80><C81 ></C81><C82 ></C82><C83 ></C83><C84 ></C84><C85 ></C85><C86 ></C86><C87 ></C87><C88 ></C88><C89 ></C89><C90 ></C90><C91 ></C91><C92 ></C92><C93 ></C93><C94 ></C94><C95 >workDally</C95><C96 >workDally</C96><C97 ></C97></ROW>
</ROWSET>
</grddscds><fldhdr>
<ROWSET>
<ROW num="0" ><BILID >1μ￥?Y±ào?</BILID><STAT >0μ￥?Y×′ì?</STAT><SUBTYP >0×óààDí</SUBTYP><CORPID >0íùà′μ￥??±ào?</CORPID><CORPNAM >0íùà′μ￥????3?</CORPNAM><LOCID >02??a|2???±ào?</LOCID><LOCNAM >02??a|2?????3?</LOCNAM><DAT >0μ￥?Yè??ú</DAT><CRTUSR >1??è?è?</CRTUSR><CRTUSRNAM >0??è?è?D???</CRTUSRNAM><CRTDAT >0??è?è??ú</CRTDAT><CHKUSR >1éóo?è?</CHKUSR><CHKUSRNAM >0éóo?è?D???</CHKUSRNAM><CHKDAT >0éóo?è??ú</CHKDAT><SUMQTY >0o????e??</SUMQTY><SUMMNY >0o????e??</SUMMNY><REFID1 >0à??1×???</REFID1><REFNAM1 >0à??1×???</REFNAM1><REFID2 >0à??1×???</REFID2><REFNAM2 >0à??1×???</REFNAM2><REFID3 >0à??1×???</REFID3><REFNAM3 >0à??1×???</REFNAM3><REFID4 >0à??1×???</REFID4><REFNAM4 >0à??1×???</REFNAM4><REFID5 >0à??1×???</REFID5><REFNAM5 >0à??1×???</REFNAM5><REFID6 >0à??1×???</REFID6><REFNAM6 >0à??1×???</REFNAM6><NOTE >0±?×￠</NOTE></ROW>
</ROWSET>
</fldhdr><flddtl>
<ROWSET>
<ROW num="0" ><SEQID >1?÷??Dòo?</SEQID><ITMID >1?・??±ào?</ITMID><ITMNAM >0?・????3?</ITMNAM><ITEMPC >0?・???ú′?o?</ITEMPC><ITMSPC >01???</ITMSPC><UNIT >0??á?μ￥??</UNIT><SMLUNT >0D???á?μ￥??</SMLUNT><UNTNUM >0′óμ￥??×aD?μ￥??òò×ó</UNTNUM><PRICE >0????</PRICE><QTY >0êyá?</QTY><TAXTYP >0?°?êààDí</TAXTYP><NOTAXMNY >02?o??°?°??</NOTAXMNY><TAXMNY >0?°??</TAXMNY><MNY >0??μ￥?e??</MNY><REFID1 >0à??1×???</REFID1><REFNAM1 >0à??1×???</REFNAM1><REFID2 >0à??1×???</REFID2><REFNAM2 >0à??1×???</REFNAM2><REFID3 >0à??1×???</REFID3><REFNAM3 >0à??1×???</REFNAM3><REFID4 >0à??1×???</REFID4><REFNAM4 >0à??1×???</REFNAM4><REFID5 >0à??1×???</REFID5><REFNAM5 >0à??1×???</REFNAM5></ROW>
</ROWSET>
</flddtl></mdroot>